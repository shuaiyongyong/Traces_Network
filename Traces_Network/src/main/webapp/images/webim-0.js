function Chat(){var a=null;this.setSdkChat=function(b){a=b},this.getSdkChat=function(){return a}}function ChatCollection(a,b){var c,d,e=this,f=$(e),g=[],h={TIME:"time",UNREAD:"unread",INSERT:"insert_time"};c={sortType:h.UNREAD},d=$.extend(!0,c,b);var i=function(a){if(a.id||(a.id=a.getChatId()),!a.id)throw"No id in chat ["+Object.prototype.toString.call(a)+"]"},j=function(a){var b=function(a,b){return b.getMessageState().lastMsgTime-a.getMessageState().lastMsgTime},c=function(a,c){return a.getUnreadCounter()>0&&c.getUnreadCounter()>0?b(a,c):a.getUnreadCounter()>0?-1:c.getUnreadCounter()>0?1:b(a,c)},e=function(a,b){return b.__insertTime!=a.__insertTime?b.__insertTime-a.__insertTime:c(a,b)};switch(d.sortType){case h.TIME:a.sort(function(a,b){return b.getMessageState().lastMsgTime-a.getMessageState().lastMsgTime});break;case h.INSERT:a.sort(function(a,b){return e(a,b)});break;case h.UNREAD:a.sort(function(a,b){return c(a,b)});break;default:a.sort(function(a,b){return c(a,b)})}};return $.each(a||[],function(a,b){g.push(i(b))}),j(g),this.update=this.add=function(a){if(a){i(a);var b=e.indexOf(a),c=["change"];b>-1?($.extend(!0,e.getAt(b),a),a.__updateTime=+new Date,c.push("update")):(c.push("add"),a.__updateTime=a.__insertTime=+new Date,g.push(a)),j(g),b=e.indexOf(a),$.each(c,function(c,d){e.trigger(d,[[a],b])})}},this.addAll=function(a){if(a&&0!==a.length){var b=+new Date;$.each(a,function(a,c){var d=e.indexOf(c);d>-1?($.extend(!0,e.getAt(d),c),c.__updateTime=b):(c.__updateTime=c.__insertTime=b,g.push(c))}),j(g),$.each(["change","addAll"],function(b,c){e.trigger(c,[a,-1])})}},this.remove=function(a){"object"==typeof a&&i(a);var b=e.indexOf(a);b>-1&&(g.splice(b,1),$.each(["change","remove"],function(c,d){e.trigger(d,[[a],b])}))},this.reinsert=function(a){e.remove(a),e.add(a)},this.clear=function(){var a=g.splice(0,g.length);$.each(["change","reset"],function(b,c){e.trigger(c,[a,0])})},this.get=function(a){for(var b=0;b<g.length;b++)if(g[b].id==a)return g[b];return null},this.getByUid=function(a){for(var b=0;b<g.length;b++)if(g[b].peerUserId()==a&&!g[b].isGroup())return g[b];return null},this.getAt=function(a){return g[a]},this.indexOf=function(a){var b=-1;"object"==typeof a?(i(a),b=a.id):b=a;for(var c=0;c<g.length;c++)if(g[c].id==b)return c;return-1},this.contains=function(a){return e.indexOf(a)>-1},this.first=function(){return g[0]},this.firstUnread=function(){for(var a=0;a<g.length;a++)if(g[a].getUnreadCounter()>0)return g[a];return null},this.last=function(){return g[g.length-1]},this.top=function(a){return a>g.length?[].concat(g):g.slice(0,a)},this.getUnreadCount=function(){var a=0;return $.each(g,function(b,c){c.getUnreadCounter()>0&&(a+=1)}),a},this.getUnreadTotalCount=function(){var a=0;return $.each(g,function(b,c){a+=c.getUnreadCounter()}),a},this.each=function(a){var b,c,d=[].concat(g);for(c=0;c<d.length&&(b=d[c],a.call(b,c,b)!==!1);c++);},this.reach=function(a){var b,c,d=[].concat(g).reverse();for(c=0;c<d.length&&(b=d[c],a.call(b,c,b)!==!1);c++);},this.toJSON=function(){return[].concat(g)},this.size=function(){return g.length},this.unreadToJSON=function(){var a=[];return $.each(g,function(b,c){c.getUnreadCounter()>0&&a.push(c)}),a},this.updateConfig=function(a){a=a||{},$.each(a,function(a,b){switch(a){case"sortType":d.sortType=b,j(g),e.trigger("sort")}})},this.on=function(a,b){var c=function(){b.apply(e,Array.prototype.slice.call(arguments,1).concat([c,f]))};f.on(a,c)},this.trigger=function(a,b){f.trigger(a,b)},this}function CMStorage(a){var b=window.localStorage||{setItem:function(a){},getItem:function(a){},removeItem:function(a){}},c="__object_convert_string",d="_date_convert_string",e="__string_direct_string",f="__oth_todo_string";this.write=function(g,h){g=a+g,"undefined"==typeof h?h="undefined":null===h?h="null":"string"==typeof h?h=e+h:"[object Date]"===Object.prototype.toString.call(h)?h=d+h.getTime():"object"==typeof h?(h=JSON.stringify(h),h=c+h):h=f+h,b.setItem(g,h)},this.read=function(g){g=a+g;var h=b.getItem(g);return void 0===h||(null===h?h=null:"undefined"===h?h=void 0:"null"===h?h=null:0==h.indexOf(e)?h=h.slice(e.length):0==h.indexOf(c)?(h=h.slice(c.length),h=JSON.parse(h)):0==h.indexOf(f)?h=h.slice(c.length):0==h.indexOf(d)&&(h=h.slice(d.length),h=new Date(+h))),h},this.remove=function(c){b.removeItem(a+c)}}String.prototype.hashCode=function(){var a,b,c,d=0;if(0==this.length)return d;for(a=0,c=this.length;c>a;a++)b=this.charCodeAt(a),d=(d<<5)-d+b,d|=0;return d},Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){var c;if(null==this)throw new TypeError('"this" is null or not defined');var d=Object(this),e=d.length>>>0;if(0===e)return-1;var f=0|b;if(f>=e)return-1;for(c=Math.max(f>=0?f:e-Math.abs(f),0);e>c;){if(c in d&&d[c]===a)return c;c++}return-1}),function(){function a(){}this.console=this.console||{memory:a,debug:a,error:a,info:a,log:a,warn:a,dir:a,dirxml:a,table:a,trace:a,assert:a,count:a,markTimeline:a,profile:a,profileEnd:a,time:a,timeEnd:a,timeStamp:a,timeline:a,timelineEnd:a,group:a,groupCollapsed:a,groupEnd:a}}(),"undefined"==typeof sjb&&(sjb={}),"undefined"==typeof sjb.messaging&&(sjb.messaging={}),sjb.messaging.comoon=sjb.messaging.comoon||{},sjb.messaging.comoon.config=sjb.messaging.comoon.config||{},sjb.messaging.comoon.LogLevel={none:0,log:1,debug:2,warn:3,error:4,fatal:5},$.extend(sjb.messaging.comoon.config,{logLevel:100}),function(){sjb.messaging.comoon.xhr={decode:function(a){"string"==typeof a&&(a=JSON.parse(a));var b=new sjb.messaging.Response,c=new Thrift.Transport;c.setRecvBuffer(a);var d=new Thrift.TJSONProtocol(c);return d.readMessageBegin(),b.read(d),d.readMessageEnd(),b}}}(),function(){function a(a,b){sjb.messaging.comoon.config.logLevel<=b&&console.log(a)}sjb.messaging.comoon.Logger={log:function(b){a(b,sjb.messaging.comoon.LogLevel.log)},debug:function(b){a(b,sjb.messaging.comoon.LogLevel.debug)},error:function(b){a(b,sjb.messaging.comoon.LogLevel.error)},warn:function(b){a(b,sjb.messaging.comoon.LogLevel.warn)}}}(),function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a("object"==typeof exports?require("jquery"):jQuery)}(function(a){function b(a){return h.raw?a:encodeURIComponent(a)}function c(a){return h.raw?a:decodeURIComponent(a)}function d(a){return b(h.json?JSON.stringify(a):String(a))}function e(a){0===a.indexOf('"')&&(a=a.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return a=decodeURIComponent(a.replace(g," ")),h.json?JSON.parse(a):a}catch(b){}}function f(b,c){var d=h.raw?b:e(b);return a.isFunction(c)?c(d):d}var g=/\+/g,h=a.cookie=function(e,g,i){if(arguments.length>1&&!a.isFunction(g)){if(i=a.extend({},h.defaults,i),"number"==typeof i.expires){var j=i.expires,k=i.expires=new Date;k.setTime(+k+864e5*j)}return document.cookie=[b(e),"=",d(g),i.expires?"; expires="+i.expires.toUTCString():"",i.path?"; path="+i.path:"",i.domain?"; domain="+i.domain:"",i.secure?"; secure":""].join("")}for(var l=e?void 0:{},m=document.cookie?document.cookie.split("; "):[],n=0,o=m.length;o>n;n++){var p=m[n].split("="),q=c(p.shift()),r=p.join("=");if(e&&e===q){l=f(r,g);break}e||void 0===(r=f(r))||(l[q]=r)}return l};h.defaults={},a.removeCookie=function(b,c){return void 0===a.cookie(b)?!1:(a.cookie(b,"",a.extend({},c,{expires:-1})),!a.cookie(b))}});var Thrift={Version:"1.0.0-dev",Type:{STOP:0,VOID:1,BOOL:2,BYTE:3,I08:3,DOUBLE:4,I16:6,I32:8,I64:10,STRING:11,UTF7:11,STRUCT:12,MAP:13,SET:14,LIST:15,UTF8:16,UTF16:17},MessageType:{CALL:1,REPLY:2,EXCEPTION:3,ONEWAY:4},objectLength:function(a){var b=0;for(var c in a)a.hasOwnProperty(c)&&b++;return b},inherits:function(a,b,c){function d(){}d.prototype=b.prototype,a.prototype=new d,a.prototype.name=c||""}};Thrift.TException=function(a){this.message=a},Thrift.inherits(Thrift.TException,Error,"TException"),Thrift.TException.prototype.getMessage=function(){return this.message},Thrift.TApplicationExceptionType={UNKNOWN:0,UNKNOWN_METHOD:1,INVALID_MESSAGE_TYPE:2,WRONG_METHOD_NAME:3,BAD_SEQUENCE_ID:4,MISSING_RESULT:5,INTERNAL_ERROR:6,PROTOCOL_ERROR:7,INVALID_TRANSFORM:8,INVALID_PROTOCOL:9,UNSUPPORTED_CLIENT_TYPE:10},Thrift.TApplicationException=function(a,b){this.message=a,this.code="number"==typeof b?b:0},Thrift.inherits(Thrift.TApplicationException,Thrift.TException,"TApplicationException"),Thrift.TApplicationException.prototype.read=function(a){for(;;){var b=a.readFieldBegin();if(b.ftype==Thrift.Type.STOP)break;var c=b.fid;switch(c){case 1:b.ftype==Thrift.Type.STRING?(b=a.readString(),this.message=b.value):b=a.skip(b.ftype);break;case 2:b.ftype==Thrift.Type.I32?(b=a.readI32(),this.code=b.value):b=a.skip(b.ftype);break;default:b=a.skip(b.ftype)}a.readFieldEnd()}a.readStructEnd()},Thrift.TApplicationException.prototype.write=function(a){a.writeStructBegin("TApplicationException"),this.message&&(a.writeFieldBegin("message",Thrift.Type.STRING,1),a.writeString(this.getMessage()),a.writeFieldEnd()),this.code&&(a.writeFieldBegin("type",Thrift.Type.I32,2),a.writeI32(this.code),a.writeFieldEnd()),a.writeFieldStop(),a.writeStructEnd()},Thrift.TApplicationException.prototype.getCode=function(){return this.code},Thrift.Transport=Thrift.TXHRTransport=function(a,b){this.url=a,this.wpos=0,this.rpos=0,this.useCORS=b&&b.useCORS,this.send_buf="",this.recv_buf=""},Thrift.TXHRTransport.prototype={getXmlHttpRequestObject:function(){try{return new XMLHttpRequest}catch(a){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(b){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(c){}throw"Your browser doesn't support XHR."},flush:function(a,b){var c=this;if(a&&!b||void 0===this.url||""===this.url)return this.send_buf;var d=this.getXmlHttpRequestObject();if(d.overrideMimeType&&d.overrideMimeType("application/json"),b&&(d.onreadystatechange=function(){var a=b;return function(){4==this.readyState&&200==this.status&&(c.setRecvBuffer(this.responseText),a())}}()),d.open("POST",this.url,!!a),d.send(this.send_buf),!a||!b){if(4!=d.readyState)throw"encountered an unknown ajax ready state: "+d.readyState;if(200!=d.status)throw"encountered a unknown request status: "+d.status;this.recv_buf=d.responseText,this.recv_buf_sz=this.recv_buf.length,this.wpos=this.recv_buf.length,this.rpos=0}},jqRequest:function(a,b,c,d){if("undefined"==typeof jQuery||"undefined"==typeof jQuery.Deferred)throw"Thrift.js requires jQuery 1.5+ to use asynchronous requests";var e=this,f=jQuery.ajax({url:this.url,data:b,type:"POST",cache:!1,contentType:"application/json",dataType:"text thrift",converters:{"text thrift":function(b){e.setRecvBuffer(b);var c=d.call(a);return c}},context:a,success:jQuery.makeArray(c).pop()});return f},setRecvBuffer:function(a){this.recv_buf=a,this.recv_buf_sz=this.recv_buf.length,this.wpos=this.recv_buf.length,this.rpos=0},isOpen:function(){return!0},open:function(){},close:function(){},read:function(a){var b=this.wpos-this.rpos;if(0===b)return"";var c=a;a>b&&(c=b);var d=this.read_buf.substr(this.rpos,c);return this.rpos+=c,d},readAll:function(){return this.recv_buf},write:function(a){this.send_buf=a},getSendBuffer:function(){return this.send_buf}},Thrift.TWebSocketTransport=function(a){this.__reset(a)},Thrift.TWebSocketTransport.prototype={__reset:function(a){this.url=a,this.socket=null,this.callbacks=[],this.send_pending=[],this.send_buf="",this.recv_buf="",this.rb_wpos=0,this.rb_rpos=0},flush:function(a,b){var c=this;this.isOpen()?(this.socket.send(this.send_buf),this.callbacks.push(function(){var a=b;return function(b){c.setRecvBuffer(b),a()}}())):this.send_pending.push({buf:this.send_buf,cb:b})},__onOpen:function(){var a=this;this.send_pending.length>0&&(this.send_pending.forEach(function(b){this.socket.send(b.buf),this.callbacks.push(function(){var c=b.cb;return function(b){a.setRecvBuffer(b),c()}}())}),this.send_pending=[])},__onClose:function(a){this.__reset(this.url)},__onMessage:function(a){this.callbacks.length&&this.callbacks.shift()(a.data)},__onError:function(a){console.log("Thrift WebSocket Error: "+a.toString()),this.socket.close()},setRecvBuffer:function(a){this.recv_buf=a,this.recv_buf_sz=this.recv_buf.length,this.wpos=this.recv_buf.length,this.rpos=0},isOpen:function(){return this.socket&&this.socket.readyState==this.socket.OPEN},open:function(){this.socket&&this.socket.readyState!=this.socket.CLOSED||(this.socket=new WebSocket(this.url),this.socket.onopen=this.__onOpen.bind(this),this.socket.onmessage=this.__onMessage.bind(this),this.socket.onerror=this.__onError.bind(this),this.socket.onclose=this.__onClose.bind(this))},close:function(){this.socket.close()},read:function(a){var b=this.wpos-this.rpos;if(0===b)return"";var c=a;a>b&&(c=b);var d=this.read_buf.substr(this.rpos,c);return this.rpos+=c,d},readAll:function(){return this.recv_buf},write:function(a){this.send_buf=a},getSendBuffer:function(){return this.send_buf}},Thrift.TJSONProtocol=Thrift.Protocol=function(a){this.tstack=[],this.tpos=[],this.transport=a},Thrift.Protocol.Type={},Thrift.Protocol.Type[Thrift.Type.BOOL]='"tf"',Thrift.Protocol.Type[Thrift.Type.BYTE]='"i8"',Thrift.Protocol.Type[Thrift.Type.I16]='"i16"',Thrift.Protocol.Type[Thrift.Type.I32]='"i32"',Thrift.Protocol.Type[Thrift.Type.I64]='"i64"',Thrift.Protocol.Type[Thrift.Type.DOUBLE]='"dbl"',Thrift.Protocol.Type[Thrift.Type.STRUCT]='"rec"',Thrift.Protocol.Type[Thrift.Type.STRING]='"str"',Thrift.Protocol.Type[Thrift.Type.MAP]='"map"',Thrift.Protocol.Type[Thrift.Type.LIST]='"lst"',Thrift.Protocol.Type[Thrift.Type.SET]='"set"',Thrift.Protocol.RType={},Thrift.Protocol.RType.tf=Thrift.Type.BOOL,Thrift.Protocol.RType.i8=Thrift.Type.BYTE,Thrift.Protocol.RType.i16=Thrift.Type.I16,Thrift.Protocol.RType.i32=Thrift.Type.I32,Thrift.Protocol.RType.i64=Thrift.Type.I64,Thrift.Protocol.RType.dbl=Thrift.Type.DOUBLE,Thrift.Protocol.RType.rec=Thrift.Type.STRUCT,Thrift.Protocol.RType.str=Thrift.Type.STRING,Thrift.Protocol.RType.map=Thrift.Type.MAP,Thrift.Protocol.RType.lst=Thrift.Type.LIST,Thrift.Protocol.RType.set=Thrift.Type.SET,Thrift.Protocol.Version=1,Thrift.Protocol.prototype={getTransport:function(){return this.transport},writeMessageBegin:function(a,b,c){this.tstack=[],this.tpos=[],this.tstack.push([Thrift.Protocol.Version,'"'+a+'"',b,c])},writeMessageEnd:function(){var a=this.tstack.pop();this.wobj=this.tstack.pop(),this.wobj.push(a),this.wbuf="["+this.wobj.join(",")+"]",this.transport.write(this.wbuf)},writeStructBegin:function(a){this.tpos.push(this.tstack.length),this.tstack.push({})},writeStructEnd:function(){var a=this.tpos.pop(),b=this.tstack[a],c="{",d=!0;for(var e in b)d?d=!1:c+=",",c+=e+":"+b[e];c+="}",this.tstack[a]=c},writeFieldBegin:function(a,b,c){this.tpos.push(this.tstack.length),this.tstack.push({fieldId:'"'+c+'"',fieldType:Thrift.Protocol.Type[b]})},writeFieldEnd:function(){var a=this.tstack.pop(),b=this.tstack.pop();this.tstack[this.tstack.length-1][b.fieldId]="{"+b.fieldType+":"+a+"}",this.tpos.pop()},writeFieldStop:function(){},writeMapBegin:function(a,b,c){this.tpos.push(this.tstack.length),this.tstack.push([Thrift.Protocol.Type[a],Thrift.Protocol.Type[b],0])},writeMapEnd:function(){var a=this.tpos.pop();if(a!=this.tstack.length){(this.tstack.length-a-1)%2!==0&&this.tstack.push("");var b=(this.tstack.length-a-1)/2;this.tstack[a][this.tstack[a].length-1]=b;for(var c="}",d=!0;this.tstack.length>a+1;){var e=this.tstack.pop(),f=this.tstack.pop();d?d=!1:c=","+c,isNaN(f)||(f='"'+f+'"'),c=f+":"+e+c}c="{"+c,this.tstack[a].push(c),this.tstack[a]="["+this.tstack[a].join(",")+"]"}},writeListBegin:function(a,b){this.tpos.push(this.tstack.length),this.tstack.push([Thrift.Protocol.Type[a],b])},writeListEnd:function(){for(var a=this.tpos.pop();this.tstack.length>a+1;){var b=this.tstack[a+1];this.tstack.splice(a+1,1),this.tstack[a].push(b)}this.tstack[a]="["+this.tstack[a].join(",")+"]"},writeSetBegin:function(a,b){this.tpos.push(this.tstack.length),this.tstack.push([Thrift.Protocol.Type[a],b])},writeSetEnd:function(){for(var a=this.tpos.pop();this.tstack.length>a+1;){var b=this.tstack[a+1];this.tstack.splice(a+1,1),this.tstack[a].push(b)}this.tstack[a]="["+this.tstack[a].join(",")+"]"},writeBool:function(a){this.tstack.push(a?1:0)},writeByte:function(a){this.tstack.push(a)},writeI16:function(a){this.tstack.push(a)},writeI32:function(a){this.tstack.push(a)},writeI64:function(a){this.tstack.push(a)},writeDouble:function(a){this.tstack.push(a)},writeString:function(a){if(null===a)this.tstack.push(null);else{for(var b="",c=0;c<a.length;c++){var d=a.charAt(c);b+='"'===d?'\\"':"\\"===d?"\\\\":"\b"===d?"\\b":"\f"===d?"\\f":"\n"===d?"\\n":"\r"===d?"\\r":"	"===d?"\\t":d}this.tstack.push('"'+b+'"')}},writeBinary:function(a){this.writeString(a)},readMessageBegin:function(){this.rstack=[],this.rpos=[],"undefined"!=typeof JSON&&"function"==typeof JSON.parse?this.robj=JSON.parse(this.transport.readAll()):"undefined"!=typeof jQuery?this.robj=jQuery.parseJSON(this.transport.readAll()):this.robj=eval(this.transport.readAll());var r={},version=this.robj.shift();if(version!=Thrift.Protocol.Version)throw"Wrong thrift protocol version: "+version;return r.fname=this.robj.shift(),r.mtype=this.robj.shift(),r.rseqid=this.robj.shift(),this.rstack.push(this.robj.shift()),r},readMessageEnd:function(){},readStructBegin:function(a){var b={};return b.fname="",this.rstack[this.rstack.length-1]instanceof Array&&this.rstack.push(this.rstack[this.rstack.length-1].shift()),b},readStructEnd:function(){this.rstack[this.rstack.length-2]instanceof Array&&this.rstack.pop()},readFieldBegin:function(){var a={},b=-1,c=Thrift.Type.STOP;for(var d in this.rstack[this.rstack.length-1])if(null!==d){b=parseInt(d,10),this.rpos.push(this.rstack.length);var e=this.rstack[this.rstack.length-1][b];delete this.rstack[this.rstack.length-1][b],this.rstack.push(e);break}if(-1!=b)for(var f in this.rstack[this.rstack.length-1])null!==Thrift.Protocol.RType[f]&&(c=Thrift.Protocol.RType[f],this.rstack[this.rstack.length-1]=this.rstack[this.rstack.length-1][f]);return a.fname="",a.ftype=c,a.fid=b,a},readFieldEnd:function(){for(var a=this.rpos.pop();this.rstack.length>a;)this.rstack.pop()},readMapBegin:function(){var a=this.rstack.pop(),b=a.shift();b instanceof Array&&(this.rstack.push(a),a=b,b=a.shift());var c={};return c.ktype=Thrift.Protocol.RType[b],c.vtype=Thrift.Protocol.RType[a.shift()],c.size=a.shift(),this.rpos.push(this.rstack.length),this.rstack.push(a.shift()),c},readMapEnd:function(){this.readFieldEnd()},readListBegin:function(){var a=this.rstack[this.rstack.length-1],b={};return b.etype=Thrift.Protocol.RType[a.shift()],b.size=a.shift(),this.rpos.push(this.rstack.length),this.rstack.push(a),b},readListEnd:function(){this.readFieldEnd()},readSetBegin:function(a,b){return this.readListBegin(a,b)},readSetEnd:function(){return this.readListEnd()},readBool:function(){var a=this.readI32();return null!==a&&"1"==a.value?a.value=!0:a.value=!1,a},readByte:function(){return this.readI32()},readI16:function(){return this.readI32()},readI32:function(a){void 0===a&&(a=this.rstack[this.rstack.length-1]);var b={};if(a instanceof Array)0===a.length?b.value=void 0:b.value=a.shift();else if(a instanceof Object){for(var c in a)if(null!==c){this.rstack.push(a[c]),delete a[c],b.value=c;break}}else b.value=a,this.rstack.pop();return b},readI64:function(){return this.readI32()},readDouble:function(){return this.readI32()},readString:function(){var a=this.readI32();return a},readBinary:function(){return this.readString()},skip:function(a){var b,c;switch(a){case Thrift.Type.STOP:return null;case Thrift.Type.BOOL:return this.readBool();case Thrift.Type.BYTE:return this.readByte();case Thrift.Type.I16:return this.readI16();case Thrift.Type.I32:return this.readI32();case Thrift.Type.I64:return this.readI64();case Thrift.Type.DOUBLE:return this.readDouble();case Thrift.Type.STRING:return this.readString();case Thrift.Type.STRUCT:for(this.readStructBegin();;){if(b=this.readFieldBegin(),b.ftype==Thrift.Type.STOP)break;this.skip(b.ftype),this.readFieldEnd()}return this.readStructEnd(),null;case Thrift.Type.MAP:for(b=this.readMapBegin(),c=0;c<b.size;c++)c>0&&this.rstack.length>this.rpos[this.rpos.length-1]+1&&this.rstack.pop(),this.skip(b.ktype),this.skip(b.vtype);return this.readMapEnd(),null;case Thrift.Type.SET:for(b=this.readSetBegin(),c=0;c<b.size;c++)this.skip(b.etype);return this.readSetEnd(),null;case Thrift.Type.LIST:for(b=this.readListBegin(),c=0;c<b.size;c++)this.skip(b.etype);return this.readListEnd(),null}}},Thrift.MultiplexProtocol=function(a,b,c,d){Thrift.Protocol.call(this,b,c,d),this.serviceName=a},Thrift.inherits(Thrift.MultiplexProtocol,Thrift.Protocol,"multiplexProtocol"),Thrift.MultiplexProtocol.prototype.writeMessageBegin=function(a,b,c){b===Thrift.MessageType.CALL||b===Thrift.MessageType.ONEWAY?Thrift.Protocol.prototype.writeMessageBegin.call(this,this.serviceName+":"+a,b,c):Thrift.Protocol.prototype.writeMessageBegin.call(this,a,b,c)},Thrift.Multiplexer=function(){this.seqid=0},Thrift.Multiplexer.prototype.createClient=function(a,b,c){b.Client&&(b=b.Client);var d=this;b.prototype.new_seqid=function(){return d.seqid+=1,d.seqid};var e=new b(new Thrift.MultiplexProtocol(a,c));return e},"undefined"==typeof sjb&&(sjb={}),"undefined"==typeof sjb.messaging&&(sjb.messaging={}),sjb.messaging.Version={ONE:1},sjb.messaging.DeviceType={WEB:0,H5:1,IOS:2,ANDROID:3,SYSTEM:9},sjb.messaging.Sync=function(a){this.imMessageState=null,this.imChatListState=null,this.imUnreadState=null,a&&(void 0!==a.imMessageState&&(this.imMessageState=a.imMessageState),void 0!==a.imChatListState&&(this.imChatListState=a.imChatListState),void 0!==a.imUnreadState&&(this.imUnreadState=a.imUnreadState))},sjb.messaging.Sync.prototype={},sjb.messaging.Sync.prototype.read=function(a){for(a.readStructBegin();;){var b=a.readFieldBegin(),c=(b.fname,b.ftype),d=b.fid;if(c==Thrift.Type.STOP)break;switch(d){case 1:c==Thrift.Type.I64?this.imMessageState=a.readI64().value:a.skip(c);break;case 2:c==Thrift.Type.I64?this.imChatListState=a.readI64().value:a.skip(c);break;case 3:c==Thrift.Type.I64?this.imUnreadState=a.readI64().value:a.skip(c);break;default:a.skip(c)}a.readFieldEnd()}a.readStructEnd()},sjb.messaging.Sync.prototype.write=function(a){a.writeStructBegin("Sync"),null!==this.imMessageState&&void 0!==this.imMessageState&&(a.writeFieldBegin("imMessageState",Thrift.Type.I64,1),a.writeI64(this.imMessageState),a.writeFieldEnd()),null!==this.imChatListState&&void 0!==this.imChatListState&&(a.writeFieldBegin("imChatListState",Thrift.Type.I64,2),a.writeI64(this.imChatListState),a.writeFieldEnd()),null!==this.imUnreadState&&void 0!==this.imUnreadState&&(a.writeFieldBegin("imUnreadState",Thrift.Type.I64,3),a.writeI64(this.imUnreadState),a.writeFieldEnd()),a.writeFieldStop(),a.writeStructEnd()},"undefined"==typeof sjb&&(sjb={}),"undefined"==typeof sjb.messaging&&(sjb.messaging={}),sjb.messaging.Type={LOGIN:0,SYNC:1,IM_QUERY_UNREAD_COUNTER:2,IM_SEND_MESSAGE:3,IM_MARK_AS_READ:4,IM_LOAD_CHAT_HISTORY:5,IM_UPDATE_ONLINE_STATUS:6,IM_QUERY_ONLINE_STATUS:7,IM_CREATE_CHAT:8,IM_QUERY_PARENT_ACCOUNT:9},sjb.messaging.ResponseCode={OK:0,BAD_REQUEST:1,RETRY_LATER:2,FAIL_LOGIN:3,NOT_YET_LOGIN:4,SENSITIVE_WORD:5,UID_NOT_EXIST:6},sjb.messaging.AuthenticationOAuth=function(a){if(this.openId=null,this.accessToken=null,a){if(void 0===a.openId)throw new Thrift.TProtocolException(Thrift.TProtocolExceptionType.UNKNOWN,"Required field openId is unset!");if(this.openId=a.openId,void 0===a.accessToken)throw new Thrift.TProtocolException(Thrift.TProtocolExceptionType.UNKNOWN,"Required field accessToken is unset!");this.accessToken=a.accessToken}},sjb.messaging.AuthenticationOAuth.prototype={},sjb.messaging.AuthenticationOAuth.prototype.read=function(a){for(a.readStructBegin();;){var b=a.readFieldBegin(),c=(b.fname,b.ftype),d=b.fid;if(c==Thrift.Type.STOP)break;switch(d){case 1:c==Thrift.Type.STRING?this.openId=a.readString().value:a.skip(c);break;case 2:c==Thrift.Type.STRING?this.accessToken=a.readString().value:a.skip(c);break;default:a.skip(c)}a.readFieldEnd()}a.readStructEnd()},sjb.messaging.AuthenticationOAuth.prototype.write=function(a){a.writeStructBegin("AuthenticationOAuth"),null!==this.openId&&void 0!==this.openId&&(a.writeFieldBegin("openId",Thrift.Type.STRING,1),a.writeString(this.openId),a.writeFieldEnd()),null!==this.accessToken&&void 0!==this.accessToken&&(a.writeFieldBegin("accessToken",Thrift.Type.STRING,2),a.writeString(this.accessToken),a.writeFieldEnd()),a.writeFieldStop(),a.writeStructEnd()},sjb.messaging.AuthenticationZCookie=function(a){if(this.zcookie=null,a){if(void 0===a.zcookie)throw new Thrift.TProtocolException(Thrift.TProtocolExceptionType.UNKNOWN,"Required field zcookie is unset!");this.zcookie=a.zcookie}},sjb.messaging.AuthenticationZCookie.prototype={},sjb.messaging.AuthenticationZCookie.prototype.read=function(a){for(a.readStructBegin();;){var b=a.readFieldBegin(),c=(b.fname,b.ftype),d=b.fid;if(c==Thrift.Type.STOP)break;switch(d){case 1:c==Thrift.Type.STRING?this.zcookie=a.readString().value:a.skip(c);break;case 0:a.skip(c);break;default:a.skip(c)}a.readFieldEnd()}a.readStructEnd()},sjb.messaging.AuthenticationZCookie.prototype.write=function(a){a.writeStructBegin("AuthenticationZCookie"),null!==this.zcookie&&void 0!==this.zcookie&&(a.writeFieldBegin("zcookie",Thrift.Type.STRING,1),a.writeString(this.zcookie),a.writeFieldEnd()),a.writeFieldStop(),a.writeStructEnd()},sjb.messaging.AuthenticationVisitor=function(a){if(this.vtoken=null,a){if(void 0===a.vtoken)throw new Thrift.TProtocolException(Thrift.TProtocolExceptionType.UNKNOWN,"Required field vtoken is unset!");this.vtoken=a.vtoken}},sjb.messaging.AuthenticationVisitor.prototype={},sjb.messaging.AuthenticationVisitor.prototype.read=function(a){for(a.readStructBegin();;){var b=a.readFieldBegin(),c=(b.fname,b.ftype),d=b.fid;if(c==Thrift.Type.STOP)break;switch(d){case 1:c==Thrift.Type.STRING?this.vtoken=a.readString().value:a.skip(c);break;case 0:a.skip(c);break;default:a.skip(c)}a.readFieldEnd()}a.readStructEnd()},sjb.messaging.AuthenticationVisitor.prototype.write=function(a){a.writeStructBegin("AuthenticationVisitor"),null!==this.vtoken&&void 0!==this.vtoken&&(a.writeFieldBegin("vtoken",Thrift.Type.STRING,1),a.writeString(this.vtoken),a.writeFieldEnd()),a.writeFieldStop(),a.writeStructEnd()},sjb.messaging.Authentication=function(a){this.oauth=null,this.zcookie=null,this.visitor=null,a&&(void 0!==a.oauth&&(this.oauth=a.oauth),void 0!==a.zcookie&&(this.zcookie=a.zcookie),void 0!==a.visitor&&(this.visitor=a.visitor))},sjb.messaging.Authentication.prototype={},sjb.messaging.Authentication.prototype.read=function(a){for(a.readStructBegin();;){var b=a.readFieldBegin(),c=(b.fname,b.ftype),d=b.fid;if(c==Thrift.Type.STOP)break;switch(d){case 1:c==Thrift.Type.STRUCT?(this.oauth=new sjb.messaging.AuthenticationOAuth,this.oauth.read(a)):a.skip(c);break;case 2:c==Thrift.Type.STRUCT?(this.zcookie=new sjb.messaging.AuthenticationZCookie,this.zcookie.read(a)):a.skip(c);break;case 3:c==Thrift.Type.STRUCT?(this.visitor=new sjb.messaging.AuthenticationVisitor,this.visitor.read(a)):a.skip(c);break;default:a.skip(c)}a.readFieldEnd()}a.readStructEnd()},sjb.messaging.Authentication.prototype.write=function(a){a.writeStructBegin("Authentication"),null!==this.oauth&&void 0!==this.oauth&&(a.writeFieldBegin("oauth",Thrift.Type.STRUCT,1),this.oauth.write(a),a.writeFieldEnd()),null!==this.zcookie&&void 0!==this.zcookie&&(a.writeFieldBegin("zcookie",Thrift.Type.STRUCT,2),this.zcookie.write(a),a.writeFieldEnd()),null!==this.visitor&&void 0!==this.visitor&&(a.writeFieldBegin("visitor",Thrift.Type.STRUCT,3),this.visitor.write(a),a.writeFieldEnd()),a.writeFieldStop(),a.writeStructEnd()},sjb.messaging.Request=function(a){if(this.version=null,this.type=null,this.deviceType=null,this.myuid=null,this.deviceToken=null,this.authentication=null,this.sync=null,this.imSendMessage=null,this.imMarkAsRead=null,this.imChatHistoryRange=null,this.onlineStatus=null,this.onlineStatusQuery=null,this.uid=null,this.parentUid=null,a){if(void 0===a.version)throw new Thrift.TProtocolException(Thrift.TProtocolExceptionType.UNKNOWN,"Required field version is unset!");if(this.version=a.version,void 0===a.type)throw new Thrift.TProtocolException(Thrift.TProtocolExceptionType.UNKNOWN,"Required field type is unset!");this.type=a.type,void 0!==a.deviceType&&(this.deviceType=a.deviceType),void 0!==a.myuid&&(this.myuid=a.myuid),void 0!==a.deviceToken&&(this.deviceToken=a.deviceToken),void 0!==a.authentication&&(this.authentication=a.authentication),void 0!==a.sync&&(this.sync=a.sync),void 0!==a.imSendMessage&&(this.imSendMessage=a.imSendMessage),void 0!==a.imMarkAsRead&&(this.imMarkAsRead=a.imMarkAsRead),void 0!==a.imChatHistoryRange&&(this.imChatHistoryRange=a.imChatHistoryRange),void 0!==a.onlineStatus&&(this.onlineStatus=a.onlineStatus),void 0!==a.onlineStatusQuery&&(this.onlineStatusQuery=a.onlineStatusQuery),void 0!==a.uid&&(this.uid=a.uid),void 0!==a.parentUid&&(this.parentUid=a.parentUid)}},sjb.messaging.Request.prototype={},sjb.messaging.Request.prototype.read=function(a){for(a.readStructBegin();;){var b=a.readFieldBegin(),c=(b.fname,b.ftype),d=b.fid;if(c==Thrift.Type.STOP)break;switch(d){case 1:c==Thrift.Type.I32?this.version=a.readI32().value:a.skip(c);break;case 2:c==Thrift.Type.I32?this.type=a.readI32().value:a.skip(c);break;case 3:c==Thrift.Type.I32?this.deviceType=a.readI32().value:a.skip(c);break;case 4:c==Thrift.Type.I64?this.myuid=a.readI64().value:a.skip(c);break;case 5:c==Thrift.Type.STRING?this.deviceToken=a.readString().value:a.skip(c);break;case 10:c==Thrift.Type.STRUCT?(this.authentication=new sjb.messaging.Authentication,this.authentication.read(a)):a.skip(c);break;case 11:c==Thrift.Type.STRUCT?(this.sync=new sjb.messaging.Sync,this.sync.read(a)):a.skip(c);break;case 12:c==Thrift.Type.STRUCT?(this.imSendMessage=new sjb.messaging.im.SendMessage,this.imSendMessage.read(a)):a.skip(c);break;case 13:c==Thrift.Type.STRUCT?(this.imMarkAsRead=new sjb.messaging.im.MarkAsRead,this.imMarkAsRead.read(a)):a.skip(c);break;case 14:c==Thrift.Type.STRUCT?(this.imChatHistoryRange=new sjb.messaging.im.ChatHistoryRange,this.imChatHistoryRange.read(a)):a.skip(c);break;case 15:c==Thrift.Type.I32?this.onlineStatus=a.readI32().value:a.skip(c);break;case 16:c==Thrift.Type.STRUCT?(this.onlineStatusQuery=new sjb.messaging.im.OnlineStatusQuery,this.onlineStatusQuery.read(a)):a.skip(c);break;case 17:c==Thrift.Type.I64?this.uid=a.readI64().value:a.skip(c);break;case 18:c==Thrift.Type.I64?this.parentUid=a.readI64().value:a.skip(c);break;default:a.skip(c)}a.readFieldEnd()}a.readStructEnd()},sjb.messaging.Request.prototype.write=function(a){a.writeStructBegin("Request"),null!==this.version&&void 0!==this.version&&(a.writeFieldBegin("version",Thrift.Type.I32,1),a.writeI32(this.version),a.writeFieldEnd()),null!==this.type&&void 0!==this.type&&(a.writeFieldBegin("type",Thrift.Type.I32,2),a.writeI32(this.type),a.writeFieldEnd()),null!==this.deviceType&&void 0!==this.deviceType&&(a.writeFieldBegin("deviceType",Thrift.Type.I32,3),a.writeI32(this.deviceType),a.writeFieldEnd()),null!==this.myuid&&void 0!==this.myuid&&(a.writeFieldBegin("myuid",Thrift.Type.I64,4),a.writeI64(this.myuid),a.writeFieldEnd()),null!==this.deviceToken&&void 0!==this.deviceToken&&(a.writeFieldBegin("deviceToken",Thrift.Type.STRING,5),a.writeString(this.deviceToken),a.writeFieldEnd()),null!==this.authentication&&void 0!==this.authentication&&(a.writeFieldBegin("authentication",Thrift.Type.STRUCT,10),this.authentication.write(a),a.writeFieldEnd()),null!==this.sync&&void 0!==this.sync&&(a.writeFieldBegin("sync",Thrift.Type.STRUCT,11),this.sync.write(a),a.writeFieldEnd()),null!==this.imSendMessage&&void 0!==this.imSendMessage&&(a.writeFieldBegin("imSendMessage",Thrift.Type.STRUCT,12),this.imSendMessage.write(a),a.writeFieldEnd()),null!==this.imMarkAsRead&&void 0!==this.imMarkAsRead&&(a.writeFieldBegin("imMarkAsRead",Thrift.Type.STRUCT,13),this.imMarkAsRead.write(a),a.writeFieldEnd()),null!==this.imChatHistoryRange&&void 0!==this.imChatHistoryRange&&(a.writeFieldBegin("imChatHistoryRange",Thrift.Type.STRUCT,14),this.imChatHistoryRange.write(a),
a.writeFieldEnd()),null!==this.onlineStatus&&void 0!==this.onlineStatus&&(a.writeFieldBegin("onlineStatus",Thrift.Type.I32,15),a.writeI32(this.onlineStatus),a.writeFieldEnd()),null!==this.onlineStatusQuery&&void 0!==this.onlineStatusQuery&&(a.writeFieldBegin("onlineStatusQuery",Thrift.Type.STRUCT,16),this.onlineStatusQuery.write(a),a.writeFieldEnd()),null!==this.uid&&void 0!==this.uid&&(a.writeFieldBegin("uid",Thrift.Type.I64,17),a.writeI64(this.uid),a.writeFieldEnd()),null!==this.parentUid&&void 0!==this.parentUid&&(a.writeFieldBegin("parentUid",Thrift.Type.I64,18),a.writeI64(this.parentUid),a.writeFieldEnd()),a.writeFieldStop(),a.writeStructEnd()},sjb.messaging.Response=function(a){if(this.version=null,this.type=null,this.responseCode=null,this.errorMsg=null,this.userId=null,this.vtoken=null,this.imUnreads=0,this.imPushData=null,this.imChatHistory=null,this.imOnlineStatus=null,this.chatId=null,this.childUid=null,a){if(void 0===a.version)throw new Thrift.TProtocolException(Thrift.TProtocolExceptionType.UNKNOWN,"Required field version is unset!");if(this.version=a.version,void 0===a.type)throw new Thrift.TProtocolException(Thrift.TProtocolExceptionType.UNKNOWN,"Required field type is unset!");if(this.type=a.type,void 0===a.responseCode)throw new Thrift.TProtocolException(Thrift.TProtocolExceptionType.UNKNOWN,"Required field responseCode is unset!");this.responseCode=a.responseCode,void 0!==a.errorMsg&&(this.errorMsg=a.errorMsg),void 0!==a.userId&&(this.userId=a.userId),void 0!==a.vtoken&&(this.vtoken=a.vtoken),void 0!==a.imUnreads&&(this.imUnreads=a.imUnreads),void 0!==a.imPushData&&(this.imPushData=a.imPushData),void 0!==a.imChatHistory&&(this.imChatHistory=a.imChatHistory),void 0!==a.imOnlineStatus&&(this.imOnlineStatus=a.imOnlineStatus),void 0!==a.chatId&&(this.chatId=a.chatId),void 0!==a.childUid&&(this.childUid=a.childUid)}},sjb.messaging.Response.prototype={},sjb.messaging.Response.prototype.read=function(a){for(a.readStructBegin();;){var b=a.readFieldBegin(),c=(b.fname,b.ftype),d=b.fid;if(c==Thrift.Type.STOP)break;switch(d){case 1:c==Thrift.Type.I32?this.version=a.readI32().value:a.skip(c);break;case 2:c==Thrift.Type.I32?this.type=a.readI32().value:a.skip(c);break;case 3:c==Thrift.Type.I32?this.responseCode=a.readI32().value:a.skip(c);break;case 4:c==Thrift.Type.STRING?this.errorMsg=a.readString().value:a.skip(c);break;case 5:c==Thrift.Type.I64?this.userId=a.readI64().value:a.skip(c);break;case 6:c==Thrift.Type.STRING?this.vtoken=a.readString().value:a.skip(c);break;case 9:c==Thrift.Type.I16?this.imUnreads=a.readI16().value:a.skip(c);break;case 10:c==Thrift.Type.STRUCT?(this.imPushData=new sjb.messaging.im.PushData,this.imPushData.read(a)):a.skip(c);break;case 11:c==Thrift.Type.STRUCT?(this.imChatHistory=new sjb.messaging.im.ChatHistory,this.imChatHistory.read(a)):a.skip(c);break;case 12:c==Thrift.Type.STRUCT?(this.imOnlineStatus=new sjb.messaging.im.SyncOnlineStatus,this.imOnlineStatus.read(a)):a.skip(c);break;case 13:c==Thrift.Type.I64?this.chatId=a.readI64().value:a.skip(c);break;case 14:c==Thrift.Type.I64?this.childUid=a.readI64().value:a.skip(c);break;default:a.skip(c)}a.readFieldEnd()}a.readStructEnd()},sjb.messaging.Response.prototype.write=function(a){a.writeStructBegin("Response"),null!==this.version&&void 0!==this.version&&(a.writeFieldBegin("version",Thrift.Type.I32,1),a.writeI32(this.version),a.writeFieldEnd()),null!==this.type&&void 0!==this.type&&(a.writeFieldBegin("type",Thrift.Type.I32,2),a.writeI32(this.type),a.writeFieldEnd()),null!==this.responseCode&&void 0!==this.responseCode&&(a.writeFieldBegin("responseCode",Thrift.Type.I32,3),a.writeI32(this.responseCode),a.writeFieldEnd()),null!==this.errorMsg&&void 0!==this.errorMsg&&(a.writeFieldBegin("errorMsg",Thrift.Type.STRING,4),a.writeString(this.errorMsg),a.writeFieldEnd()),null!==this.userId&&void 0!==this.userId&&(a.writeFieldBegin("userId",Thrift.Type.I64,5),a.writeI64(this.userId),a.writeFieldEnd()),null!==this.vtoken&&void 0!==this.vtoken&&(a.writeFieldBegin("vtoken",Thrift.Type.STRING,6),a.writeString(this.vtoken),a.writeFieldEnd()),null!==this.imUnreads&&void 0!==this.imUnreads&&(a.writeFieldBegin("imUnreads",Thrift.Type.I16,9),a.writeI16(this.imUnreads),a.writeFieldEnd()),null!==this.imPushData&&void 0!==this.imPushData&&(a.writeFieldBegin("imPushData",Thrift.Type.STRUCT,10),this.imPushData.write(a),a.writeFieldEnd()),null!==this.imChatHistory&&void 0!==this.imChatHistory&&(a.writeFieldBegin("imChatHistory",Thrift.Type.STRUCT,11),this.imChatHistory.write(a),a.writeFieldEnd()),null!==this.imOnlineStatus&&void 0!==this.imOnlineStatus&&(a.writeFieldBegin("imOnlineStatus",Thrift.Type.STRUCT,12),this.imOnlineStatus.write(a),a.writeFieldEnd()),null!==this.chatId&&void 0!==this.chatId&&(a.writeFieldBegin("chatId",Thrift.Type.I64,13),a.writeI64(this.chatId),a.writeFieldEnd()),null!==this.childUid&&void 0!==this.childUid&&(a.writeFieldBegin("childUid",Thrift.Type.I64,14),a.writeI64(this.childUid),a.writeFieldEnd()),a.writeFieldStop(),a.writeStructEnd()},"undefined"==typeof sjb&&(sjb={}),"undefined"==typeof sjb.messaging&&(sjb.messaging={}),"undefined"==typeof sjb.messaging.im&&(sjb.messaging.im={}),sjb.messaging.im.UserType={VISITOR:0,DOYEN:1,SERVICE:2,VENDOR:3,CONSULTANT:4,NORMAL:5},sjb.messaging.im.OnlineStatus={OFFLINE:0,MOBILE_ONLINE:1,WEB_ONLINE:2,WEB_IDLE:3,WEB_BUSY:4},sjb.messaging.im.ChatType={SINGLE:0,GROUP:1},sjb.messaging.im.Message=function(a){if(this.messageId=null,this.content=null,this.deviceType=null,this.utcTimestamp=null,this.senderId=null,this.nsid=null,this.ip=null,this.sign=null,a){if(void 0!==a.messageId&&(this.messageId=a.messageId),void 0===a.content)throw new Thrift.TProtocolException(Thrift.TProtocolExceptionType.UNKNOWN,"Required field content is unset!");this.content=a.content,void 0!==a.deviceType&&(this.deviceType=a.deviceType),void 0!==a.utcTimestamp&&(this.utcTimestamp=a.utcTimestamp),void 0!==a.senderId&&(this.senderId=a.senderId),void 0!==a.nsid&&(this.nsid=a.nsid),void 0!==a.ip&&(this.ip=a.ip),void 0!==a.sign&&(this.sign=a.sign)}},sjb.messaging.im.Message.prototype={},sjb.messaging.im.Message.prototype.read=function(a){for(a.readStructBegin();;){var b=a.readFieldBegin(),c=(b.fname,b.ftype),d=b.fid;if(c==Thrift.Type.STOP)break;switch(d){case 1:c==Thrift.Type.I64?this.messageId=a.readI64().value:a.skip(c);break;case 2:c==Thrift.Type.STRING?this.content=a.readString().value:a.skip(c);break;case 3:c==Thrift.Type.I32?this.deviceType=a.readI32().value:a.skip(c);break;case 4:c==Thrift.Type.I64?this.utcTimestamp=a.readI64().value:a.skip(c);break;case 5:c==Thrift.Type.I64?this.senderId=a.readI64().value:a.skip(c);break;case 6:c==Thrift.Type.STRING?this.nsid=a.readString().value:a.skip(c);break;case 7:c==Thrift.Type.STRING?this.ip=a.readString().value:a.skip(c);break;case 8:c==Thrift.Type.I32?this.sign=a.readI32().value:a.skip(c);break;default:a.skip(c)}a.readFieldEnd()}a.readStructEnd()},sjb.messaging.im.Message.prototype.write=function(a){a.writeStructBegin("Message"),null!==this.messageId&&void 0!==this.messageId&&(a.writeFieldBegin("messageId",Thrift.Type.I64,1),a.writeI64(this.messageId),a.writeFieldEnd()),null!==this.content&&void 0!==this.content&&(a.writeFieldBegin("content",Thrift.Type.STRING,2),a.writeString(this.content),a.writeFieldEnd()),null!==this.deviceType&&void 0!==this.deviceType&&(a.writeFieldBegin("deviceType",Thrift.Type.I32,3),a.writeI32(this.deviceType),a.writeFieldEnd()),null!==this.utcTimestamp&&void 0!==this.utcTimestamp&&(a.writeFieldBegin("utcTimestamp",Thrift.Type.I64,4),a.writeI64(this.utcTimestamp),a.writeFieldEnd()),null!==this.senderId&&void 0!==this.senderId&&(a.writeFieldBegin("senderId",Thrift.Type.I64,5),a.writeI64(this.senderId),a.writeFieldEnd()),null!==this.nsid&&void 0!==this.nsid&&(a.writeFieldBegin("nsid",Thrift.Type.STRING,6),a.writeString(this.nsid),a.writeFieldEnd()),null!==this.ip&&void 0!==this.ip&&(a.writeFieldBegin("ip",Thrift.Type.STRING,7),a.writeString(this.ip),a.writeFieldEnd()),null!==this.sign&&void 0!==this.sign&&(a.writeFieldBegin("sign",Thrift.Type.I32,8),a.writeI32(this.sign),a.writeFieldEnd()),a.writeFieldStop(),a.writeStructEnd()},sjb.messaging.im.SendMessage=function(a){if(this.chatId=null,this.message=null,a){if(void 0===a.chatId)throw new Thrift.TProtocolException(Thrift.TProtocolExceptionType.UNKNOWN,"Required field chatId is unset!");if(this.chatId=a.chatId,void 0===a.message)throw new Thrift.TProtocolException(Thrift.TProtocolExceptionType.UNKNOWN,"Required field message is unset!");this.message=a.message}},sjb.messaging.im.SendMessage.prototype={},sjb.messaging.im.SendMessage.prototype.read=function(a){for(a.readStructBegin();;){var b=a.readFieldBegin(),c=(b.fname,b.ftype),d=b.fid;if(c==Thrift.Type.STOP)break;switch(d){case 1:c==Thrift.Type.I64?this.chatId=a.readI64().value:a.skip(c);break;case 2:c==Thrift.Type.STRUCT?(this.message=new sjb.messaging.im.Message,this.message.read(a)):a.skip(c);break;default:a.skip(c)}a.readFieldEnd()}a.readStructEnd()},sjb.messaging.im.SendMessage.prototype.write=function(a){a.writeStructBegin("SendMessage"),null!==this.chatId&&void 0!==this.chatId&&(a.writeFieldBegin("chatId",Thrift.Type.I64,1),a.writeI64(this.chatId),a.writeFieldEnd()),null!==this.message&&void 0!==this.message&&(a.writeFieldBegin("message",Thrift.Type.STRUCT,2),this.message.write(a),a.writeFieldEnd()),a.writeFieldStop(),a.writeStructEnd()},sjb.messaging.im.MarkAsRead=function(a){if(this.chatId=null,this.messageId=null,a){if(void 0===a.chatId)throw new Thrift.TProtocolException(Thrift.TProtocolExceptionType.UNKNOWN,"Required field chatId is unset!");if(this.chatId=a.chatId,void 0===a.messageId)throw new Thrift.TProtocolException(Thrift.TProtocolExceptionType.UNKNOWN,"Required field messageId is unset!");this.messageId=a.messageId}},sjb.messaging.im.MarkAsRead.prototype={},sjb.messaging.im.MarkAsRead.prototype.read=function(a){for(a.readStructBegin();;){var b=a.readFieldBegin(),c=(b.fname,b.ftype),d=b.fid;if(c==Thrift.Type.STOP)break;switch(d){case 1:c==Thrift.Type.I64?this.chatId=a.readI64().value:a.skip(c);break;case 2:c==Thrift.Type.I64?this.messageId=a.readI64().value:a.skip(c);break;default:a.skip(c)}a.readFieldEnd()}a.readStructEnd()},sjb.messaging.im.MarkAsRead.prototype.write=function(a){a.writeStructBegin("MarkAsRead"),null!==this.chatId&&void 0!==this.chatId&&(a.writeFieldBegin("chatId",Thrift.Type.I64,1),a.writeI64(this.chatId),a.writeFieldEnd()),null!==this.messageId&&void 0!==this.messageId&&(a.writeFieldBegin("messageId",Thrift.Type.I64,2),a.writeI64(this.messageId),a.writeFieldEnd()),a.writeFieldStop(),a.writeStructEnd()},sjb.messaging.im.ChatHistoryRange=function(a){if(this.chatId=null,this.startId=null,this.endId=null,a){if(void 0===a.chatId)throw new Thrift.TProtocolException(Thrift.TProtocolExceptionType.UNKNOWN,"Required field chatId is unset!");if(this.chatId=a.chatId,void 0===a.startId)throw new Thrift.TProtocolException(Thrift.TProtocolExceptionType.UNKNOWN,"Required field startId is unset!");if(this.startId=a.startId,void 0===a.endId)throw new Thrift.TProtocolException(Thrift.TProtocolExceptionType.UNKNOWN,"Required field endId is unset!");this.endId=a.endId}},sjb.messaging.im.ChatHistoryRange.prototype={},sjb.messaging.im.ChatHistoryRange.prototype.read=function(a){for(a.readStructBegin();;){var b=a.readFieldBegin(),c=(b.fname,b.ftype),d=b.fid;if(c==Thrift.Type.STOP)break;switch(d){case 1:c==Thrift.Type.I64?this.chatId=a.readI64().value:a.skip(c);break;case 2:c==Thrift.Type.I64?this.startId=a.readI64().value:a.skip(c);break;case 3:c==Thrift.Type.I64?this.endId=a.readI64().value:a.skip(c);break;default:a.skip(c)}a.readFieldEnd()}a.readStructEnd()},sjb.messaging.im.ChatHistoryRange.prototype.write=function(a){a.writeStructBegin("ChatHistoryRange"),null!==this.chatId&&void 0!==this.chatId&&(a.writeFieldBegin("chatId",Thrift.Type.I64,1),a.writeI64(this.chatId),a.writeFieldEnd()),null!==this.startId&&void 0!==this.startId&&(a.writeFieldBegin("startId",Thrift.Type.I64,2),a.writeI64(this.startId),a.writeFieldEnd()),null!==this.endId&&void 0!==this.endId&&(a.writeFieldBegin("endId",Thrift.Type.I64,3),a.writeI64(this.endId),a.writeFieldEnd()),a.writeFieldStop(),a.writeStructEnd()},sjb.messaging.im.UserTypeInfo=function(a){if(this.name=null,this.iconUrl=null,a){if(void 0===a.name)throw new Thrift.TProtocolException(Thrift.TProtocolExceptionType.UNKNOWN,"Required field name is unset!");if(this.name=a.name,void 0===a.iconUrl)throw new Thrift.TProtocolException(Thrift.TProtocolExceptionType.UNKNOWN,"Required field iconUrl is unset!");this.iconUrl=a.iconUrl}},sjb.messaging.im.UserTypeInfo.prototype={},sjb.messaging.im.UserTypeInfo.prototype.read=function(a){for(a.readStructBegin();;){var b=a.readFieldBegin(),c=(b.fname,b.ftype),d=b.fid;if(c==Thrift.Type.STOP)break;switch(d){case 1:c==Thrift.Type.STRING?this.name=a.readString().value:a.skip(c);break;case 2:c==Thrift.Type.STRING?this.iconUrl=a.readString().value:a.skip(c);break;default:a.skip(c)}a.readFieldEnd()}a.readStructEnd()},sjb.messaging.im.UserTypeInfo.prototype.write=function(a){a.writeStructBegin("UserTypeInfo"),null!==this.name&&void 0!==this.name&&(a.writeFieldBegin("name",Thrift.Type.STRING,1),a.writeString(this.name),a.writeFieldEnd()),null!==this.iconUrl&&void 0!==this.iconUrl&&(a.writeFieldBegin("iconUrl",Thrift.Type.STRING,2),a.writeString(this.iconUrl),a.writeFieldEnd()),a.writeFieldStop(),a.writeStructEnd()},sjb.messaging.im.OnlineStatusQuery=function(a){if(this.isParentAccount=null,this.uids=null,a){if(void 0===a.isParentAccount)throw new Thrift.TProtocolException(Thrift.TProtocolExceptionType.UNKNOWN,"Required field isParentAccount is unset!");if(this.isParentAccount=a.isParentAccount,void 0===a.uids)throw new Thrift.TProtocolException(Thrift.TProtocolExceptionType.UNKNOWN,"Required field uids is unset!");this.uids=a.uids}},sjb.messaging.im.OnlineStatusQuery.prototype={},sjb.messaging.im.OnlineStatusQuery.prototype.read=function(a){for(a.readStructBegin();;){var b=a.readFieldBegin(),c=(b.fname,b.ftype),d=b.fid;if(c==Thrift.Type.STOP)break;switch(d){case 1:c==Thrift.Type.BOOL?this.isParentAccount=a.readBool().value:a.skip(c);break;case 2:if(c==Thrift.Type.LIST){var e,f=0;this.uids=[];var g=0;e=a.readListBegin(),g=e.etype,f=e.size;for(var h=0;f>h;++h){var i=null;i=a.readI64().value,this.uids.push(i)}a.readListEnd()}else a.skip(c);break;default:a.skip(c)}a.readFieldEnd()}a.readStructEnd()},sjb.messaging.im.OnlineStatusQuery.prototype.write=function(a){if(a.writeStructBegin("OnlineStatusQuery"),null!==this.isParentAccount&&void 0!==this.isParentAccount&&(a.writeFieldBegin("isParentAccount",Thrift.Type.BOOL,1),a.writeBool(this.isParentAccount),a.writeFieldEnd()),null!==this.uids&&void 0!==this.uids){a.writeFieldBegin("uids",Thrift.Type.LIST,2),a.writeListBegin(Thrift.Type.I64,this.uids.length);for(var b in this.uids)this.uids.hasOwnProperty(b)&&(b=this.uids[b],a.writeI64(b));a.writeListEnd(),a.writeFieldEnd()}a.writeFieldStop(),a.writeStructEnd()},sjb.messaging.im.User=function(a){if(this.type=null,this.nickname=null,this.iconUrl=null,this.onlineStatus=0,a){if(void 0===a.type)throw new Thrift.TProtocolException(Thrift.TProtocolExceptionType.UNKNOWN,"Required field type is unset!");if(this.type=a.type,void 0===a.nickname)throw new Thrift.TProtocolException(Thrift.TProtocolExceptionType.UNKNOWN,"Required field nickname is unset!");if(this.nickname=a.nickname,void 0===a.iconUrl)throw new Thrift.TProtocolException(Thrift.TProtocolExceptionType.UNKNOWN,"Required field iconUrl is unset!");this.iconUrl=a.iconUrl,void 0!==a.onlineStatus&&(this.onlineStatus=a.onlineStatus)}},sjb.messaging.im.User.prototype={},sjb.messaging.im.User.prototype.read=function(a){for(a.readStructBegin();;){var b=a.readFieldBegin(),c=(b.fname,b.ftype),d=b.fid;if(c==Thrift.Type.STOP)break;switch(d){case 1:c==Thrift.Type.I32?this.type=a.readI32().value:a.skip(c);break;case 2:c==Thrift.Type.STRING?this.nickname=a.readString().value:a.skip(c);break;case 3:c==Thrift.Type.STRING?this.iconUrl=a.readString().value:a.skip(c);break;case 4:c==Thrift.Type.I32?this.onlineStatus=a.readI32().value:a.skip(c);break;default:a.skip(c)}a.readFieldEnd()}a.readStructEnd()},sjb.messaging.im.User.prototype.write=function(a){a.writeStructBegin("User"),null!==this.type&&void 0!==this.type&&(a.writeFieldBegin("type",Thrift.Type.I32,1),a.writeI32(this.type),a.writeFieldEnd()),null!==this.nickname&&void 0!==this.nickname&&(a.writeFieldBegin("nickname",Thrift.Type.STRING,2),a.writeString(this.nickname),a.writeFieldEnd()),null!==this.iconUrl&&void 0!==this.iconUrl&&(a.writeFieldBegin("iconUrl",Thrift.Type.STRING,3),a.writeString(this.iconUrl),a.writeFieldEnd()),null!==this.onlineStatus&&void 0!==this.onlineStatus&&(a.writeFieldBegin("onlineStatus",Thrift.Type.I32,4),a.writeI32(this.onlineStatus),a.writeFieldEnd()),a.writeFieldStop(),a.writeStructEnd()},sjb.messaging.im.ChatInfo=function(a){if(this.uids=null,this.type=null,this.name=null,a){if(void 0===a.uids)throw new Thrift.TProtocolException(Thrift.TProtocolExceptionType.UNKNOWN,"Required field uids is unset!");if(this.uids=a.uids,void 0===a.type)throw new Thrift.TProtocolException(Thrift.TProtocolExceptionType.UNKNOWN,"Required field type is unset!");this.type=a.type,void 0!==a.name&&(this.name=a.name)}},sjb.messaging.im.ChatInfo.prototype={},sjb.messaging.im.ChatInfo.prototype.read=function(a){for(a.readStructBegin();;){var b=a.readFieldBegin(),c=(b.fname,b.ftype),d=b.fid;if(c==Thrift.Type.STOP)break;switch(d){case 1:if(c==Thrift.Type.LIST){var e,f=0;this.uids=[];var g=0;e=a.readListBegin(),g=e.etype,f=e.size;for(var h=0;f>h;++h){var i=null;i=a.readI64().value,this.uids.push(i)}a.readListEnd()}else a.skip(c);break;case 2:c==Thrift.Type.I32?this.type=a.readI32().value:a.skip(c);break;case 3:c==Thrift.Type.STRING?this.name=a.readString().value:a.skip(c);break;default:a.skip(c)}a.readFieldEnd()}a.readStructEnd()},sjb.messaging.im.ChatInfo.prototype.write=function(a){if(a.writeStructBegin("ChatInfo"),null!==this.uids&&void 0!==this.uids){a.writeFieldBegin("uids",Thrift.Type.LIST,1),a.writeListBegin(Thrift.Type.I64,this.uids.length);for(var b in this.uids)this.uids.hasOwnProperty(b)&&(b=this.uids[b],a.writeI64(b));a.writeListEnd(),a.writeFieldEnd()}null!==this.type&&void 0!==this.type&&(a.writeFieldBegin("type",Thrift.Type.I32,2),a.writeI32(this.type),a.writeFieldEnd()),null!==this.name&&void 0!==this.name&&(a.writeFieldBegin("name",Thrift.Type.STRING,3),a.writeString(this.name),a.writeFieldEnd()),a.writeFieldStop(),a.writeStructEnd()},sjb.messaging.im.MessageState=function(a){if(this.maxMessageId=null,this.lastReadId=null,this.lastMsgTime=null,a){if(void 0===a.maxMessageId)throw new Thrift.TProtocolException(Thrift.TProtocolExceptionType.UNKNOWN,"Required field maxMessageId is unset!");if(this.maxMessageId=a.maxMessageId,void 0===a.lastReadId)throw new Thrift.TProtocolException(Thrift.TProtocolExceptionType.UNKNOWN,"Required field lastReadId is unset!");this.lastReadId=a.lastReadId,void 0!==a.lastMsgTime&&(this.lastMsgTime=a.lastMsgTime)}},sjb.messaging.im.MessageState.prototype={},sjb.messaging.im.MessageState.prototype.read=function(a){for(a.readStructBegin();;){var b=a.readFieldBegin(),c=(b.fname,b.ftype),d=b.fid;if(c==Thrift.Type.STOP)break;switch(d){case 1:c==Thrift.Type.I64?this.maxMessageId=a.readI64().value:a.skip(c);break;case 2:c==Thrift.Type.I64?this.lastReadId=a.readI64().value:a.skip(c);break;case 3:c==Thrift.Type.I64?this.lastMsgTime=a.readI64().value:a.skip(c);break;default:a.skip(c)}a.readFieldEnd()}a.readStructEnd()},sjb.messaging.im.MessageState.prototype.write=function(a){a.writeStructBegin("MessageState"),null!==this.maxMessageId&&void 0!==this.maxMessageId&&(a.writeFieldBegin("maxMessageId",Thrift.Type.I64,1),a.writeI64(this.maxMessageId),a.writeFieldEnd()),null!==this.lastReadId&&void 0!==this.lastReadId&&(a.writeFieldBegin("lastReadId",Thrift.Type.I64,2),a.writeI64(this.lastReadId),a.writeFieldEnd()),null!==this.lastMsgTime&&void 0!==this.lastMsgTime&&(a.writeFieldBegin("lastMsgTime",Thrift.Type.I64,3),a.writeI64(this.lastMsgTime),a.writeFieldEnd()),a.writeFieldStop(),a.writeStructEnd()},sjb.messaging.im.Chat=function(a){if(this.chatId=null,this.chatInfo=null,this.messageState=null,a){if(void 0===a.chatId)throw new Thrift.TProtocolException(Thrift.TProtocolExceptionType.UNKNOWN,"Required field chatId is unset!");this.chatId=a.chatId,void 0!==a.chatInfo&&(this.chatInfo=a.chatInfo),void 0!==a.messageState&&(this.messageState=a.messageState)}},sjb.messaging.im.Chat.prototype={},sjb.messaging.im.Chat.prototype.read=function(a){for(a.readStructBegin();;){var b=a.readFieldBegin(),c=(b.fname,b.ftype),d=b.fid;if(c==Thrift.Type.STOP)break;switch(d){case 1:c==Thrift.Type.I64?this.chatId=a.readI64().value:a.skip(c);break;case 2:c==Thrift.Type.STRUCT?(this.chatInfo=new sjb.messaging.im.ChatInfo,this.chatInfo.read(a)):a.skip(c);break;case 3:c==Thrift.Type.STRUCT?(this.messageState=new sjb.messaging.im.MessageState,this.messageState.read(a)):a.skip(c);break;default:a.skip(c)}a.readFieldEnd()}a.readStructEnd()},sjb.messaging.im.Chat.prototype.write=function(a){a.writeStructBegin("Chat"),null!==this.chatId&&void 0!==this.chatId&&(a.writeFieldBegin("chatId",Thrift.Type.I64,1),a.writeI64(this.chatId),a.writeFieldEnd()),null!==this.chatInfo&&void 0!==this.chatInfo&&(a.writeFieldBegin("chatInfo",Thrift.Type.STRUCT,2),this.chatInfo.write(a),a.writeFieldEnd()),null!==this.messageState&&void 0!==this.messageState&&(a.writeFieldBegin("messageState",Thrift.Type.STRUCT,3),this.messageState.write(a),a.writeFieldEnd()),a.writeFieldStop(),a.writeStructEnd()},sjb.messaging.im.ChatHistory=function(a){if(this.chatId=null,this.messages=null,a){if(void 0===a.chatId)throw new Thrift.TProtocolException(Thrift.TProtocolExceptionType.UNKNOWN,"Required field chatId is unset!");if(this.chatId=a.chatId,void 0===a.messages)throw new Thrift.TProtocolException(Thrift.TProtocolExceptionType.UNKNOWN,"Required field messages is unset!");this.messages=a.messages}},sjb.messaging.im.ChatHistory.prototype={},sjb.messaging.im.ChatHistory.prototype.read=function(a){for(a.readStructBegin();;){var b=a.readFieldBegin(),c=(b.fname,b.ftype),d=b.fid;if(c==Thrift.Type.STOP)break;switch(d){case 1:c==Thrift.Type.I64?this.chatId=a.readI64().value:a.skip(c);break;case 2:if(c==Thrift.Type.LIST){var e,f=0;this.messages=[];var g=0;e=a.readListBegin(),g=e.etype,f=e.size;for(var h=0;f>h;++h){var i=null;i=new sjb.messaging.im.Message,i.read(a),this.messages.push(i)}a.readListEnd()}else a.skip(c);break;default:a.skip(c)}a.readFieldEnd()}a.readStructEnd()},sjb.messaging.im.ChatHistory.prototype.write=function(a){if(a.writeStructBegin("ChatHistory"),null!==this.chatId&&void 0!==this.chatId&&(a.writeFieldBegin("chatId",Thrift.Type.I64,1),a.writeI64(this.chatId),a.writeFieldEnd()),null!==this.messages&&void 0!==this.messages){a.writeFieldBegin("messages",Thrift.Type.LIST,2),a.writeListBegin(Thrift.Type.STRUCT,this.messages.length);for(var b in this.messages)this.messages.hasOwnProperty(b)&&(b=this.messages[b],b.write(a));a.writeListEnd(),a.writeFieldEnd()}a.writeFieldStop(),a.writeStructEnd()},sjb.messaging.im.ChatUnread=function(a){if(this.chatId=null,this.messageState=null,this.message=null,a){if(void 0===a.chatId)throw new Thrift.TProtocolException(Thrift.TProtocolExceptionType.UNKNOWN,"Required field chatId is unset!");if(this.chatId=a.chatId,void 0===a.messageState)throw new Thrift.TProtocolException(Thrift.TProtocolExceptionType.UNKNOWN,"Required field messageState is unset!");this.messageState=a.messageState,void 0!==a.message&&(this.message=a.message)}},sjb.messaging.im.ChatUnread.prototype={},sjb.messaging.im.ChatUnread.prototype.read=function(a){for(a.readStructBegin();;){var b=a.readFieldBegin(),c=(b.fname,b.ftype),d=b.fid;if(c==Thrift.Type.STOP)break;switch(d){case 1:c==Thrift.Type.I64?this.chatId=a.readI64().value:a.skip(c);break;case 2:c==Thrift.Type.STRUCT?(this.messageState=new sjb.messaging.im.MessageState,this.messageState.read(a)):a.skip(c);break;case 3:c==Thrift.Type.STRUCT?(this.message=new sjb.messaging.im.Message,this.message.read(a)):a.skip(c);break;default:a.skip(c)}a.readFieldEnd()}a.readStructEnd()},sjb.messaging.im.ChatUnread.prototype.write=function(a){a.writeStructBegin("ChatUnread"),null!==this.chatId&&void 0!==this.chatId&&(a.writeFieldBegin("chatId",Thrift.Type.I64,1),a.writeI64(this.chatId),a.writeFieldEnd()),null!==this.messageState&&void 0!==this.messageState&&(a.writeFieldBegin("messageState",Thrift.Type.STRUCT,2),this.messageState.write(a),a.writeFieldEnd()),null!==this.message&&void 0!==this.message&&(a.writeFieldBegin("message",Thrift.Type.STRUCT,3),this.message.write(a),a.writeFieldEnd()),a.writeFieldStop(),a.writeStructEnd()},sjb.messaging.im.SyncUnreadCounter=function(a){if(this.unreadState=null,this.lastUnreadState=null,this.unreadCounter=null,a){if(void 0===a.unreadState)throw new Thrift.TProtocolException(Thrift.TProtocolExceptionType.UNKNOWN,"Required field unreadState is unset!");if(this.unreadState=a.unreadState,void 0===a.lastUnreadState)throw new Thrift.TProtocolException(Thrift.TProtocolExceptionType.UNKNOWN,"Required field lastUnreadState is unset!");if(this.lastUnreadState=a.lastUnreadState,void 0===a.unreadCounter)throw new Thrift.TProtocolException(Thrift.TProtocolExceptionType.UNKNOWN,"Required field unreadCounter is unset!");this.unreadCounter=a.unreadCounter}},sjb.messaging.im.SyncUnreadCounter.prototype={},sjb.messaging.im.SyncUnreadCounter.prototype.read=function(a){for(a.readStructBegin();;){var b=a.readFieldBegin(),c=(b.fname,b.ftype),d=b.fid;if(c==Thrift.Type.STOP)break;switch(d){case 1:c==Thrift.Type.I64?this.unreadState=a.readI64().value:a.skip(c);break;case 2:c==Thrift.Type.I64?this.lastUnreadState=a.readI64().value:a.skip(c);break;case 3:c==Thrift.Type.I16?this.unreadCounter=a.readI16().value:a.skip(c);break;default:a.skip(c)}a.readFieldEnd()}a.readStructEnd()},sjb.messaging.im.SyncUnreadCounter.prototype.write=function(a){a.writeStructBegin("SyncUnreadCounter"),null!==this.unreadState&&void 0!==this.unreadState&&(a.writeFieldBegin("unreadState",Thrift.Type.I64,1),a.writeI64(this.unreadState),a.writeFieldEnd()),null!==this.lastUnreadState&&void 0!==this.lastUnreadState&&(a.writeFieldBegin("lastUnreadState",Thrift.Type.I64,2),a.writeI64(this.lastUnreadState),a.writeFieldEnd()),null!==this.unreadCounter&&void 0!==this.unreadCounter&&(a.writeFieldBegin("unreadCounter",Thrift.Type.I16,3),a.writeI16(this.unreadCounter),a.writeFieldEnd()),a.writeFieldStop(),a.writeStructEnd()},sjb.messaging.im.SyncMessageState=function(a){if(this.chats=null,a){if(void 0===a.chats)throw new Thrift.TProtocolException(Thrift.TProtocolExceptionType.UNKNOWN,"Required field chats is unset!");this.chats=a.chats}},sjb.messaging.im.SyncMessageState.prototype={},sjb.messaging.im.SyncMessageState.prototype.read=function(a){for(a.readStructBegin();;){var b=a.readFieldBegin(),c=(b.fname,b.ftype),d=b.fid;if(c==Thrift.Type.STOP)break;switch(d){case 1:if(c==Thrift.Type.LIST){var e,f=0;this.chats=[];var g=0;e=a.readListBegin(),g=e.etype,f=e.size;for(var h=0;f>h;++h){var i=null;i=new sjb.messaging.im.Chat,i.read(a),this.chats.push(i)}a.readListEnd()}else a.skip(c);break;case 0:a.skip(c);break;default:a.skip(c)}a.readFieldEnd()}a.readStructEnd()},sjb.messaging.im.SyncMessageState.prototype.write=function(a){if(a.writeStructBegin("SyncMessageState"),null!==this.chats&&void 0!==this.chats){a.writeFieldBegin("chats",Thrift.Type.LIST,1),a.writeListBegin(Thrift.Type.STRUCT,this.chats.length);for(var b in this.chats)this.chats.hasOwnProperty(b)&&(b=this.chats[b],b.write(a));a.writeListEnd(),a.writeFieldEnd()}a.writeFieldStop(),a.writeStructEnd()},sjb.messaging.im.SyncChatList=function(a){if(this.chatListState=null,this.lastChatListState=null,this.chatUpdated=null,this.users=null,this.chatIds=null,this.chats=null,a){if(void 0===a.chatListState)throw new Thrift.TProtocolException(Thrift.TProtocolExceptionType.UNKNOWN,"Required field chatListState is unset!");if(this.chatListState=a.chatListState,void 0===a.lastChatListState)throw new Thrift.TProtocolException(Thrift.TProtocolExceptionType.UNKNOWN,"Required field lastChatListState is unset!");if(this.lastChatListState=a.lastChatListState,void 0===a.chatUpdated)throw new Thrift.TProtocolException(Thrift.TProtocolExceptionType.UNKNOWN,"Required field chatUpdated is unset!");this.chatUpdated=a.chatUpdated,void 0!==a.users&&(this.users=a.users),void 0!==a.chatIds&&(this.chatIds=a.chatIds),void 0!==a.chats&&(this.chats=a.chats)}},sjb.messaging.im.SyncChatList.prototype={},sjb.messaging.im.SyncChatList.prototype.read=function(a){for(a.readStructBegin();;){var b=a.readFieldBegin(),c=(b.fname,b.ftype),d=b.fid;if(c==Thrift.Type.STOP)break;switch(d){case 1:c==Thrift.Type.I64?this.chatListState=a.readI64().value:a.skip(c);break;case 2:c==Thrift.Type.I64?this.lastChatListState=a.readI64().value:a.skip(c);break;case 3:c==Thrift.Type.BOOL?this.chatUpdated=a.readBool().value:a.skip(c);break;case 4:if(c==Thrift.Type.MAP){var e,f=0;this.users={};var g=0,h=0;e=a.readMapBegin(),g=e.ktype,h=e.vtype,f=e.size;for(var i=0;f>i;++i){i>0&&a.rstack.length>a.rpos[a.rpos.length-1]+1&&a.rstack.pop();var j=null,k=null;j=a.readI64().value,k=new sjb.messaging.im.User,k.read(a),this.users[j]=k}a.readMapEnd()}else a.skip(c);break;case 5:if(c==Thrift.Type.LIST){var l,m=0;this.chatIds=[];var n=0;l=a.readListBegin(),n=l.etype,m=l.size;for(var o=0;m>o;++o){var p=null;p=a.readI64().value,this.chatIds.push(p)}a.readListEnd()}else a.skip(c);break;case 6:if(c==Thrift.Type.LIST){var q,r=0;this.chats=[];var s=0;q=a.readListBegin(),s=q.etype,r=q.size;for(var t=0;r>t;++t){var u=null;u=new sjb.messaging.im.Chat,u.read(a),this.chats.push(u)}a.readListEnd()}else a.skip(c);break;default:a.skip(c)}a.readFieldEnd()}a.readStructEnd()},sjb.messaging.im.SyncChatList.prototype.write=function(a){if(a.writeStructBegin("SyncChatList"),null!==this.chatListState&&void 0!==this.chatListState&&(a.writeFieldBegin("chatListState",Thrift.Type.I64,1),a.writeI64(this.chatListState),a.writeFieldEnd()),null!==this.lastChatListState&&void 0!==this.lastChatListState&&(a.writeFieldBegin("lastChatListState",Thrift.Type.I64,2),a.writeI64(this.lastChatListState),a.writeFieldEnd()),null!==this.chatUpdated&&void 0!==this.chatUpdated&&(a.writeFieldBegin("chatUpdated",Thrift.Type.BOOL,3),a.writeBool(this.chatUpdated),a.writeFieldEnd()),null!==this.users&&void 0!==this.users){a.writeFieldBegin("users",Thrift.Type.MAP,4),a.writeMapBegin(Thrift.Type.I64,Thrift.Type.STRUCT,Thrift.objectLength(this.users));for(var b in this.users)if(this.users.hasOwnProperty(b)){var c=this.users[b];a.writeI64(b),c.write(a)}a.writeMapEnd(),a.writeFieldEnd()}if(null!==this.chatIds&&void 0!==this.chatIds){a.writeFieldBegin("chatIds",Thrift.Type.LIST,5),a.writeListBegin(Thrift.Type.I64,this.chatIds.length);for(var d in this.chatIds)this.chatIds.hasOwnProperty(d)&&(d=this.chatIds[d],a.writeI64(d));a.writeListEnd(),a.writeFieldEnd()}if(null!==this.chats&&void 0!==this.chats){a.writeFieldBegin("chats",Thrift.Type.LIST,6),a.writeListBegin(Thrift.Type.STRUCT,this.chats.length);for(var e in this.chats)this.chats.hasOwnProperty(e)&&(e=this.chats[e],e.write(a));a.writeListEnd(),a.writeFieldEnd()}a.writeFieldStop(),a.writeStructEnd()},sjb.messaging.im.SyncOnlineStatus=function(a){if(this.onlineState=null,this.lastOnlineState=null,this.users=null,a){if(void 0===a.onlineState)throw new Thrift.TProtocolException(Thrift.TProtocolExceptionType.UNKNOWN,"Required field onlineState is unset!");if(this.onlineState=a.onlineState,void 0===a.lastOnlineState)throw new Thrift.TProtocolException(Thrift.TProtocolExceptionType.UNKNOWN,"Required field lastOnlineState is unset!");this.lastOnlineState=a.lastOnlineState,void 0!==a.users&&(this.users=a.users)}},sjb.messaging.im.SyncOnlineStatus.prototype={},sjb.messaging.im.SyncOnlineStatus.prototype.read=function(a){for(a.readStructBegin();;){var b=a.readFieldBegin(),c=(b.fname,b.ftype),d=b.fid;if(c==Thrift.Type.STOP)break;
switch(d){case 1:c==Thrift.Type.I64?this.onlineState=a.readI64().value:a.skip(c);break;case 2:c==Thrift.Type.I64?this.lastOnlineState=a.readI64().value:a.skip(c);break;case 3:if(c==Thrift.Type.MAP){var e,f=0;this.users={};var g=0,h=0;e=a.readMapBegin(),g=e.ktype,h=e.vtype,f=e.size;for(var i=0;f>i;++i){i>0&&a.rstack.length>a.rpos[a.rpos.length-1]+1&&a.rstack.pop();var j=null,k=null;j=a.readI64().value,k=a.readI32().value,this.users[j]=k}a.readMapEnd()}else a.skip(c);break;default:a.skip(c)}a.readFieldEnd()}a.readStructEnd()},sjb.messaging.im.SyncOnlineStatus.prototype.write=function(a){if(a.writeStructBegin("SyncOnlineStatus"),null!==this.onlineState&&void 0!==this.onlineState&&(a.writeFieldBegin("onlineState",Thrift.Type.I64,1),a.writeI64(this.onlineState),a.writeFieldEnd()),null!==this.lastOnlineState&&void 0!==this.lastOnlineState&&(a.writeFieldBegin("lastOnlineState",Thrift.Type.I64,2),a.writeI64(this.lastOnlineState),a.writeFieldEnd()),null!==this.users&&void 0!==this.users){a.writeFieldBegin("users",Thrift.Type.MAP,3),a.writeMapBegin(Thrift.Type.I64,Thrift.Type.I32,Thrift.objectLength(this.users));for(var b in this.users)if(this.users.hasOwnProperty(b)){var c=this.users[b];a.writeI64(b),a.writeI32(c)}a.writeMapEnd(),a.writeFieldEnd()}a.writeFieldStop(),a.writeStructEnd()},sjb.messaging.im.PushData=function(a){this.chatUnread=null,this.syncUnreadCounter=null,this.syncMessageState=null,this.syncChatList=null,this.syncOnlineStatus=null,a&&(void 0!==a.chatUnread&&(this.chatUnread=a.chatUnread),void 0!==a.syncUnreadCounter&&(this.syncUnreadCounter=a.syncUnreadCounter),void 0!==a.syncMessageState&&(this.syncMessageState=a.syncMessageState),void 0!==a.syncChatList&&(this.syncChatList=a.syncChatList),void 0!==a.syncOnlineStatus&&(this.syncOnlineStatus=a.syncOnlineStatus))},sjb.messaging.im.PushData.prototype={},sjb.messaging.im.PushData.prototype.read=function(a){for(a.readStructBegin();;){var b=a.readFieldBegin(),c=(b.fname,b.ftype),d=b.fid;if(c==Thrift.Type.STOP)break;switch(d){case 1:c==Thrift.Type.STRUCT?(this.chatUnread=new sjb.messaging.im.ChatUnread,this.chatUnread.read(a)):a.skip(c);break;case 2:c==Thrift.Type.STRUCT?(this.syncUnreadCounter=new sjb.messaging.im.SyncUnreadCounter,this.syncUnreadCounter.read(a)):a.skip(c);break;case 3:c==Thrift.Type.STRUCT?(this.syncMessageState=new sjb.messaging.im.SyncMessageState,this.syncMessageState.read(a)):a.skip(c);break;case 4:c==Thrift.Type.STRUCT?(this.syncChatList=new sjb.messaging.im.SyncChatList,this.syncChatList.read(a)):a.skip(c);break;case 5:c==Thrift.Type.STRUCT?(this.syncOnlineStatus=new sjb.messaging.im.SyncOnlineStatus,this.syncOnlineStatus.read(a)):a.skip(c);break;default:a.skip(c)}a.readFieldEnd()}a.readStructEnd()},sjb.messaging.im.PushData.prototype.write=function(a){a.writeStructBegin("PushData"),null!==this.chatUnread&&void 0!==this.chatUnread&&(a.writeFieldBegin("chatUnread",Thrift.Type.STRUCT,1),this.chatUnread.write(a),a.writeFieldEnd()),null!==this.syncUnreadCounter&&void 0!==this.syncUnreadCounter&&(a.writeFieldBegin("syncUnreadCounter",Thrift.Type.STRUCT,2),this.syncUnreadCounter.write(a),a.writeFieldEnd()),null!==this.syncMessageState&&void 0!==this.syncMessageState&&(a.writeFieldBegin("syncMessageState",Thrift.Type.STRUCT,3),this.syncMessageState.write(a),a.writeFieldEnd()),null!==this.syncChatList&&void 0!==this.syncChatList&&(a.writeFieldBegin("syncChatList",Thrift.Type.STRUCT,4),this.syncChatList.write(a),a.writeFieldEnd()),null!==this.syncOnlineStatus&&void 0!==this.syncOnlineStatus&&(a.writeFieldBegin("syncOnlineStatus",Thrift.Type.STRUCT,5),this.syncOnlineStatus.write(a),a.writeFieldEnd()),a.writeFieldStop(),a.writeStructEnd()},sjb.messaging.im.USER_TYPE_MAP={1:new sjb.messaging.im.UserTypeInfo({name:"",iconUrl:"//f4.sjbly.cn/f15/0311/1517/im_id_doyen-qze.png"}),2:new sjb.messaging.im.UserTypeInfo({name:"",iconUrl:"//f4.sjbly.cn/f15/0311/1517/im_id_service-lgq.png"}),3:new sjb.messaging.im.UserTypeInfo({name:"",iconUrl:"//f4.sjbly.cn/f15/0311/1517/im_id_vendor-dna.png"}),4:new sjb.messaging.im.UserTypeInfo({name:"",iconUrl:"//f4.sjbly.cn/f15/0311/1517/im_id_consultant-hcx.png"})},function(a){"use strict";Array.prototype.last=function(){return this[this.length-1]},"undefined"==typeof Date.now&&(Date.now=function(){return+new Date}),sjb.messaging.im.MessageState.prototype.getUnreadCounter=function(){return this.maxMessageId-this.lastReadId},sjb.messaging.im.User.prototype.getUserTypeInfo=function(){return sjb.messaging.im.USER_TYPE_MAP[this.type]},sjb.messaging.im.User.prototype.isVisitor=function(){return this.type===sjb.messaging.im.UserType.VISITOR};var b=sjb.messaging.comoon.Logger;a.MessagingSdk=function(c,d){var e,f=10,g=this,h=!1,i=new sjb.messaging.Sync;i.imUnreadState=0,i.deviceType=d,d===a.MessagingSdk.Type.WEB&&(sjb.messaging.im.USER_TYPE_MAP[sjb.messaging.im.UserType.DOYEN].iconUrl="//f4.sjbly.cn/f15/0317/hxzx/im_id_web_doyen.png",sjb.messaging.im.USER_TYPE_MAP[sjb.messaging.im.UserType.SERVICE].iconUrl="//f4.sjbly.cn/f15/0317/hxzx/im_id_web_service.png",sjb.messaging.im.USER_TYPE_MAP[sjb.messaging.im.UserType.VENDOR].iconUrl="//f4.sjbly.cn/f15/0317/hxzx/im_id_web_vendor.png",sjb.messaging.im.USER_TYPE_MAP[sjb.messaging.im.UserType.CONSULTANT].iconUrl="//f4.sjbly.cn/f15/0317/hxzx/im_id_web_consultant.png");var j={domain:".shijiebang.com",path:"/",expires:2},k=0,l=function(){var b=Date.now();if(!(k+6e4>b)&&(k=b,0===m.getAuthenticationMode())){var c=a.cookie("v");c&&a.cookie("v",c,j)}},m={newRequest:function(b){if(h||e!==m.getAuthenticationMode()){if(!h){h=!0;var c=s[a.MessagingSdk.ChatEvent.USER_CHANGED];c&&c()}return{}}return new sjb.messaging.Request({version:sjb.messaging.Version.ONE,type:b,deviceType:d,authentication:m.getAuthentication()})},getAuthenticationZCookie:function(){var b=a.cookie("z");return b?new sjb.messaging.AuthenticationZCookie({zcookie:b}):null},getAuthenticationVisitor:function(){var b=a.cookie("v");return b?new sjb.messaging.AuthenticationVisitor({vtoken:b}):null},getAuthenticationMode:function(){return m.getAuthenticationZCookie()?1:0},getAuthentication:function(){return new sjb.messaging.Authentication({zcookie:m.getAuthenticationZCookie(),visitor:m.getAuthenticationVisitor()})},sendRequest:function(d,e,f){var i="";if(a.each(sjb.messaging.Type,function(a,b){return b===d.type?(i=a,!1):void 0}),l(),!h){var j=new Thrift.Transport,k=new Thrift.TJSONProtocol(j);k.writeMessageBegin("Request",Thrift.MessageType.CALL,0),!d.myuid&&g.userId&&(d.myuid=g.userId),d.write(k),k.writeMessageEnd();var n=function(a){if(b.log("request: "+JSON.stringify(d)),e){var c=new sjb.messaging.Response;try{var f=new Thrift.Transport;f.setRecvBuffer(a);var g=new Thrift.TJSONProtocol(f);g.readMessageBegin(),c.read(g),g.readMessageEnd(),b.debug("response: "+JSON.stringify(c))}catch(h){return void b.error("Failed to parse response: "+h)}e(!0,c)}},o=function(a,b){f&&(f.backOff(function(){m.sendRequest(d,e,f)})||e(!1))},p=c;if(p=p.indexOf("?")>-1?p+"&type="+i:p+"?type="+i,window.XDomainRequest){var q=new XDomainRequest;q.timeout=4e4,q.onload=function(){n(q.responseText)},q.onerror=o,q.onprogress=function(){},q.ontimeout=o,q.open("POST",p),q.send(j.getSendBuffer())}else a.ajax({type:"POST",url:p,data:j.getSendBuffer(),dataType:"text",timeout:4e4,success:n,error:o})}},login:function(c){var d=m.newRequest(sjb.messaging.Type.LOGIN);m.sendRequest(d,function(d,e){sjb.messaging.ResponseCode.OK===e.responseCode?(g.userId=e.userId,e.vtoken&&a.cookie("v",e.vtoken,j),c(e)):b.error("login failed: "+JSON.stringify(e))},new o({retryLimit:Number.MAX_VALUE}))}};e=m.getAuthenticationMode();var n={retryCount:0,retryLimit:3,initialInterval:5e3,maxRetryInterval:18e4},o=function(b){this.options=a.extend({},n,b)};o.prototype.backOff=function(c){if(this.options.retryCount>=this.options.retryLimit)return a.isFunction(this.options.fail)&&this.options.fail(),!1;var d=Math.min(this.options.maxRetryInterval,this.options.initialInterval*Math.pow(2,Math.min(31,this.options.retryCount)));this.options.retryCount++;var e=Math.floor(Math.random()*d);return b.log(d+", retry after "+e),setTimeout(c,e),!0};var p={chatMap:{},userMap:{},draftContent:{},viewChatType:-1,selectedChatId:{},getChatList:function(b){var c=[];return a.each(this.chatMap,function(a,d){d.getChatType()===b&&c.push(d)}),c},getCurrentChatList:function(){return this.getChatList(this.viewChatType)},switchChatList:function(a){r.updateChatList(this.getChatList(a)),this.switchChatType(a)},getCurrentChatId:function(){return this.selectedChatId[this.viewChatType]||0},switchChatType:function(a){if(this.viewChatType!==a){var b=this.getCurrentChatId();this.viewChatType=a;var c=this.getCurrentChatId();this.switchChat(c,b)}},getDraft:function(){return this.fnDraftGetter?this.fnDraftGetter():null},switchChat:function(b,c){if(c||(c=this.getCurrentChatId()),this.markCurrentChatAsRead(b),c!==b){var d=this.getDraft();c&&null!=d&&(this.draftContent[c]=d),this.selectedChatId[this.viewChatType]=b,d=this.draftContent[b]||"";var e=s[a.MessagingSdk.ChatEvent.SWITCH_CHAT];if(e&&e(c,b,d),b){var g=this.chatMap[b];if(g){g.init();var h=g.getMessageState();g.appendChatHistory(h.maxMessageId-f+1,h.maxMessageId)}}}},markCurrentChatAsRead:function(a){if(a||(a=this.getCurrentChatId()),a){var b=this.chatMap[a];b&&b.markAsRead()}},syncPushData:function(b,c){var d=[],e={},f=b&&b.lastChatListState===i.imChatListState;if(f){i.imChatListState=b.chatListState,e=b.users||{},a.extend(this.userMap,e),d=b.chats||[];for(var h=0;h<d.length;h++){var j=new q(d[h]);this.chatMap[d[h].chatId]=j}}d=c?c.chats:[];for(var h=0;h<d.length;h++){var j=this.chatMap[d[h].chatId];j&&j.setMessageState(d[h].messageState)}if(f){for(var k=b.chatIds,l={},h=0;h<k.length;h++)l[k[h]]=1;a.each(this.chatMap,function(a,b){l[a]||(delete p.chatMap[a],delete p.draftContent[a],r.deleteChat(a))})}(d.length||f)&&r.updateChatList(),r.updatePersonalInfo(e[g.getUserId()])},getOlderMessages:function(){var a=this.getCurrentChatId();if(!a)return[];var b=this.chatMap[a];return b?b.getOlderMessages():[]}},q=function(b){var c=this,d={},e=0,h={},i=0,j=Number.MAX_VALUE;this.init=function(){j=Number.MAX_VALUE},this.getChatId=function(){return b.chatId},this.getChatType=function(){return b.chatInfo.type},this.isGroup=function(){return sjb.messaging.im.ChatType.GROUP===this.getChatType()},this.getUids=function(){return b.chatInfo.uids},this.getIconUrl=function(){for(var a=[],b=this.getUids(),c=g.getUserId(),d=0;d<b.length;d++){var e=b[d];if(this.isGroup()||e!==c){var f=p.userMap[e];a.push(f&&f.iconUrl||"chat-icon.png")}}return a},this.peerUserId=function(){for(var a=b.chatInfo.uids,c=0;c<a.length;c++)if(g.getUserId()!=a[c])return a[c];return 0},this.getName=function(){if(this.isGroup())return b.chatInfo.name;var a=p.userMap[this.peerUserId()];return a&&a.nickname||"single"},this.getUserTypeInfo=function(){if(this.isGroup())return null;var a=this.peerUserId(),b=p.userMap[a];return b?b.getUserTypeInfo():null},this.getMessageState=function(){return b.messageState||(b.messageState=new sjb.messaging.im.MessageState({maxMessageId:0,lastReadId:0,lastMsgTime:0})),b.messageState},this.getUnreadCounter=function(){return this.getMessageState().getUnreadCounter()},this.addMessage=function(a){for(var b=0;b<a.length;b++){var c=a[b];d[c.messageId]=c,delete h[c.messageId]}},this.appendChatHistory=function(b,c){var e=s[a.MessagingSdk.ChatEvent.APPEND_CHAT_HISTORY];if(e&&(b=Math.max(1,b),c=Math.min(c,this.getMessageState().maxMessageId),!(b>c))){j=Math.min(j,b);for(var f=[],g=b;c>=g;g++){var i=d[g];f.push({messageId:g,message:i}),i||(h[g]=!0)}this.loadMessage(),e(f)}},this.setMessageState=function(c){var d=this.getMessageState().maxMessageId+1;b.messageState=c;var f=this.getMessageState().maxMessageId;e=Math.max(e,c.lastReadId);var g=s[a.MessagingSdk.ChatEvent.UPDATE_CHAT_UNREAD];g&&g(this.getChatId(),c.getUnreadCounter()),this.getChatId()===p.getCurrentChatId()&&this.appendChatHistory(d,f)},this.fnModifyMarkAsReadRequest=function(a){return a.imMarkAsRead.messageId<e},this.markAsRead=function(){var a=this.getMessageState().maxMessageId;a>e&&(e=a,y.markAsRead_(this.getChatId(),e,this.fnModifyMarkAsReadRequest))},this.messageLoaded=function(b){if(b.imChatHistory){var d=b.imChatHistory.messages;if(c.addMessage(d),p.getCurrentChatId()==c.getChatId()){var e=s[a.MessagingSdk.ChatEvent.CHAT_MESSAGE_LOADED];if(e){for(var f=0;f<d.length;f++)e(d[f]);i--,0===i&&c.loadMessage()}}}},this.loadMessage=function(){if(!(i>0)){var b=[];a.each(h,function(a,c){b.push(a)}),b.sort(function(a,b){return b-a});for(var c=[],d=0;d<Math.min(f,b.length);d++){var e=parseInt(b[d]);c.length&&c.last().start-1==e?c.last().start--:c.push({start:e,end:e})}i=c.length;for(var d=0;d<c.length;d++){var g=c[d];y.loadChatHistory_(this.getChatId(),g.start,g.end,this.messageLoaded)}}},this.getOlderMessages=function(){if(j===Number.MAX_VALUE)return[];this.getMessageState();if(h[j])return[];var a=Math.max(1,j-f),b=j-1;if(a>b)return[];j=a;for(var c=[],e=b;e>=a;e--){var g=d[e];c.push({messageId:e,message:g}),g||(h[e]=!0)}return this.loadMessage(),c}},r={updateTotalUnread:function(b){if(b){null!==i.imUnreadState&&(0===i.imUnreadState||i.imUnreadState===b.lastUnreadState)&&(i.imUnreadState=b.unreadState),null!==i.imMessageState&&(0===i.imMessageState||i.imMessageState===b.lastUnreadState)&&(i.imMessageState=b.unreadState);var c=s[a.MessagingSdk.ChatEvent.UPDATE_TOTAL_UNREAD];c&&c(b.unreadCounter)}},updateChatUnread:function(a){if(a){var b=p.chatMap[a.chatId];b&&(a.message&&b.addMessage([a.message]),b.setMessageState(a.messageState))}},updateChatList:function(b){var c=s[a.MessagingSdk.ChatEvent.UPDATE_CHAT_LIST];c&&c(b||p.getCurrentChatList())},deleteChat:function(b){var c=b===p.getCurrentChatId();c&&p.switchChat(0,b);var d=s[a.MessagingSdk.ChatEvent.DELETE_CHAT];d&&d(b,c)},updatePersonalInfo:function(b){if(b){var c=s[a.MessagingSdk.ChatEvent.UPDATE_PERSONAL_INFO];c&&c(b)}},updateOnlineStatus:function(b){if(b){var c=b.users||{},d=s[a.MessagingSdk.ChatEvent.UPDATE_PERSONAL_INFO],e=s[a.MessagingSdk.ChatEvent.UPDATE_ONLINE_STATUS];a.each(c,function(a,b){a=parseInt(a);var c=p.userMap[a];c&&(c.onlineStatus=b,a===g.getUserId()?d&&d(c):e&&e(a,c))})}}},s={},t=[],u=function(a,b){var c=t.shift();t.length>0&&v(),a&&c.callback&&c.callback(b)},v=function(){var a=t[0];return a.modify_request&&a.modify_request(a.request)?void u():void m.sendRequest(a.request,u,a.retry||new o({retryLimit:Number.MAX_VALUE}))},w=function(a,b,c,d){t.push({request:a,callback:b,fnModifyRequest:c,retry:d}),1===t.length&&v()},x=!1,y={sendMessage:function(b,c,e,f){var g=m.newRequest(sjb.messaging.Type.IM_SEND_MESSAGE);g.imSendMessage=new sjb.messaging.im.SendMessage({chatId:b,message:new sjb.messaging.im.Message({content:c,deviceType:d,nsid:a.cookie("nsid")})}),w(g,e,null,new o({retryLimit:2,fail:f}))},syncTotalUnreadCounter:function(){if(null===i.imMessageState&&s[a.MessagingSdk.ChatEvent.UPDATE_TOTAL_UNREAD]){var b=m.newRequest(sjb.messaging.Type.SYNC);b.sync=i,m.sendRequest(b,function(a,b){if(sjb.messaging.ResponseCode.OK===b.responseCode){var c=b.imPushData;c&&r.updateTotalUnread(c.syncUnreadCounter),y.syncTotalUnreadCounter()}else setTimeout(y.syncTotalUnreadCounter,5e3)},new o({retryLimit:Number.MAX_VALUE}))}},sync:function(){if(!x){if(x=!0,!g.getUserId())return void g.start(function(){x=!1,y.sync()});null===i.imMessageState&&(i.imMessageState=0,i.imChatListState=0,i.imUnreadState=null);var a=m.newRequest(sjb.messaging.Type.SYNC);a.sync=i,m.sendRequest(a,function(a,b){var c=5e3;if(sjb.messaging.ResponseCode.OK===b.responseCode){var d=b.imPushData;d&&(r.updateTotalUnread(d.syncUnreadCounter),r.updateChatUnread(d.chatUnread),r.updateOnlineStatus(d.syncOnlineStatus),p.syncPushData(d.syncChatList,d.syncMessageState)),c=0}x=!1,setTimeout(y.sync,c)},new o({retryLimit:Number.MAX_VALUE}))}},markAsRead_:function(a,b,c){var d=m.newRequest(sjb.messaging.Type.IM_MARK_AS_READ);d.imMarkAsRead=new sjb.messaging.im.MarkAsRead({chatId:a,messageId:b}),w(d,null,c)},loadChatHistory_:function(a,b,c,d){var e=m.newRequest(sjb.messaging.Type.IM_LOAD_CHAT_HISTORY);e.imChatHistoryRange=new sjb.messaging.im.ChatHistoryRange({chatId:a,startId:b,endId:c}),w(e,d)},setChatEventHandler:function(a,b){s[a]=b},getCurrentChatId:function(){return p.getCurrentChatId()},getSingleChatList:function(){return p.getChatList(sjb.messaging.im.ChatType.SINGLE)},getGroupChatList:function(){return p.getChatList(sjb.messaging.im.ChatType.GROUP)},selectSingleChatList:function(){p.switchChatList(sjb.messaging.im.ChatType.SINGLE)},selectGroupChatList:function(){p.switchChatList(sjb.messaging.im.ChatType.GROUP)},markCurrentChatAsRead:function(){p.markCurrentChatAsRead()},selectChat:function(a){p.switchChat(a)},setChatDraftGetter:function(a){p.fnDraftGetter=a},getOlderMessages:function(){return p.getOlderMessages()},getChat:function(a){return p.chatMap[a]},getUser:function(a){return p.userMap[a]},getUserTypeInfo:function(a){var b=this.getUser(a);return b?sjb.messaging.im.USER_TYPE_MAP[b.type]:null},getSingleChat:function(b){var c=this.getSingleChatList(),d=null;return a.each(c,function(a,c){c.peerUserId()===b&&(d=c)}),d},queryOnlineStatus:function(a,b,c){if(a&&a.length){var d=m.newRequest(sjb.messaging.Type.IM_QUERY_ONLINE_STATUS);d.onlineStatusQuery=new sjb.messaging.im.OnlineStatusQuery({isParentAccount:b,uids:a}),w(d,function(a){sjb.messaging.ResponseCode.OK===a.responseCode&&c(a.imOnlineStatus.users)})}},createSingleChat:function(a,b){var c=this.getSingleChat(a);if(c)return void b(c.getChatId());var d=m.newRequest(sjb.messaging.Type.IM_CREATE_CHAT);d.uid=a,w(d,function(a){b(sjb.messaging.ResponseCode.OK===a.responseCode?a.chatId:a.errorMsg)})},queryParentAccount:function(a,b){var c=m.newRequest(sjb.messaging.Type.IM_QUERY_PARENT_ACCOUNT);c.parentUid=a,w(c,function(a){b(a.childUid)})}};this.start=function(a){m.login(a)},this.getUserId=function(){return g.userId},this.getWebChat=function(){return y}},a.MessagingSdk.ChatEvent={UPDATE_CHAT_LIST:0,DELETE_CHAT:1,UPDATE_CHAT_UNREAD:2,UPDATE_TOTAL_UNREAD:3,SWITCH_CHAT:4,APPEND_CHAT_HISTORY:5,CHAT_MESSAGE_LOADED:6,UPDATE_PERSONAL_INFO:7,UPDATE_ONLINE_STATUS:8,USER_CHANGED:9},a.MessagingSdk.Type={WEB:sjb.messaging.DeviceType.WEB,H5:sjb.messaging.DeviceType.H5}}(jQuery),function($){$||"function"!=typeof require||($=require("jquery")),window.sjb=window.sjb||{};var sjb=window.sjb;sjb.messaging=sjb.messaging||{};var method=sjb.messaging.comoon.method=sjb.messaging.comoon.method||{};method.runOnce=function(a,b){var c=b.frequency,d=b.conditions,e=+new Date,f=setInterval(function(){for(var c=!0,g=[],h=0;h<d.length;h++){var i=d[h],j=i.source[i.param];switch(g.push(j),i.method){case"self":j||(c=!1);break;case"ne":j===i.result&&(c=!1);break;case"eq":j!==i.result&&(c=!1)}}if(c){if("[object Array]"===Object.prototype.toString.call(a))for(var k=0;k<a.length;k++)a[k].apply(b.context,b.fixed.concat(g));else a.apply(b.context,b.fixed.concat(g));clearInterval(f)}else b.expires&&+new Date-e>b.expires&&clearInterval(f)},c)},method.decodeMessage=function(str){if("string"!=typeof str)return str;try{return eval(str)}catch(e){if("undefined"!=typeof JSON)try{return JSON.parse(str)}catch(ex){}}return{text:str}},"object"==typeof module&&"function"==typeof require&&(module.exports=method)}(window.jQuery),function(a){a||"function"!=typeof require||(a=require("jquery")),window.sjb=window.sjb||{};var b=window.sjb;b.messaging=b.messaging||{};var c=b.messaging.comoon.emoji=b.messaging.comoon.emoji||{},d=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","NO","OK","","","","","","","","","",""],e=/\[:([\u4e00-\u9fa5]+)\]/g,f=function(a,b){for(var c=a.length,d=new Array(c),e=0;c>e;e++)e in a&&(d[e]=b(a[e],e));return d},g=function(a){a=a.concat([]);for(var b=[],c=0;2>c;c++){var d=5;for(b[c]=[];d--;)b[c].push(a.splice(0,10))}return b},h=function(a,b){var c,d=a.value;"undefined"!=typeof a.selectionStart&&"undefined"!=typeof a.selectionEnd?(c=a.selectionEnd,a.value=d.slice(0,a.selectionStart)+b+d.slice(c),a.selectionStart=a.selectionEnd=c+b.length):"undefined"!=typeof document.selection&&"undefined"!=typeof document.selection.createRange&&(a.focus(),a.value=a.value+b)},i=function(b){var c="is-im-emoji-panel-selected",d=b.find(".sjb-webim-emoji-table"),e=b.find(".sjb-webim-emoji-trigger");d.not(":first").hide(),a(b).on("click",".sjb-webim-emoji-trigger",function(){var b=a(this).index();e.removeClass(c).eq(b).addClass(c),d.hide().eq(b).fadeIn()}),d.eq(0).addClass(c),e.eq(0).addClass(c)},j=function(){return f(d,function(a,b){return{name:a,text:"[:"+a+"]",className:"icon-im-emoji-"+b}})},k=function(){var a=g(j());return'<div class="sjb-webim-emoji-panel"><div class="sjb-webim-emoji-content">'+f(a,function(a){return'<table class="sjb-webim-emoji-table">'+f(a,function(a){return"<tr>"+f(a,function(a){return'<td><div class="item" ><i data-name="'+a.text+'" class="sjb-im-emoji-icon '+a.className+'" title="'+a.name+'"></i></div></td>'}).join("")+"</tr>"}).join("")+"</table>"}).join("")+'</div><div class="sjb-webim-emoji-trigger-list">'+f(a,function(){return'<div class="sjb-webim-emoji-trigger"></div>'}).join("")+'</div><div class="sjb-webim-down-arrow"><div class="_implementer"></div><div class="_cover"></div></div></div>'};c.replaceEmojiTextToIcon=function(a){return a.replace(e,function(a,b){var c=d.indexOf(b);return-1===c?a:'<i class="sjb-im-emoji-icon icon-im-emoji-'+c+'" title="'+b+'"></i>'})},c.appendToEditor=function(a,b){h(a,b)},c.buildImEmoji=function(){var b=a(".sjb-webim-img-emoji-wrapper"),c='<div class="sjb-webim-tools-item sjb-webim-tools-img-emoji">'+k()+"</div>";b.empty().append(c),i(a(".sjb-webim-tools-img-emoji"))},c.close=function(){a(".sjb-webim-emoji-panel").hide()},a("body").on("click",function(b){var c=a(".sjb-webim-emoji-panel"),d=a(".sjb-webim-tools-img-emoji");return b.target===d[0]?void("block"===c.css("display")?c.hide():c.show()):void(c.has(b.target).length||c[0]===b.target||c.hide())}),"object"==typeof module&&"function"==typeof require&&(module.exports=c)}(window.jQuery),function(a){a||"function"!=typeof require||(a=require("jquery"));var b=function(){return/^https:/.test(window.location.href)},c=new RegExp("(http[s]{0,1}|ftp)://[a-zA-Z0-9\\.\\-]+\\.([a-zA-Z]{2,4})(:\\d+)?(/[a-zA-Z0-9\\.\\-~!@#$%^&*+?:_/=<>]*)?"),d=function(){var a="http";return b()&&(a="https"),a+"://yunhu.c.shijiebang.com/sales/crm/user/register/?"}(),e=[],f=[],g=[];e.push(function(a){return!!a}),f.push(function(b){return b=a.trim(a("<div></div>").html(b).text()),b=b.replace(/&nbsp;/g,"")}),g.push(function(a,b,c){return 0!==c?a:l.has_semInfo(b)?"":a}),g.push(function(a){var b=k.messaging.comoon.emoji;return"undefined"==typeof a?a:b.replaceEmojiTextToIcon(a)}),g.push(function(a,b,c){if(0===c)return a;if(!l.has_semInfo(b))return a;var d=b;return d.cps?"cps["+d.cps+"]"+l.get_substituteUrl(b)+"":"SEM"+l.get_substituteUrl(b)+""}),g.push(function(a,b,d,e){return 3===e?a:a.replace(c,function(a){return"<a class='converted-a' target='_blank' href='"+a+"'>"+a+"</a>"})});var h=[].concat(e),i=[].concat(f),j=[].concat(g);window.sjb=window.sjb||{};var k=window.sjb;k.messaging=k.messaging||{},k.messaging.comoon=k.messaging.comoon||{};var l=k.messaging.comoon.rule={};l.validate=function(a){for(var b=0;b<h.length;b++)if(!h[b].call(null,a))return!1;return!0},l.decode=function(b){return a("<pre></pre>").html(b).text()},l.encode=function(b){return"undefined"!=typeof b?a("<pre></pre>").text(b).html():void 0},l.convert=function(a,b){var c,d=a;for(c=0;c<i.length;c++)d=i[c].call(null,d,b);return d},l.toImg=function(a){var b=k.messaging.comoon.imgUpload.getDefaultImgSize,c=b(a.url);return"undefined"!=typeof a.metadata&&"undefined"!=typeof a.metadata.msgType&&3===a.metadata.msgType||3===a.type?'<a target="_blank" href="'+a.url+'"><img class="sjb-webim-uploaded-show-img" src="'+a.content+'" width="'+c.width+'" height="'+c.height+'"onload="$.sjbwebimHooks.updateScroll()"/></a>':a.text},l.display=function(a,b,c,d){if(!a&&""===d)return"";var e,f=l.decode(a);for(e=0;e<j.length;e++)f=j[e].call(null,f,d,b,c);return f},l.has_semInfo=function(a){return a?"undefined"!=typeof a.sem&&a.sem:!1},l.get_substituteUrl=function(b){var c=b,e=a.makeArray(a.map(c,function(a,b){return b+"="+encodeURIComponent(a)})).join("&");return d+e+"&from=IM"},"object"==typeof module&&"function"==typeof require&&(module.exports=l)}(window.jQuery),function(a){a||"function"!=typeof require||(a=require("jquery")),window.sjb=window.sjb||{};var b=window.sjb;b.messaging=b.messaging||{},b.messaging.comoon=b.messaging.comoon||{};var c=b.messaging.comoon.view={};c.generateChatHeader=function(a){var b=a.identityIconUrl?'<img src="'+a.identityIconUrl+'">':"";return b=b+a.identityIconName||"",'<div class="sjb-webim-talk-header">    <div class="sjb-webim-talk-a es-drag-control">        <a class="sjb-webim-substitutereg" href="" target="_blank"></a>        <h2 data-chatid="'+a.chatId+'">'+a.name+'</h2>        <br/>        <div class="sjb-webim-identity">'+b+"</div>    </div></div>"},c.generateChatFooter=function(){return'<div class="sjb-webim-talk-footer">    <form>        <div class="sjb-webim-editor">            <textarea id="sjb-webim-editor"></textarea>        </div>        <div class="sjb-webim-sendmessage disabled">            <button type="button" class="sjb-webim-submit" disabled><span></span></button>            <a href="javascript:;" class="sjb-webim-setkey"><i class="sjb-webim-icon"></i></a>        </div>    </form>   <div class="sjb-webim-footer-wrapper">      <div class="sjb-webim-fast-reply-wrapper sjb-webim-footer-item">      </div>      <div class="sjb-webim-fast-travel-wrapper sjb-webim-footer-item">      </div>      <div class="sjb-webim-img-upload-wrapper sjb-webim-footer-item">      </div>      <div class="sjb-webim-img-emoji-wrapper sjb-webim-footer-item">      </div>   </div></div>'},c.updateSubstitute=function(a,c){if(b.messaging.comoon.rule.has_semInfo(c)){var d=b.messaging.comoon.rule.get_substituteUrl(c);a.find(".sjb-webim-substitutereg:not(.has-sem)").addClass("has-sem").attr("href",d)}},"object"==typeof module&&"function"==typeof require&&(module.exports=c)}(window.jQuery),function(a){function b(b,c){var e=d(b,c);a.cookie(e,!0,{expires:new Date(+new Date+36e5)})}function c(b,c){return a.cookie(d(b,c),Boolean)}function d(a,b){return"_im_sem_cuid-"+a+"_suid"+b}a||"function"!=typeof require||(a=require("jquery")),window.sjb=window.sjb||{};var e=window.sjb;e.messaging=e.messaging||{},e.messaging.comoon=e.messaging.comoon||{};var f=e.messaging.comoon.sem={},g=e.messaging.comoon.rule;g||"function"!=typeof require||(g=require("./rule"));var h=a.cookie("nsid"),i=a.cookie("_sr"),j=null;f.shouldSendMsg=function(a,b){if(0!==a.type)return!1;if(!h||!i)return!1;var d=c(a.uid,b);return!d},f.generateMsgMeta=function(a){var b={nsid:h,uid:a,sem:!0};return j&&(b.cps=encodeURIComponent(j.channel_name)),b},f.readCps=function(){var b=a.cookie("_sr"),c=a.getJSON("//is.shijiebang.com/cps/simple-channel/?channel_sr="+encodeURIComponent(b)+"&callback=?");c.done(function(a){0===a.code&&(j=a.data)})},f.sendMsgCallBack=function(a,c){b(a,c)},"object"==typeof module&&"function"==typeof require&&(module.exports=f)}(window.jQuery),function(){function a(a,b,c,d){var e={};if(d)for(var f in d)e[f]=d[f];c||(c=b);var g={callback:c,options:e};a[b]?a[b]=a[b].push(g):a[b]=[g]}window.sjb=window.sjb||{};var b=window.sjb;b.messaging=b.messaging||{},b.messaging.comoon=b.messaging.comoon||{};var c=b.messaging.comoon.events={};c.CMEvents=function(){var b=this,c={},d={};return b.on=function(d,e,f){return a(c,d,e,f),b},b.once=function(c,e,f){return a(d,c,e,f),b},b.off=function(a){return c.hasOwnProperty(a)&&delete c[a],d.hasOwnProperty(a)&&delete d[a],b},b.trigger=function(a,e,f){var g=[];if(a)d.hasOwnProperty(a)&&(g=g.concat(d[a]),delete d[a]),c.hasOwnProperty(a)&&(g=g.concat(c[a]));else{var h;for(h in c)g=g.concat(c[h]);for(h in d)g=g.concat(d[h]);d={}}for(var i=0;i<g.length;i++){var j=g[i],k=j.callback.apply(j.options.context||f||null,e);if(k===!1)break}return b},b},"object"==typeof module&&"function"==typeof require&&(module.exports=c)}(),function(a){a||"function"!=typeof require||(a=require("jquery"));var b=function(a){return!/^\{.+\}$/.test(a)},c=function(){return/\/\/www\.shijiebang\.com/.test(location.href)},d=function(a){return/413/.test(a)?" 2000x2000px15MB":""},e=function(a){var b=/\/([^\/]+)_b\.(jpg|jpeg|gif|png)$/.exec(a);if(b=b&&b[1]?b[1]:null,!b)return null;var c=b.split("_")[1].split("x");return{width:c[0]-0,height:c[1]-0}},f=function(a,b){var c=0,d=0;return a>=300?(c=300,d=b*(300/a)):(c=a,d=b),{width:c,height:d}},g=function(a){return JSON.stringify({type:1,text:"[: "+a.bigurl+"]",url:a.bigurl,metadata:{msgType:3},content:a.url})};window.sjb=window.sjb||{};var h=window.sjb;h.messaging=h.messaging||{};var i=h.messaging.comoon.imgUpload=h.messaging.comoon.imgUpload||{};i.enable=function(){return c()},i.getDefaultImgSize=function(a){var b=e(a);return b?f(b.width,b.height):{width:"",height:""}},i.init=function(c,e){var f=c.find(".sjb-webim-file-field"),h=e.getCurrentChatId();f.change(function(i){i.preventDefault(),a.ajax(c.prop("action"),{data:{_z:a.cookie("z")},dataType:"json",files:f,iframe:!0,processData:!1}).complete(function(a){if(b(a.responseText))return void alert(d(a.responseText));var c=JSON.parse(a.responseText);if(c.code)return void alert(c.message);var f=g(c);e.sendMessage(h,f,function(){},function(){})})})},"object"==typeof module&&"function"==typeof require&&(module.exports=i)}(window.jQuery),function(a){function b(b,c,e){a.cookie(d(b,c,e),{expires:new Date(+new Date+36e5)})}function c(b,c,e){return a.cookie(d(b,c,e),Boolean)}function d(a,b,c){return"_im_track_user_"+a+"_c"+b+"_"+c.hashCode()}a||"function"!=typeof require||(a=require("jquery"));var e=/\/super\/\d+/;window.sjb=window.sjb||{};var f=window.sjb;f.messaging=f.messaging||{},f.messaging.comoon=f.messaging.comoon||{};var g=f.messaging.comoon.track={};g.is_super=function(){return e.test(window.location.href)},g.shouldTrack=function(a,b,d){if(0!==a.type)return!1;var e=c(a.uid,b,d);return e?!e:!0},g.trackCallback=function(a,c,d){b(a,c,d)},"object"==typeof module&&"function"==typeof require&&(module.exports=g)}(window.jQuery),function(a,b){"use strict";a.ajaxPrefilter(function(a,b,c){return a.iframe?(a.originalURL=a.url,"iframe"):void 0}),a.ajaxTransport("iframe",function(b,c,d){function e(){i.each(function(b,c){var d=a(c);d.data("clone").replaceWith(d)}),f.remove(),g.one("load",function(){g.remove()}),g.attr("src","about:blank")}var f=null,g=null,h="iframe-"+a.now(),i=a(b.files).filter(":file:enabled"),j=null,k=null;return b.dataTypes.shift(),b.data=c.data,i.length?(f=a("<form enctype='multipart/form-data' method='post'></form>").hide().attr({action:b.originalURL,target:h}),"string"==typeof b.data&&b.data.length>0&&a.error("data must not be serialized"),a.each(b.data||{},function(b,c){a.isPlainObject(c)&&(b=c.name,c=c.value),a("<input type='hidden' />").attr({name:b,value:c}).appendTo(f)}),a("<input type='hidden' value='IFrame' name='X-Requested-With' />").appendTo(f),k=b.dataTypes[0]&&b.accepts[b.dataTypes[0]]?b.accepts[b.dataTypes[0]]+("*"!==b.dataTypes[0]?", */*; q=0.01":""):b.accepts["*"],a("<input type='hidden' name='X-HTTP-Accept'>").attr("value",k).appendTo(f),j=i.after(function(b){var c=a(this),d=c.clone().prop("disabled",!0);return c.data("clone",d),d}).next(),i.appendTo(f),{send:function(b,c){g=a("<iframe src='about:blank' name='"+h+"' id='"+h+"' style='display:none'></iframe>"),g.one("load",function(){g.one("load",function(){
var a=this.contentWindow?this.contentWindow.document:this.contentDocument?this.contentDocument:this.document,b=a.documentElement?a.documentElement:a.body,d=b.getElementsByTagName("textarea")[0],f=d&&d.getAttribute("data-type")||null,g=d&&d.getAttribute("data-status")||200,h=d&&d.getAttribute("data-statusText")||"OK",i=b.getElementsByTagName("pre")[0],j={html:b.innerHTML,text:f?d.value:b?i?i.innerText||i.textContent:b.innerText||b.textContent:null};e(),c(g,h,j,f?"Content-Type: "+f:null)}),f[0].submit()}),a("body").append(f,g)},abort:function(){null!==g&&(g.unbind("load").attr("src","about:blank"),e())}}):void 0})}(jQuery);var grayscale=function(){var a={colorProps:["color","backgroundColor","borderBottomColor","borderTopColor","borderLeftColor","borderRightColor","backgroundImage"],externalImageHandler:{init:function(a,b){"img"===a.nodeName.toLowerCase()||(c(a).backgroundImageSRC=b,a.style.backgroundImage="")},reset:function(a){"img"===a.nodeName.toLowerCase()||(a.style.backgroundImage="url("+(c(a).backgroundImageSRC||"")+")")}}},b=function(a){return new RegExp("https?://(?!"+window.location.hostname+")").test(a)},c=function(){var a=[0],b="data"+ +new Date;return function(c){var d=c[b],e=a.length;return d||(d=c[b]=e,a[d]={}),a[d]}}(),d=function(a,b,e){var g,h=document.createElement("canvas"),i=h.getContext("2d"),j=a.naturalHeight||a.offsetHeight||a.height,k=a.naturalWidth||a.offsetWidth||a.width;h.height=j,h.width=k,i.drawImage(a,0,0);try{g=i.getImageData(0,0,k,j)}catch(l){}if(b){d.preparing=!0;var m=0;return void function(){if(d.preparing){m===j&&(i.putImageData(g,0,0,0,0,k,j),e?c(e).BGdataURL=h.toDataURL():c(a).dataURL=h.toDataURL());for(var b=0;k>b;b++){var l=4*(m*k+b);g.data[l]=g.data[l+1]=g.data[l+2]=f(g.data[l],g.data[l+1],g.data[l+2])}m++,setTimeout(arguments.callee,0)}}()}d.preparing=!1;for(var m=0;j>m;m++)for(var n=0;k>n;n++){var o=4*(m*k+n);g.data[o]=g.data[o+1]=g.data[o+2]=f(g.data[o],g.data[o+1],g.data[o+2])}return i.putImageData(g,0,0,0,0,k,j),h},e=function(a,b){var c=document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(a,null)[b]:a.currentStyle[b];if(c&&/^#[A-F0-9]/i.test(c)){var d=c.match(/[A-F0-9]{2}/gi);c="rgb("+parseInt(d[0],16)+","+parseInt(d[1],16)+","+parseInt(d[2],16)+")"}return c},f=function(a,b,c){return parseInt(.2125*a+.7154*b+.0721*c,10)},g=function(a){var b=Array.prototype.slice.call(a.getElementsByTagName("*"));return b.unshift(a),b},h=function(i){if(i&&i[0]&&i.length&&i[0].nodeName)for(var j=Array.prototype.slice.call(i),k=-1,l=j.length;++k<l;)h.call(this,j[k]);else{if(i=i||document.documentElement,!document.createElement("canvas").getContext)return i.style.filter="progid:DXImageTransform.Microsoft.BasicImage(grayscale=1)",void(i.style.zoom=1);for(var m=g(i),n=-1,o=m.length;++n<o;){var p=m[n];if("img"===p.nodeName.toLowerCase()){var q=p.getAttribute("src");if(!q)continue;if(b(q))a.externalImageHandler.init(p,q);else{c(p).realSRC=q;try{p.src=c(p).dataURL||d(p).toDataURL()}catch(r){a.externalImageHandler.init(p,q)}}}else for(var s=0,t=a.colorProps.length;t>s;s++){var u=a.colorProps[s],v=e(p,u);if(v)if(p.style[u]&&(c(p)[u]=v),"rgb("!==v.substring(0,4)){if(v.indexOf("url(")>-1){var w=/\(['"]?(.+?)['"]?\)/,x=v.match(w)[1];if(b(x)){a.externalImageHandler.init(p,x),c(p).externalBG=!0;continue}try{var y=c(p).BGdataURL||function(){var a=document.createElement("img");return a.src=x,d(a).toDataURL()}();p.style[u]=v.replace(w,function(a,b){return"("+y+")"})}catch(r){a.externalImageHandler.init(p,x)}}}else{var z=f.apply(null,v.match(/\d+/g));p.style[u]=v="rgb("+z+","+z+","+z+")"}}}}};return h.reset=function(d){if(d&&d[0]&&d.length&&d[0].nodeName)for(var e=Array.prototype.slice.call(d),f=-1,i=e.length;++f<i;)h.reset.call(this,e[f]);else{if(d=d||document.documentElement,!document.createElement("canvas").getContext)return void(d.style.filter="progid:DXImageTransform.Microsoft.BasicImage(grayscale=0)");for(var j=g(d),k=-1,l=j.length;++k<l;){var m=j[k];if("img"===m.nodeName.toLowerCase()){var n=m.getAttribute("src");b(n)&&a.externalImageHandler.reset(m,n),m.src=c(m).realSRC||n}else for(var o=0,p=a.colorProps.length;p>o;o++){c(m).externalBG&&a.externalImageHandler.reset(m);var q=a.colorProps[o];m.style[q]=c(m)[q]||""}}}},h.prepare=function(a){if(a&&a[0]&&a.length&&a[0].nodeName)for(var f=Array.prototype.slice.call(a),i=-1,j=f.length;++i<j;)h.prepare.call(null,f[i]);else if(a=a||document.documentElement,document.createElement("canvas").getContext)for(var k=g(a),l=-1,m=k.length;++l<m;){var n=k[l];if(c(n).skip)return;if("img"===n.nodeName.toLowerCase())n.getAttribute("src")&&!b(n.src)&&d(n,!0);else{var o=e(n,"backgroundImage");if(o.indexOf("url(")>-1){var p=/\(['"]?(.+?)['"]?\)/,q=o.match(p)[1];if(!b(q)){var r=document.createElement("img");r.src=q,d(r,!0,n)}}}}},h}();!function(a){"use strict";a.fn.estormDrag=function(b){var c={dragType:"fixed",dragRegional:"body",dragContainer:"es-drag-container",dragControl:"es-drag-control",dragCursor:"es-drag-control-cursor",dragOpacity:.8,callback:null},d=a.extend(!0,{},c,b||{}),e=a(this),f={init:function(a){a.on("mousedown","."+d.dragControl,f.dragStart),a.on("mouseup mouseleave","."+d.dragControl,f.dragStop),f.cssInit(a)},cssInit:function(b){var c=b.offset(),e="fixed"===d.dragType?c.top-a(window).scrollTop():c.top;b.css({left:c.left,top:e,margin:0,position:d.dragType}),b.addClass(d.dragContainer),b.data("region",f.computeRegion(d.dragRegional))},dragStart:function(b){if(!a(b.target).hasClass(d.dragControl))return!1;b.preventDefault&&b.preventDefault(),b.returnValue=!1;var c=a(b.target).hasClass(d.dragControl),e=a("body");if(c){var g=a(b.target).closest("."+d.dragContainer),h=g.offset(),i=[b.pageX-h.left,b.pageY-h.top],j=g.data("region");a(this).addClass(d.dragCursor),g.css("opacity",d.dragOpacity),g.data("region",f.computeRegion(d.dragRegional)),e.bind("mousemove",{parent:g,dis:i,region:j},f.dragMove)}return this.setCapture&&this.setCapture(),!1},dragMove:function(a){var b,c,e=a.data.parent,g=a.data.dis,h=a.data.region;"fixed"===d.dragType?(b=a.clientX-Number(g[0]),c=a.clientY-Number(g[1])):(b=a.pageX-Number(g[0]),c=a.pageY-Number(g[1]));var i=[b,c,e.width(),e.height()],j=f.criticalValue(i,h);e.css({left:j.x,top:j.y})},dragStop:function(b){b.preventDefault&&b.preventDefault(),b.returnValue=!1;var c=a("body"),e=a(this),g=e.closest("."+d.dragContainer),h=function(){if(c.unbind("mousemove",f.dragMove),g.css("opacity",1),e.removeClass(d.dragCursor),d.callback&&a.isFunction(d.callback)){var b=Number(g.css("left").replace("px","")),h=Number(g.css("top").replace("px",""));d.callback(b,h),g.data("region",f.computeRegion(d.dragRegional))}e[0].releaseCapture&&e[0].releaseCapture()};return setTimeout(h,80),!1},computeRegion:function(b){var c=[];if("string"==typeof b){var e=a(b),f=e.offset(),g=e.width(),h=e.height();c[0]=f.left,c[1]=f.top,c[2]=c[0]+g,"fixed"===d.dragType?c[3]=a(window).height()-c[1]:c[3]=c[1]+h}else for(var i in b)c[i]=b[i];return c},criticalValue:function(a,b){var c,d,e,f,g,h,i,j,k={stat:!0},l=[];return c=a[0],d=a[1],e=a[2],f=a[3],g=b[0],i=b[1],h=b[2],j=b[3],g>c?(k.x=g,l[0]=0):c>h-e?(k.x=h-e,l[0]=0):k.x=c,i>d?(k.y=i,l[1]=0):d>j-f?(k.y=j-f,l[1]=0):k.y=d,2===l.length&&(k.stat=!1),k}};a.each(e,function(){var b=a(this);f.init(b)})}}(jQuery),function(a){"use strict";a.fn.estormScrollbar=function(b){var c={bar:{minHeight:50},mousewheel:{step:10},position:"top",callback:null},d=a.extend(!0,{},c,b||{}),e=a(this),f={init:function(b){var c=this;c.subObjs.o=b,c.subObjs.container=b.find(".es-scrollbar-container"),c.subObjs.main=b.find(".es-scrollbar-main"),c.initBar(),b.on("esScrollbarUpdate",function(b,c,d){var e=a(this);if(f.initBar(),f.subObjs.bar&&f.subObjs.bar[0])if(0===c&&d)f.resetTop(d);else if(1===c){var g=Number(e.find(".es-scrollbar-drag").data("region")),h=f.returnDiff(d,0,g);f.updateDis(h)}}),b.on("esScrollbarGoto",function(b,c){var d=a(this),e=Number(d.find(".es-scrollbar-drag").data("region")),g=f.returnDiff(c,0,e);f.updateDis(g)})},subObjs:{o:null,container:null,main:null,bar:null,drag:null},initBar:function(){var b=this,c=b.subObjs.container.height(),e=b.subObjs.main.height();if(e>c)if(b.subObjs.bar)b.setBarHeight(c,e);else{var g=a(f.dragTemp());b.subObjs.container.append(g),b.subObjs.bar=b.subObjs.o.find(".es-scrollbar-bar"),b.subObjs.drag=b.subObjs.o.find(".es-scrollbar-drag"),b.subObjs.drag.bind("mousedown",f.startMove),b.subObjs.drag.bind("mouseup mouseleave",f.endMove),b.esMousewheel(b.subObjs.o[0],function(a){f.preventDefault(a);var c=-1*a.delta*d.mousewheel.step,e=b.subObjs.drag,g=Number(e.css("top").replace("px",""))+c;f.updateDis(g)}),b.setBarHeight(c,e),b.subObjs.bar.fadeIn();var h=Number(b.subObjs.drag.data("region")),i=b.returnDiff(d.position,0,h);b.updateDis(i)}else b.subObjs.bar&&b.subObjs.bar[0]&&b.subObjs.bar.hide()},resetTop:function(a){"bottom"===a&&(a=0);var b=this,c=b.subObjs.main.height(),d=c-a,e=Number(b.subObjs.drag.data("ratio")),f=d*e;b.updateDis(f)},startMove:function(b){b.preventDefault&&b.preventDefault(),b.returnValue=!1;var c=(a(this),Number(f.subObjs.drag.css("top").replace("px",""))),d={parent:f.subObjs.bar,y:b.screenY,top:c};return a("body").bind("mousemove",d,f.moving),this.setCapture&&this.setCapture(),!1},moving:function(a){var b=(a.data.parent,a.data.y),c=a.screenY,d=c-b,e=a.data.top+d;f.updateDis(e)},endMove:function(b){return b.preventDefault&&b.preventDefault(),b.returnValue=!1,a("body").unbind("mousemove",f.moving),b.releaseCapture&&b.releaseCapture(),!1},updateDis:function(b){var c=this,e=f.subObjs.drag,g=f.subObjs.main,h=Number(e.data("region")),i=Number(e.data("ratio")),j=Number(e.data("regionmain"));0>b?b=0:b>h&&(b=h);var k=b/i,l=Number(g.css("top").replace("px","")),m=c.subObjs.main.height()-c.subObjs.container.height();l=0>l?-1*l:l;var n=k-l;if(n>m){var o=-1*c.subObjs.main.css("top").replace("px","");k=o+c.subObjs.container.height()/4,0>k?k=0:k>j&&(k=j),b=k*i}return g.css({top:-1*k}),e.css({top:b}),f.subObjs.container.height()>=g.height()?(g.css({top:0}),e.css({top:0}),!1):void(d.callback&&a.isFunction(d.callback)&&d.callback(parent,e,g,b,k,h,i))},returnDiff:function(a,b,c){var d=null;return d="bottom"===a?c:"top"===a?b:Number(a)},setBarHeight:function(a,b){var c=this,e=c.subObjs.bar;e.height(a);var f=e.find(".es-scrollbar-top").outerHeight(),g=e.find(".es-scrollbar-bottom").outerHeight();e.find(".es-scrollbar-center").height(a-f-g);var h=a*a/b;h=h<d.bar.minHeight?d.bar.minHeight:h;var i=(a-h)/(b-a);e.find(".es-scrollbar-drag").height(h).data("region",a-h).data("regionmain",b-a).data("ratio",i);var j=e.find(".es-scrollbar-drag-top").outerHeight(),k=e.find(".es-scrollbar-drag-bottom").outerHeight();e.find(".es-scrollbar-drag-center").height(h-j-k)},addEvent:function(a,b,c,d){return a.dispatchEvent?a.addEventListener(b,c,!!d):a.attachEvent("on"+b,c),c},esMousewheel:function(a,b){var c=this,d="mousewheel";try{document.createEvent("MouseScrollEvents"),d="DOMMouseScroll"}catch(e){}c.addEvent(a,d,function(c){if("wheelDelta"in c){var d=c.wheelDelta;window.opera&&opera.version<10&&(d=-d),c.delta=Math.round(d)/120}else"detail"in c&&(c.wheelDelta=40*-c.detail,c.delta=c.wheelDelta/120);b.call(a,c)})},preventDefault:function(a){a.preventDefault?a.preventDefault():a.returnValue=!1},dragTemp:function(){var a='<div class="es-scrollbar-bar">    <div class="es-scrollbar-top"><span></span></div>    <div class="es-scrollbar-center"></div>    <div class="es-scrollbar-bottom"><span></span></div>    <div class="es-scrollbar-drag">        <div class="es-scrollbar-drag-top"><span></span></div>        <div class="es-scrollbar-drag-center"></div>        <div class="es-scrollbar-drag-bottom"><span></span></div>    </div></div>';return a}};a.each(e,function(){var b=a(this);f.init(b)})}}(jQuery),function($){"use strict";function buildSingleDataBySdkChat(a){var b=$.sjbwebimAction.checkUserType(a.getUserTypeInfo()),c=Number(a.peerUserId()),d=webChat.getUser(c),e=d.onlineStatus===sjb.messaging.im.OnlineStatus.OFFLINE?2:0;return{chatId:a.getChatId(),userId:c,name:a.getName(),userhead:a.getIconUrl(),status:e,identityIconUrl:b.iconUrl,identityIconName:b.name,tabType:1,shopname:"",lastMsgTime:a.getMessageState().lastMsgTime}}function buildGroupDataBySdkChat(a){return{chatId:a.getChatId(),userId:a.getUids(),name:a.getName(),userhead:a.getIconUrl(),status:null,identityIconUrl:null,identityIconName:null,tabType:2}}function buildImgUpload(a){if(0!==a.type){var b=sjb.messaging.comoon.imgUpload;if(b.enable()){var c=$(".sjb-webim-img-upload-wrapper"),d='<div class="sjb-webim-tools-item sjb-webim-tools-img-upload"><form class="sjb-webim-img-upload-form" action="//www.shijiebang.com/a/picture/" method="post" enctype="multipart/form-data"><input type="file" class="sjb-webim-file-field" accept="image/png,image/gif,image/jpg,image/jpeg" name="imgFile" multiple=""></form></div>';c.empty().append(d),b.init(c.find("form"),webChat)}}}function buildFastReply(a,b){var c=storage.read("fast-replies"),d=$.extend({autoAppend:!0},b),e=[],f="";switch(a.type){case 1:e=c.doyen;break;case 4:e=c.sale}return e.length>0&&(f='   <div class="sjb-webim-fast-reply">       <div class="sjb-webim-fast-reply-entry"></div>       <div class="sjb-webim-fast-reply-main" style="display: none;">       <div class="sjb-webim-fast-reply-list-wrapper">           <ul class="sjb-webim-fast-reply-list">'+$.makeArray($.map(e,function(a){var b=$('<li class="sjb-webim-fast-reply-item"></li>');return b.attr("title",a).html(a),$("<div></div>").append(b).html()})).join("\r\n")+'           </ul>       </div>       <div class="sjb-webim-down-arrow"><div class="_implementer"></div><div class="_cover"></div></div>   </div>'),d.autoAppend&&$(".sjb-webim-fast-reply-wrapper").empty().append(f),f}function buildGroupShellLink(a,b){var c=$.extend({autoAppend:!0,wrapper:$(".sjb-webim-fast-travel-wrapper")},b),d=("sjb_webim_callback_fast_entry_"+ +new Date,c.wrapper),e='   <div class="sjb-webim-fast-travel">       <div class="sjb-webim-fast-travel-entry"></div>       <div class="sjb-webim-fast-travel-main" style="display: none;">           <div class="sjb-webim-down-arrow"><div class="_implementer"></div><div class="_cover"></div></div>           <div class="sjb-webim-fast-travel-main-content">              <div class="sjb-webim-msg-loading"></div>           </div>       </div>   </div>',f=gchatList.get(a);if(d.empty(),f){d.append(e);var g=d.find(".sjb-webim-fast-travel-main-content");$.ajax({url:"//is.shijiebang.com/im/business/info/",data:{chatId:a,type:"pc"},dataType:"jsonp",success:function(a){var b=a.data,c=[];if(b.demand_url&&c.push({text:"",url:b.demand_url}),b.shell_url&&c.push({text:"",url:b.shell_url}),b.trip_url&&c.push({text:"",url:b.trip_url}),b.order_url&&c.push({text:"",url:b.order_url}),g.empty(),c.length>0){var d='<ul class="sjb-webim-fast-travel-list">'+$.makeArray($.map(c,function(a){return'<li class="sjb-webim-fast-travel-item"><a target="_blank" href="'+a.url+'">'+a.text+"</a></li>"})).join("\r\n")+"</ul>";g.append(d)}else g.append('<div class="sjb-webim-fast-travel-null"></div>')}})}}function readFastReplies(a){a=a||"",$.ajax({url:"//is.shijiebang.com/im/prereply/",data:{indent:!0,uid:a},dataType:"jsonp",success:function(a){storage.write("fast-replies",a.data),storage.write("fast-replies-update-time",new Date)}})}function sendTrackUrl(a,b){b.id||(b.id=sjbwebimSDK.getUserId());var c=window.location.href,d=/\/super\/[1-9]\d*/,e="automate-url-notification-";if(c.indexOf("#")&&(c=c.slice(0,c.indexOf("#"))),d.test(c)){var f=d.exec(c)[0].slice(7),g=e+b.id+"-"+f,h=storage.read(g);if(!h||+new Date-h.time>6e5){var i=" "+window.location.href+" ",j={type:1,text:i,url:window.location.href};webChat.sendMessage(a.id,JSON.stringify(j),function(){var a=new Date;storage.write(g,{time:+a,superId:f})},null)}}}function sendBindMsg(a){var b=sjb.messaging.comoon.track,c=sjbwebimParams.userSelf,d=sjbwebimParams.data.bindMsg;if(d&&b.shouldTrack(c,a.id,d)){var e={type:1,text:d,url:window.location.href};webChat.sendMessage(a.id,JSON.stringify(e),function(){b.trackCallback(c.uid,a.id,d),sjbwebimParams.data.bindMsg=null},null)}}function sendSemMsg(a){var b=sjb.messaging.comoon.sem,c=sjbwebimParams.userSelf,d=a.peerUserId();if(b.shouldSendMsg(c,d)){var e={type:1,text:"",content:"",url:window.location.href,metadata:b.generateMsgMeta(c.uid)};webChat.sendMessage(a.id,JSON.stringify(e),function(){b.sendMsgCallBack(c.uid,d)},null)}}var sjbwebimSDK=null,webChat=null,urlReg=new RegExp("(http[s]{0,1}|ftp)://[a-zA-Z0-9\\.\\-]+\\.([a-zA-Z]{2,4})(:\\d+)?(/[a-zA-Z0-9\\.\\-~!@#$%^&*+?:_/=<>]*)?"),achatList=new ChatCollection([]),gchatList=new ChatCollection([]),schatList=new ChatCollection([]),tchatList=new ChatCollection([]),storage=new CMStorage("sjb-webim"),sjbwebimParams={ids:{win:"#sjb-webim",entry:"#sjb-webim-entry"},user:null,userSelf:{uid:null,userhead:null,name:null,status:null},permissions:{createChat:!1,fastReply:!1},data:{initialized:!1,current:{},currTab:null,isLoadMsg:!0,isFrist:!0,isLast:!1,msgLength:[],sendMessageId:0,tempUid:null,isFromConsult:!1,tempGroupChatId:null,bindMsg:null,maxMsgId:0,timer:[],first:[[],[]]},updateTotalUnread:{timer:null,title:document.title},actStatu:{searchUser:!1},style:{},cookieOptions:{expires:30,path:"/",domain:".shijiebang.com"}},sjbimRadio=$({}),sjbimRadioPubStatus={imInit:{count:0,ex:null}};$.each({trigger:"sjbimPub",on:"sjbimSub",off:"unSjbimSub"},function(a,b){$[b]=function(){"on"===a&&"imInit"===arguments[0]&&sjbimRadioPubStatus.imInit.count>0?(arguments[1](null,sjbimRadioPubStatus.imInit.ex),sjbimRadioPubStatus.imInit={count:sjbimRadioPubStatus.imInit.count+1}):sjbimRadio[a].apply(sjbimRadio,arguments)}}),$.sjbwebimHooks=$.sjbwebimHooks||{},$.sjbwebimHooks.getCurrentSDK=function(){return sjbwebimSDK},$.sjbwebimHooks.getCurrentWebchat=function(){return webChat},$.sjbwebimHooks.getParentId=function(a,b){var c=$.sjbwebimHooks,d=c.getCurrentWebchat();d.queryParentAccount(a,function(a){b&&$.isFunction(b)&&b(a)})},$.sjbwebimHooks.isReload=!1,$.sjbwebimHooks.sendMsgToUid=function(a,b,c,d){var e=$.sjbwebimHooks,f=$(sjbwebimParams.ids.win),g=function(){e.getParentId(a,function(a){var c=$.sjbwebimHooks.getCurrentWebchat();c.createSingleChat(a,function(d){if(d){var e=function(){""!==b&&c.sendMessage(d,b,function(){$.sjbimPub("sendMsgToUidSucc",[d,a])},function(){$.sjbimPub("sendMsgToUidFail",[d,a])})},f=null,g=0,h=function(){var a=$(sjbwebimParams.ids.win),b=a.find(".sjb-webim-tab-talk li.sjb-webim-chatid-"+d);b.length>0?(f&&clearTimeout(f),b.trigger("click",e)):10>g&&(f=setTimeout(function(){h()},300)),g++};h()}})})},h=function(){f[0]?g():$.sjbimSub("imWinInit",g),c===!0&&$(sjbwebimParams.ids.entry).trigger("click")};d===!0?($.sjbimSub("imUserChanged",h),$.sjbwebimHooks.isReload===!1&&($.sjbwebimAction.reloadLogin("//s2.sjbly.cn/img/avt_180.png"),$.sjbwebimHooks.isReload=!0,$.sjbimPub("imUserChanged"))):h()},$.sjbwebimHooks.sendTrueMsgToCurr=function(a,b,c,d){var e=$.sjbwebimHooks,f=$(sjbwebimParams.ids.win),g=function(){e.getParentId(a,function(a){var c=$.sjbwebimHooks.getCurrentWebchat();c.createSingleChat(a,function(c){if(c){if(""===b)return;$.ajax({url:"//is.shijiebang.com/im/send/guest/",data:{from:a,chatid:c,to:$.cookie("v"),msg:b},type:"get",dataType:"jsonp",complete:function(a,b){$.sjbimPub("sendTrueMsgToCurr",[a,b])}})}})})},h=function(){f[0]?g():$.sjbimSub("imWinInit",g),c===!0&&$(sjbwebimParams.ids.entry).trigger("click")};d===!0?$.sjbimSub("imUserChanged",h):h()},$.sjbwebimHooks.falseUser={name:"",icon:"",uid:"",reconnet:null,inner:null},$.sjbwebimHooks.updateScroll=function(){var a=$(".sjb-webim-talk-article .es-scrollbar-main"),b=a.height();a.css({top:$(".sjb-webim-talk-list").height()-b})},$.sjbwebimHooks.sendFalseMsgToCurr=function(a,b){var c=$.sjbwebimHooks;c.getParentId(a,function(a){if(!a)return alert("ID"),!1;var c=$(sjbwebimParams.ids.win),d=$(sjbwebimParams.ids.entry),e=function(){c=$(sjbwebimParams.ids.win);var d='.sjb-webim-tab-talk li.item[data-userid="'+a+'"]',e=c.find(d),f=c.find(d),g=function(a){var c='<li class="item item-timer">'+$.sjbwebimAction.formatDate((new Date).getTime())+'</li><li class="item item-left"><h3 class="item-name">'+a.name+'<a class="item-name-act" href="javascript:;"></a></h3><div class="sjb-webim-userhead"><img width="34" height="34" src="'+a.icon+'"><i class="sjb-webim-icon sjb-webim-head-mask-fff"></i></div><div class="item-content"><i class="sjb-webim-icon item-radius-top"></i><i class="sjb-webim-icon item-radius-right"></i><i class="sjb-webim-icon item-radius-bottom"></i><i class="sjb-webim-icon item-radius-left"></i><div data-content="'+b+'" class="item-content-text">'+b+"</div></div></li>";return c},h=function(a,b){var d={name:a.find(".sjb-webim-name strong").text(),icon:a.find("img").attr("src")},e=g(d),f=c.find(".sjb-webim-right .sjb-webim-talk-list");f.find("ul").append(e),f.trigger("esScrollbarUpdate",[1,"bottom"])};1===e.length?e.trigger("click",function(){h(e,1),$.sjbwebimHooks.falseUser.inner=null}):1===f.length?f.trigger("dblclick",function(){h(f,2)}):$.ajax({url:"//is.shijiebang.com/user/get/",data:{uid:a},type:"get",dataType:"jsonp",success:function(a){if(0===Number(a.code)){var b=a.data.icon?a.data.icon:"//s2.sjbly.cn/img/avt_180.png",d='<li class="item sjb-webim-chatid-kanbujianwo" data-userid="'+a.data.uid+'" data-chatid="kanbujianwo"><div class="sjb-webim-userinfo "><a href="javascript:;" title="'+a.data.nick+'"><div class="item-left"> <div class="sjb-webim-userhead"><img src="'+b+'" width="34" height="34"><i class="sjb-webim-icon sjb-webim-head-mask-f3f3f3"></i> </div><div class="sjb-webim-status sjb-webim-status-on"><i class="sjb-webim-icon"></i></div></div><div class="item-right"><div class="sjb-webim-name"><strong>'+a.data.nick+'</strong></div> <div class="sjb-webim-identity"></div></div><div class="sjb-webim-number" style="display: none;"><div class="sjb-webim-number-bg"><span class="sjb-webim-number-l"></span><span class="sjb-webim-number-c" style="width:1px;"></span><span class="sjb-webim-number-r"></span> </div><span class="sjb-webim-number-t">0</span></div></a></div></li>',e=$(d);$.sjbwebimHooks.falseUser={name:a.data.nick,icon:b,uid:a.data.uid,inner:function(){h(e,4)}},c.find(".sjb-webim-center .sjb-webim-tab-talk ul").prepend(e);var f=c.find('.sjb-webim-nav li[data-type="0"]');f.hasClass("current")||f.trigger("click"),e.trigger("click",function(){h(e,3)})}else alert(a.msg+"[sendFalseMsgToCurr]")},error:function(){alert("[sendFalseMsgToCurr]")}})};!c[0]||c.is(":hidden")?(d.trigger("click",["sendFalseMsgToCurr"]),$.sjbimSub("imWinInit",e)):e()})},$.sjbwebimTemp={container:'<div id="'+sjbwebimParams.ids.win.replace("#","")+'" class="sjb-webim es-drag-container"></div>',layout:'<div class="sjb-webim-layout">    <div class="sjb-webim-left es-drag-control"></div>    <div class="sjb-webim-center"><div class="sjb-webim-fly"><div class="sjb-webim-tab-main sjb-webim-tab-talk"></div><div class="sjb-webim-tab-main sjb-webim-tab-single"></div><div class="sjb-webim-tab-main  sjb-webim-tab-group"></div></div></div>   <div class="sjb-webim-right"></div></div>',closedBtn:'<div class="sjb-webim-remove">    <a href="javascript:;"><i class="sjb-webim-icon"></i></a></div>',tabNav:function(a){var b=a?'<li data-type="0" class="current"><a href="javascript:;"><i class="sjb-webim-icon sjb-webim-nav-1"></i><div class="sjb-webim-number"><div class="sjb-webim-number-bg"><span class="sjb-webim-number-l"></span><span style="width:10px;" class="sjb-webim-number-c"></span><span class="sjb-webim-number-r"></span></div><span class="sjb-webim-number-t">1</span></div></a></li>':"",c='<div class="sjb-webim-nav">    <ul>        '+b+'        <li data-type="1"><a href="javascript:;"><i class="sjb-webim-icon sjb-webim-nav-2"></i></a></li>        <li data-type="2"><a href="javascript:;"><i class="sjb-webim-icon sjb-webim-nav-3"></i></a></li>    </ul></div>';return c},status:function(a){a=a?Number(a):0;var b=["sjb-webim-status-on","sjb-webim-status-leave","sjb-webim-status-off"];return b[a]},identity:function(a){},selfInfo:function(a){var b=a.status,c=$.sjbwebimTemp.status[Number(b)],d=a.userhead?a.userhead:"//s2.sjbly.cn/img/avt_180.png",e=a.name?a.name:"",f='<div class="sjb-webim-self-info">    <div class="sjb-webim-userinfo">        <a href="javascript:;">            <div class="sjb-webim-userhead">                <img src="'+d+'" width="34" height="34">                <i class="sjb-webim-icon sjb-webim-head-mask-4a5362"></i>            </div>            <div class="sjb-webim-status '+c+'">                <i class="sjb-webim-icon"></i>            </div>            <div class="sjb-webim-showmyname">                <div class="sjb-webim-showmyname-l"></div>                <div class="sjb-webim-showmyname-c">'+e+'</div>                <div class="sjb-webim-showmyname-r"></div>            </div>        </a>    </div></div>';return f},contactListContainer:'<div class="sjb-webim-center-scrollbar"><div class="sjb-webim-userlist es-scrollbar-container"><ul class="es-scrollbar-main"></ul></div></div>',contactListItem:function(a,b){var c=a.userhead,d="",e="",f="",g="";if(2===Number(a.tabType)){d="sjb-webim-groupinfo";for(var h=c.length>4?4:c.length,i=0;h>i;i++)e+='<img src="'+c[i]+'" width="15" height="15" class="img-0'+(i+1)+'">'}else{var j=webChat.getUser(a.userId),k=j.onlineStatus===sjb.messaging.im.OnlineStatus.OFFLINE?2:0,l=$.sjbwebimTemp.status(Number(k));g='<div class="sjb-webim-status '+l+'">   <i class="sjb-webim-icon"></i></div>',e='<img src="'+a.userhead+'" width="34" height="34">',f='<div class="sjb-webim-identity">'+a.identityIconName+"</div>"}var m='<div class="sjb-webim-number">    <div class="sjb-webim-number-bg">        <span class="sjb-webim-number-l"></span>        <span class="sjb-webim-number-c" style="width:1px;"></span>        <span class="sjb-webim-number-r"></span>    </div>    <span class="sjb-webim-number-t">0</span></div>',n="",o=0===b?m:"",p='<li class="item sjb-webim-chatid-'+a.chatId+'" data-userid="'+a.userId+'" data-chatid="'+a.chatId+'">   <div class="sjb-webim-userinfo '+d+'">        <a href="javascript:;" title="'+a.name+'">            <div class="item-left">                <div class="sjb-webim-userhead">                    '+e+'                    <i class="sjb-webim-icon sjb-webim-head-mask-f3f3f3"></i>                </div>'+g+'            </div>            <div class="item-right">                <div class="sjb-webim-name"><strong>'+a.name+"</strong></div>                "+f+"            </div>"+n+o+"        </a>    </div></li>";return p},chatContainer:'<div class="sjb-webim-talk"></div>',chatHeader:function(a){return sjb.messaging.comoon.view.generateChatHeader(a)},groupChatHeader:function(a,b){var c=a.userId,d="",e="",f="";$.each(c,function(a){var b=webChat.getUser(c[a]);if(b){var f=$.sjbwebimAction.checkUserType(b.getUserTypeInfo());f&&(""===f.name?d=c[a]:""===f.name&&(e=c[a]))}}),(d||e)&&(f='<button class="sjb-webim-get-server-time" data-uids="'+c+'"></button>');var g='<div class="sjb-webim-talk-header" data-height="57">    <div class="sjb-webim-talk-a es-drag-control">        <h2 class="es-drag-control" title="'+a.name+'">'+a.name+"</h2>        "+f+'        <a href="javascript:;" class="sjb-webim-group-showlink"><i class="sjb-webim-icon sjb-webim-icon-arrow"></i></a>    </div>    <div class="sjb-webim-group-members">        <ul>'+b+'            <li class="show-more">                <a href="javascript:;" data-chatid="'+a.chatId+'"></a>            </li>        </ul>    </div></div>';return g},groupChatHeaderItem:function(a){var b=webChat.getUser(a.userId),c=b.onlineStatus===sjb.messaging.im.OnlineStatus.OFFLINE?2:0,d=$.sjbwebimTemp.status(Number(c)),e='<li class="member">    <div class="sjb-webim-userhead">        <img src="'+a.userhead+'" width="34" height="34">        <i class="sjb-webim-icon sjb-webim-head-mask-fff"></i>    </div>    <div class="sjb-webim-status '+d+'">        <i class="sjb-webim-icon"></i>    </div></li>';return e},chatBody:'<div class="sjb-webim-talk-article" id="sjb-webim-talk-scrollbar"><div class="sjb-webim-talk-list es-scrollbar-container"><div class="es-scrollbar-main"><ul></ul></div></div></div>',chatItem:function(type,data,msgId,statu){var contentTxt="",content,metaDate="",msgType=1;if(data){contentTxt=data.content;try{content=eval("("+data.content+")"),msgType=content.type,contentTxt=3===msgType?sjb.messaging.comoon.rule.toImg(JSON.parse(data.content)):content.text,"undefined"!=typeof content.metadata&&(metaDate=content.metadata,3===metaDate.msgType&&(contentTxt=sjb.messaging.comoon.rule.toImg(JSON.parse(data.content)),msgType=3))}catch(e){}}contentTxt=sjb.messaging.comoon.rule.encode(contentTxt);var html="";if(0===type){var identity=data.identityIconUrl?'<img src="'+data.identityIconUrl+'">':"";identity=data.identityIconName?'<a href="javascript:;" class="item-name-act">'+identity+"<span>"+data.identityIconName+"</span></a>":'<a href="javascript:;" class="item-name-act">'+identity+"</a>",html='<li class="item item-left sjb-webim-talk-item-'+msgId+'">    <h3 class="item-name">        '+data.name+identity+'    </h3>    <div class="sjb-webim-userhead">        <img src="'+data.userhead+'" width="34" height="34">        <i class="sjb-webim-icon sjb-webim-head-mask-fff"></i>    </div>    <div class="item-content">        <i class="sjb-webim-icon item-radius-top"></i>        <i class="sjb-webim-icon item-radius-right"></i>        <i class="sjb-webim-icon item-radius-bottom"></i>        <i class="sjb-webim-icon item-radius-left"></i>        <div class="item-content-text" data-content="'+contentTxt+'" data-meta="'+metaDate+'">'+sjb.messaging.comoon.rule.display(contentTxt,sjbwebimParams.userSelf.type,msgType,metaDate)+"</div>    </div></li>"}else if(1===type){var messageStatu="",messageStatuClass="";contentTxt="undefined"==typeof contentTxt?data.content:contentTxt,0===statu?(messageStatuClass=" item-statu-loading",messageStatu='<div class="item-loading"></div>'):1===statu?(messageStatuClass=" item-statu-error",messageStatu='<div class="item-error item-error-inner">    <span><i class="sjb-webim-icon sjb-webim-icon-error"></i><a href="javascript:;" data-sendmsgid="'+msgId.replace("send-","")+'"></a></span></div>'):2===statu&&(messageStatuClass=" item-statu-error",messageStatu='<div class="item-stop item-error-inner">    <span></span></div>'),html='<li class="item item-right'+messageStatuClass+" sjb-webim-talk-item-"+msgId+'">    <div class="item-content">        <div class="opacity">           <i class="sjb-webim-icon item-radius-top"></i>           <i class="sjb-webim-icon item-radius-right"></i>           <i class="sjb-webim-icon item-radius-bottom"></i>           <i class="sjb-webim-icon item-radius-left"></i>           <div class="item-content-text" data-content="'+contentTxt+'" data-meta="'+metaDate+'">'+sjb.messaging.comoon.rule.display(contentTxt,sjbwebimParams.userSelf.type,msgType,metaDate)+"</div>        </div>"+messageStatu+"    </div></li>"}else html=2===type?'<li class="item item-center item-loading"><div class="item-loading-content"><ul></ul></div></li>':3===type?'<li class="item item-center item-more">    <a href="javascript:;">...</a></li>':4===type?'<li class="item item-center item-loading-msg sjb-webim-talk-item-'+msgId+'"><span><i></i></span></li>':5===type?'<li class="item item-center item-error">    <span><i class="sjb-webim-icon sjb-webim-icon-error"></i><a href="javascript:;"></a></span></li>':6===type?'<li class="item item-center item-fail">    <span><i class="sjb-webim-icon sjb-webim-icon-error"></i><a href="javascript:;"></a></span></li>':7===type?'<li class="item item-center item-loading item-loading-center"><div class="item-loading-content"><ul></ul></div></li>':'<li class="item item-timer">'+data.timer+"</li>";return html},chatFooter:function(){return sjb.messaging.comoon.view.generateChatFooter()},webimEntry:'<div id="'+sjbwebimParams.ids.entry.replace("#","")+'">    <a href="javascript:;">        <div class="sjb-webim-total">            <span class="sjb-webim-total-l"></span>            <span class="sjb-webim-total-c"><strong>0</strong></span>            <span class="sjb-webim-total-r"></span>        </div>     </a></div>',
searchCenter:function(){var a='<div class="sjb-webim-search-user">    <div>        <i class="sjb-webim-icon sjb-webim-icon-del-search"></i>        <input type="text" placeholder=" uid ">        <button><i class="sjb-webim-icon sjb-webim-icon-del-result"></i></button>    </div></div>';return a},userDetail:function(a){var b=a.identityIconUrl?'<img src="'+a.identityIconUrl+'">':"";b=a.identityIconName?b+a.identityIconName:b+"";var c=a.shopname?'<div class="sjb-webim-shopname">'+a.shopname+"</div>":"",d='<div class="sjb-webim-user-detail es-drag-control">    <div class="sjb-webim-userhead">        <img src="'+a.userhead+'" width="100" height="100">        <i class="sjb-webim-icon sjb-webim-head-mask-fff"></i>    </div>    <div class="sjb-webim-name"><strong>'+a.name+"</strong></div>"+c+'    <div class="sjb-webim-identity"><span>'+b+'</span></div>    <div class="sjb-webim-user-detail-act">        <ul>            <li><button class="btn-blue sjb-webim-start-chat" data-chatid="'+a.chatId+'" data-userid="'+a.userId+'"></button></li>            <li>                <div class="sjb-webim-inputlabel">                    <label> UID</label>                    <input type="text" value="'+a.userId+'" readonly>                </div>            </li>        </ul>    </div></div>';return d},groupItem:function(a,b){var c=b%2===0?" item-hasbg":"",d=b%2===0?"f3f3f3":"fff",e=""!==a.identityIconUrl?'<img src="'+a.identityIconUrl+'">':"",f=""!==a.identityIconName?'<div class="sjb-webim-identity">'+e+a.identityIconName+"</div>":"",g=webChat.getUser(a.userId),h=g.onlineStatus===sjb.messaging.im.OnlineStatus.OFFLINE?2:0,i=$.sjbwebimTemp.status(Number(h)),j='<div class="sjb-webim-status '+i+'">   <i class="sjb-webim-icon"></i></div>',k='<li class="item'+c+'">   <div class="sjb-webim-userinfo">        <span title="'+a.name+'">            <div class="item-left">                <div class="sjb-webim-userhead">                    <img src="'+a.userhead+'" width="34" height="34">                    <i class="sjb-webim-icon sjb-webim-head-mask-'+d+'"></i>                </div>'+j+'                <div class="sjb-webim-name"><strong>'+a.name+"["+a.uid+']</strong></div>            </div>            <div class="item-right">                '+f+"            </div>        </span>    </div> </li>";return k},groupDetail:function(a){for(var b=a.userId,c="",d=0;d<b.length;d++){var e=null,f=null,g={};b[d]!==sjbwebimParams.userSelf.uid?(e=webChat.getUser(b[d]),f=$.sjbwebimAction.checkUserType(e.getUserTypeInfo()),g={name:e.nickname,uid:b[d],userhead:e.iconUrl,identityIconUrl:f.iconUrl,identityIconName:f.name}):g={name:sjbwebimParams.userSelf.name,uid:sjbwebimParams.userSelf.uid,userhead:sjbwebimParams.userSelf.userhead,identityIconUrl:sjbwebimParams.userSelf.identityIconUrl,identityIconName:sjbwebimParams.userSelf.identityIconName},g.userId=b[d],c+=$.sjbwebimTemp.groupItem(g,d)}var h='<div class="sjb-webim-group-detail es-drag-control">    <h3>'+a.name+'</h3>    <div id="sjb-webim-group-srcoll"><div class="es-scrollbar-container"><div class="sjb-webim-group-detail-list es-scrollbar-main">        <ul>'+c+'</ul>    </div></div></div>    <div class="sjb-webim-group-detail-act">        <button class="btn-blue sjb-webim-start-chat" data-chatid="'+a.chatId+'" data-userid="'+a.userId+'"></button>    </div></div>';return h},shortcuts:function(){var a='<div id="sjb-webim-set-shortcuts">    <ul>        <li><a href="javascript:;"><span><i class="sjb-webim-icon sjb-webim-check-mark"></i> Ctrl+Enter </span></a></li>        <li><a href="javascript:;"><span><i class="sjb-webim-icon sjb-webim-check-mark"></i> Enter </span></a></li>    </ul></div>';return a},tips:function(a){var b=['<span class="sjb-webim-text-red"></span><span class="sjb-webim-text-red"></span><span class="sjb-webim-text-red"></span>~<a href="//www.shijiebang.com/reg/?refer=im" class="btn-blue sjb-webim-tips-read" data-type="0" target="_blank"></a><a href="javascript:;" class="btn-gray sjb-webim-tips-read" data-type="0"></a>','<span class="sjb-webim-text-red"></span>App<br><a href="//www.shijiebang.com/topic/app-main/" target="_blank" class="btn-blue sjb-webim-tips-read" data-type="1"></a><a href="javascript:;" class="btn-gray sjb-webim-tips-read" data-type="1"></a>','<a href="javascript:;" class="btn-gray sjb-webim-tips-read" data-type="2"></a>','  <a href="javascript:;" class="btn-gray sjb-webim-reload-login"></a>'],c='<div class="sjb-webim-tips">    <div class="sjb-webim-tips-con">       '+b[a]+"    </div></div>";return c},serverTimeTemp:function(a){var b=function(a,b){var c=[],d=[];return a=a.replace(/\s/g,""),c=a.split("-"),a=new Date(c[0],parseInt(c[1])-1,c[2]),b=24*b*60*60*1e3,a=new Date(a.getTime()+b),d={year:a.getFullYear(),month:a.getMonth()+1,day:a.getDate(),week:a.getDay()+1}},c=function(a,c){var d=a.length;if(a.length<31)for(var e=0;31-d>e;e++)a.push(-1);for(var f={},g=b(c,0),h=b(c,a.length-1),i=7===g.week?0:g.week-1,j=7===h.week?6:6-h.week,k=0,l=i;l>0;l--){var m=b(c,-1*l);f[k]={index:k,year:m.year,month:m.month,day:m.day,week:m.week,is_work:-1,is_current:!1},k++}$.each(a,function(d){var e=b(c,d),g=0===parseInt(d)?!0:!1;f[k]={index:k,year:e.year,month:e.month,day:e.day,week:e.week,is_work:a[d],is_current:g},k++});for(var n=0;j>=n;n++){var o=b(c,k-i);f[k]={index:k,year:o.year,month:o.month,day:o.day,week:o.week,is_work:-1,is_current:!1},k++}var p="<tr>";return $.each(f,function(a,b){var c=Boolean(b.is_current)===!0?"":b.day,d=Boolean(b.is_current)===!0?" sjb-webim-current":"",e="",f="",g=parseInt(b.is_work);f=1===g?"sjb-webim-on":0===g?"sjb-webim-off":"sjb-webim-no",e='<td class="'+f+d+'"><span>'+c+"<i></i></span></td>",a=parseInt(a),(a+1)%7===0&&k-1>a&&(e+="</tr><tr>"),p+=e}),p+"</tr>"},d="",e='<tr><td colspan="7"></td></tr>',f="";return(a.doyen.work_day.start||a.doyen.work_day.end)&&(d=""+a.doyen.work_day.start+"-"+a.doyen.work_day.end),a.sale.days&&a.sale.days.length>0&&(e=c(a.sale.days,a.sale.current_date)),f='<div class="sjb-webim-server-time"><i></i>    <div class="sjb-webim-server-time-item sjb-webim-server-doyen">        <h3>             '+a.doyen.name+'             <div class="sjb-webim-userhead">                    <img width="34" height="34" src="'+a.doyen.icon+'">                  <i class="sjb-webim-icon sjb-webim-head-mask-f3f3f3"></i>              </div>        </h3>        <div class="sjb-webim-server-time-content">'+d+'        </div>    </div>    <div class="sjb-webim-server-time-item sjb-webim-server-sale">        <h3>             '+a.sale.name+'             <div class="sjb-webim-userhead">                    <img width="34" height="34" src="'+a.sale.icon+'">                 <i class="sjb-webim-icon sjb-webim-head-mask-f3f3f3"></i>                </div>        </h3>        <div class="sjb-webim-server-time-content">            <table cellspacing="0" cellpadding="0">                <thead>                    <tr>                        <th></th>                        <th></th>                        <th></th>                        <th></th>                        <th></th>                        <th></th>                        <th></th>                    </tr>                </thead>                <tbody>'+e+'                </tbody>            </table>        </div>    </div>    <div class="sjb-webim-server-time-tips"><i></i><br>4006-345-100</div></div>'}},$.sjbwebimAction={creatFollow:function(a){var b=$($.sjbwebimTemp.webimEntry),c={};for(var d in a)c[d]=a[d];c.opacity=1,b.css(c).appendTo("body"),"none"!==c.display&&b.fadeIn(300)},getFollowPosition:function(){var a=$(sjbwebimParams.ids.entry),b=$(window).scrollTop(),c=$(window).scrollLeft(),d=a.offset(),e=a.width(),f=a.height(),g=$(window).width(),h=$(window).height(),i={width:0,height:0,right:g-(d.left-c+e),bottom:h-(d.top-b+f),left:"auto",top:"auto",opacity:0};return i},createWindow:function(a,b,c){var d=$($.sjbwebimTemp.container);a.opacity=0,b.opacity=1;for(var e in b)sjbwebimParams.style[e]=b[e];d.css(b).appendTo("body"),c&&$.isFunction(c)&&c(d),$(sjbwebimParams.ids.entry).trigger("sjbwebim.colsedTip")},openWindow:function(){var a=$(sjbwebimParams.ids.win);a.css(sjbwebimParams.style).show(),$(sjbwebimParams.ids.entry).trigger("sjbwebim.colsedTip")},closedWindow:function(){var a=$(sjbwebimParams.ids.win),b=$.sjbwebimAction.getFollowPosition();a.css(b).hide(),$(sjbwebimParams.ids.entry).trigger("sjbwebim.openTip")},createLayout:function(a,b){var c=$($.sjbwebimTemp.layout),d=c.find(".sjb-webim-left"),e=c.find(".sjb-webim-center"),f=c.find(".sjb-webim-right");d.width(60),e.width(160),f.width(459),a.html(c),c.after($.sjbwebimTemp.closedBtn),$.sjbwebimAction.createTabNav(d);var g=e.find(".sjb-webim-tab-main");g.html($.sjbwebimTemp.contactListContainer),g.eq(1).prepend($.sjbwebimTemp.searchCenter()),$.each(g,function(a){if($(this).find(".sjb-webim-center-scrollbar").estormScrollbar(),0===a){var b=$(this).find(".es-scrollbar-bar"),c=b[0]?16:0;b.find(".sjb-webim-list-remove").css({right:c})}}),b&&$.isFunction(b)&&b(a,c,d,e,f)},createTabNav:function(a){var b=$($.sjbwebimTemp.tabNav(!0)),c=b.find("li");c.hide(),a.html(b);var d=function(){var b=$($.sjbwebimTemp.selfInfo(sjbwebimParams.userSelf));b.hide(),a.append(b),b.fadeIn(300)};2===c.length?c.eq(0).fadeIn(300,function(){c.eq(1).fadeIn(300,function(){d()})}):c.eq(0).fadeIn(300,function(){c.eq(1).fadeIn(300,function(){c.eq(2).fadeIn(300,function(){d()})})})},updateTotalUnread:function(a){var b=$(sjbwebimParams.ids.entry),c=b.find(".sjb-webim-total"),d=c.find(".sjb-webim-total-c strong"),e=$(sjbwebimParams.ids.win),f=!0;if(e[0]&&!e.is(":hidden")&&(f=!1,d=e.find(".sjb-webim-nav .sjb-webim-number .sjb-webim-number-t")),sjbwebimParams.updateTotalUnread.timer&&(clearInterval(sjbwebimParams.updateTotalUnread.timer),sjbwebimParams.updateTotalUnread.timer=null),a){var g=a>99?"99+":a;if(g=g.toString(),d.text(g||""),f===!0)b.find("a").addClass("has-new-msg"),c.is(":hidden")&&c.show().width(c.find(".sjb-webim-total-c").outerWidth()),!sjbwebimParams.userSelf||5!==sjbwebimParams.userSelf.type&&0!==sjbwebimParams.userSelf.type||setTimeout(function(){b.find("a.has-new-msg").click()},2e3);else{var h=0;2===g.length?h=3:3===g.length&&(h=10),d.closest(".sjb-webim-number").show(),d.closest(".sjb-webim-number").find(".sjb-webim-number-c").width(h)}for(var i=0,j=""+a+" "+sjbwebimParams.updateTotalUnread.title,k="",l=0;l<Math.ceil(a.toString().length/2);l++)k+="";var m=""+k+""+sjbwebimParams.updateTotalUnread.title;sjbwebimParams.updateTotalUnread.timer=setInterval(function(){document.title=i?m:j,i^=1},1e3)}else document.title=sjbwebimParams.updateTotalUnread.title,b.find(".sjb-webim-total .sjb-webim-total-c strong").text("0"),d.text("0"),f===!0?(b.find("a").removeClass("has-new-msg"),c.is(":hidden")||c.width(0).hide()):d.closest(".sjb-webim-number").hide()},chatListHandler:function(){var a=$.sjbwebimAction,b=$(sjbwebimParams.ids.win),c=b.find(">.sjb-webim-blocker"),d=b.find(".sjb-webim-center"),e=d.find(".sjb-webim-tab-main"),f=e.eq(1).find(".sjb-webim-userlist ul"),g=webChat.getSingleChatList(),h="",i="";f.empty(),achatList.clear(),gchatList.clear(),schatList.clear(),schatList.addAll(g),achatList.addAll(g),$.each(schatList.toJSON(),function(a,b){var c=buildSingleDataBySdkChat(b);h+=$.sjbwebimTemp.contactListItem(c)}),f.html(h),$.each(f.find(".sjb-webim-status-off"),function(){var a=$.sjbwebimAction.getBowerType(),b=$(this).prev(".sjb-webim-userhead").find("img");b.addClass("sjb-webim-status-off-img"),"IE"===a[0]&&Number(a[1])>9&&grayscale(b)});var j=e.eq(2).find(".sjb-webim-userlist ul"),k=webChat.getGroupChatList();j.empty(),gchatList.addAll(k),achatList.addAll(k),$.each(gchatList.toJSON(),function(a,b){var c=buildGroupDataBySdkChat(b);i+=$.sjbwebimTemp.contactListItem(c)}),j.html(i),achatList.getUnreadCount()>8?tchatList.addAll(achatList.unreadToJSON()):tchatList.addAll(achatList.top(8));var l=-1;sjbwebimParams.data.initialized||(sjbwebimParams.data.initialized=!0,tchatList.updateConfig({sortType:"insert_time"}),sjbwebimParams.data.tempUid||sjbwebimParams.data.tempGroupChatId||0!=c.length||(l=tchatList.size()-1)),tchatList.reach(function(a,b){var c=-1!=l&&a==l;$.sjbwebimAction.checkUserInTalk(b.getChatId(),b.getUids(),b.getUnreadCounter(),c),$.sjbwebimAction.updateChatUnreadHandler(b.getChatId(),b.getUnreadCounter())}),(sjbwebimParams.data.tempUid||sjbwebimParams.data.tempGroupChatId)&&Chat.createChat({uid:sjbwebimParams.data.tempUid,cid:sjbwebimParams.data.tempGroupChatId},function(a){var b=a.getSdkChat();sjbwebimParams.data.isFromConsult&&sjbwebimParams.data.tempUid&&sjb.messaging.comoon.method.runOnce([sendTrackUrl,sendBindMsg],{frequency:50,conditions:[{source:sjbwebimParams,param:"user",method:"self"}],context:null,fixed:[b]}),tchatList.add(b),$.sjbwebimAction.checkUserInTalk(b.getChatId(),b.getUids(),b.getUnreadCounter(),!0),sjbwebimParams.data.tempUid=null,sjbwebimParams.data.tempGroupChatId=null,sjbwebimParams.data.isFromConsult=!1});var m=d.find(".sjb-webim-center-scrollbar");if($.each(m,function(a){m.eq(a).trigger("esScrollbarUpdate",[0,0])}),c.length>0)switch(c.data("type")){case"CREATE_CHAT":c.data("times",c.data("times")+1);var n=c.data("uid"),o=null;$.each(g,function(a,b){var c=b.peerUserId();return c==n?(o=b,!1):void 0}),o?(tchatList.add(o),a.checkUserInTalk(o.getChatId(),n,0,!0),c.remove(),$.sjbwebimHooks.falseUser&&$.sjbwebimHooks.falseUser.reconnet&&$.isFunction($.sjbwebimHooks.falseUser.reconnet)&&$.sjbwebimHooks.falseUser.reconnet(o.getChatId())):c.data("times")>=5&&c.remove()}},switchChatHandler:function(a,b,c){var d=$(sjbwebimParams.ids.win),e=d.find(".sjb-webim-center"),f=d.find(".sjb-webim-right");if($.sjbwebimAction.loadEarlierMessageTs=0,0!==b&&"kanbujianwo"!==b){sjbwebimParams.data.maxMsgId=0,sjbwebimParams.data.isLoadMsg=!1,sjbwebimParams.data.isLast=!1,sjbwebimParams.data.timer=[];e.find(".sjb-webim-tab-talk");e.find("li.sjb-webim-chatid-"+b).addClass("current").siblings("li").removeClass("current");var g=$($.sjbwebimTemp.chatContainer),h=$.sjbwebimAction.createTalkHeader(),i=$.sjbwebimTemp.chatBody,j=$.sjbwebimTemp.chatFooter();g.append(h+i+j),f.html(""),f.html(g),buildGroupShellLink(b),sjb.messaging.comoon.emoji.buildImEmoji(),sjbwebimParams.user&&(buildFastReply(sjbwebimParams.user),buildImgUpload(sjbwebimParams.user)),$.each(f.find(".sjb-webim-status-off"),function(){var a=$.sjbwebimAction.getBowerType(),b=$(this).prev(".sjb-webim-userhead").find("img");b.addClass("sjb-webim-status-off-img"),"IE"===a[0]&&Number(a[1])>9&&grayscale(b)});var k=sjbwebimParams.data.current.userId;k.toString().indexOf(",")>-1&&g.addClass("sjb-webim-group-talk"),$("#sjb-webim-editor").val(c),$.sjbwebimAction.updateScroll()}else if("kanbujianwo"===b){e.find(".sjb-webim-tab-talk");e.find("li.sjb-webim-chatid-"+b).addClass("current").siblings("li").removeClass("current");var g=$($.sjbwebimTemp.chatContainer),h='<div class="sjb-webim-talk-header"><div class="sjb-webim-talk-a es-drag-control"><a target="_blank" href="" class="sjb-webim-substitutereg"></a><h2 data-chatid="kanbujianwo" data-uid="'+$.sjbwebimHooks.falseUser.uid+'">'+$.sjbwebimHooks.falseUser.name+'</h2><br><div class="sjb-webim-identity"></div></div></div>',i=$.sjbwebimTemp.chatBody,j=$.sjbwebimTemp.chatFooter();g.append(h+i+j),g.find(".sjb-webim-submit").data("ttyle","kanbujianwo").data("uid",$.sjbwebimHooks.falseUser.uid),f.html(""),f.html(g)}},createTalkHeader:function(){var a=null;if("number"==typeof sjbwebimParams.data.current.userId){var b=webChat.getUser(sjbwebimParams.data.current.userId),c=$.sjbwebimAction.checkUserType(b.getUserTypeInfo()),d={chatId:sjbwebimParams.data.current.chatId,userId:sjbwebimParams.data.current.userId,name:b.nickname,userhead:b.iconUrl,identityIconUrl:c.iconUrl,identityIconName:c.name};a=$.sjbwebimTemp.chatHeader(d)}else{for(var e=sjbwebimParams.data.current.userId,f=sjbwebimParams.data.current.chatId,g=gchatList.get(f),h=buildGroupDataBySdkChat(g),i="",j=e.split(","),k=0;k<j.length;k++){var l=webChat.getUser(j[k]),m={userId:j[k],name:l.nickname,userhead:l.iconUrl};i+=$.sjbwebimTemp.groupChatHeaderItem(m)}a=$.sjbwebimTemp.groupChatHeader(h,i)}return a},formatDate:function(a){var b=new Date(a);if(!b)return"";var c=b.getFullYear(),d=b.getMonth()+1,e=b.getDate(),f=b.getHours(),g=b.getMinutes(),h=b.getSeconds(),i=["","","","","","",""],j=i[b.getDay()];return c+"-"+(10>d?"0"+d:d)+"-"+(10>e?"0"+e:e)+" "+j+" "+(10>f?"0"+f:f)+":"+(10>g?"0"+g:g)+":"+(10>h?"0"+h:h)},compareTimer:function(a){if(!a||"undefined"==typeof a)return"";var b=6e5,c="",d=null;if(sjbwebimParams.data.timer[0]||sjbwebimParams.data.timer[1]){if(sjbwebimParams.data.timer[0]&&!sjbwebimParams.data.timer[1])sjbwebimParams.data.timer[1]=a,d=$.sjbwebimAction.formatDate(a);else if(!(a>sjbwebimParams.data.timer[0]&&a<sjbwebimParams.data.timer[1])){var e=0;a<sjbwebimParams.data.timer[0]?(e=sjbwebimParams.data.timer[0]-a,e>b&&(sjbwebimParams.data.timer[0]=a,d=$.sjbwebimAction.formatDate(a))):(e=a-sjbwebimParams.data.timer[1],e>b&&(sjbwebimParams.data.timer[1]=a,d=$.sjbwebimAction.formatDate(a)))}}else sjbwebimParams.data.timer[0]=a,d=$.sjbwebimAction.formatDate(a);return d&&(c=$.sjbwebimTemp.chatItem(null,{timer:d})),c},loadEarlierMessageTs:0,updateScroll:function(){$("#sjb-webim-talk-scrollbar").estormScrollbar({position:"bottom",callback:function(a,b,c,d,e,f,g){if(0===d&&sjbwebimParams.data.isLast===!1){var h=Date.now();if($.sjbwebimAction.loadEarlierMessageTs+1e3<h){$.sjbwebimAction.loadEarlierMessageTs=h,sjbwebimParams.data.isLoadMsg=!0;var i=webChat.getOlderMessages();$.sjbwebimAction.appendMsg(i)}}}})},appendMsg:function(a){for(var b=$(sjbwebimParams.ids.win),c=b.find(".sjb-webim-right"),d=c.find(".sjb-webim-talk .sjb-webim-talk-list ul"),e=$("#sjb-webim-talk-scrollbar"),f=e.find(".es-scrollbar-main").height(),g="",h=0,i=a.length,j=0===sjbwebimParams.data.maxMsgId,k=sjbwebimParams.data.maxMsgId,l=0;i>l;l++){var m=a[l],n=c.find("li.sjb-webim-talk-item-"+m.messageId);if(n[0]||("undefined"==typeof m.message?j?g+=$.sjbwebimTemp.chatItem(4,null,m.messageId):g=$.sjbwebimTemp.chatItem(4,null,m.messageId)+g:(j?g+=$.sjbwebimAction.compareTimer(m.utcTimestamp)+$.sjbwebimAction.replaceMsg(m.message):g=$.sjbwebimAction.compareTimer(m.utcTimestamp)+$.sjbwebimAction.replaceMsg(m.message)+g,h++),sjbwebimParams.data.maxMsgId=Number(m.messageId)>sjbwebimParams.data.maxMsgId?Number(m.messageId):sjbwebimParams.data.maxMsgId),m.message&&m.message.content&&sjbwebimParams.user&&sjbwebimParams.userSelf.type){var o=sjb.messaging.comoon.method.decodeMessage(m.message.content);o&&(o.text||o.metadata)&&sjb.messaging.comoon.view.updateSubstitute(b,o.metadata)}}var p=sjbwebimParams.data.maxMsgId>k?!0:!1;if(h===i)p?d.append(g):d.prepend(g);else{var q=j?$.sjbwebimTemp.chatItem(7):$.sjbwebimTemp.chatItem(2),r=$(q);r.find(".item-loading-content ul").html(g),r.data("drect",p),p?d.append(r):d.prepend(r)}if(d.find("li.item-more")[0]&&d.find("li.item-more").remove(),10>i&&i>1?sjbwebimParams.data.isLast=!0:10===i&&d.prepend($.sjbwebimTemp.chatItem(3)),p){var s=function(){var a=e.find(".es-scrollbar-bar"),b=e.find(".es-scrollbar-drag"),c=0;return a.offset()&&b.offset()&&(c=a.offset().top+a.outerHeight()-(b.offset().top+b.outerHeight())),c>10?!1:!0};s()?e.trigger("esScrollbarUpdate",[1,"bottom"]):e.trigger("esScrollbarUpdate")}else e.trigger("esScrollbarUpdate",[0,f])},replaceMsg:function(a){var b=a.messageId,c="",d={},e=$(sjbwebimParams.ids.win),f=e.find(".sjb-webim-right"),g=(f.find(".sjb-webim-talk .sjb-webim-talk-list ul"),$("#sjb-webim-talk-scrollbar")),h=g.find(".es-scrollbar-main").height(),i=$("li.sjb-webim-talk-item-"+b);if(a.senderId===sjbwebimParams.userSelf.uid)d={content:a.content},c=$.sjbwebimTemp.chatItem(1,d,b);else{var j=webChat.getUser(a.senderId);if(j){var k=$.sjbwebimAction.checkUserType(j.getUserTypeInfo());d={name:j.nickname,userhead:j.iconUrl,identityIconUrl:k.iconUrl,identityIconName:k.name,content:a.content}}else d={name:"",userhead:"//s2.sjbly.cn/img/avt_180.png",identityIconUrl:"",identityIconName:"",content:a.content};c=$.sjbwebimTemp.chatItem(0,d,b)}if(c=$.sjbwebimAction.compareTimer(a.utcTimestamp)+c,!i[0])return c;var l=i.parent("ul"),m=l.closest(".item-loading").data("drect");if(i.replaceWith(c),d.content&&sjbwebimParams.userSelf.type){var n=sjb.messaging.comoon.method.decodeMessage(d.content);n&&(n.text||n.metadata)&&sjb.messaging.comoon.view.updateSubstitute(e,n.metadata)}var o=l.find(".item-loading-msg").length;l.find("li").length;if(0===o){var p=l.html();if(l.closest(".item-loading").replaceWith(p),m){var q=function(){var a=g.find(".es-scrollbar-bar"),b=g.find(".es-scrollbar-drag"),c=0;return a.offset()&&b.offset()&&(c=a.offset().top+a.outerHeight()-(b.offset().top+b.outerHeight())),c>10?!1:!0};q()?g.trigger("esScrollbarUpdate",[1,"bottom"]):g.trigger("esScrollbarUpdate")}else g.trigger("esScrollbarUpdate",[0,h]);webChat.markCurrentChatAsRead(),sjbwebimParams.data.isLoadMsg=!1}},createTalk:function(a){var b=$(sjbwebimParams.ids.win),c=(new Date).getTime(),d=(b.find(".sjb-webim-left"),b.find(".sjb-webim-center"),b.find(".sjb-webim-right"),$("<div class='sjb-webim-blocker' data-time='"+c+"'><div class='sjb-webim-msg-loading'></div></div>"));d.data({uid:a,type:"CREATE_CHAT",times:0}),b.append(d),setTimeout(function(){var e=b.find(".sjb-webim-blocker[data-time="+c+"]");e.length>0&&(d.remove(),alert("UID"+a+""))},3e4),webChat.createSingleChat(a,function(a){d.data("cid",a)})},checkUserInTalk:function(a,b,c,d){var e=$(sjbwebimParams.ids.win),f=e.find(".sjb-webim-left"),g=e.find(".sjb-webim-center"),h=(e.find(".sjb-webim-right"),function(){var b=null,c=tchatList.get(a);if(c&&(b=c.isGroup()?buildGroupDataBySdkChat(c):buildSingleDataBySdkChat(c))){var e=$($.sjbwebimTemp.contactListItem(b,0));g.find(".sjb-webim-tab-talk ul").prepend(e),d&&e.trigger("click",function(){$.sjbimPub("imWinInit",e)}),$.each(g.find(".sjb-webim-status-off"),function(){var a=$.sjbwebimAction.getBowerType(),b=$(this).prev(".sjb-webim-userhead").find("img");b.addClass("sjb-webim-status-off-img"),"IE"===a[0]&&Number(a[1])>9&&grayscale(b)}),g.find(".sjb-webim-center-scrollbar").eq(0).trigger("esScrollbarUpdate",[0,0]);var f=g.find(".sjb-webim-center-scrollbar").eq(0),h=f.find(".es-scrollbar-bar"),i=h[0]?16:0;f.find(".sjb-webim-list-remove").css({right:i})}});Chat.createChat({uid:b,cid:a},function(a){var b=sjbwebimParams.data.currTab;0!==Number(b)&&f.find(".sjb-webim-nav li").eq(0).trigger("click");var c=a.getSdkChat(),e=g.find(".sjb-webim-tab-talk ul li.item[data-chatid="+c.id+"]");e[0]?d&&e.trigger("click",function(){$.sjbimPub("imWinInit",e)}):h()})},updateChatUnreadHandler:function(a,b){var c=$(sjbwebimParams.ids.win);if(0!=c.length){var d=c.find(".sjb-webim-center"),e=1;b>0&&tchatList.add(achatList.get(a)),$.sjbwebimAction.checkUserInTalk(a,null,b,!1);var f=d.find(".sjb-webim-tab-talk .sjb-webim-chatid-"+a);if(f[0]){var g=f.find(".sjb-webim-number");if(b){var h=b>99?"99+":b;h=h.toString(),2===h.length?e=3:3===h.length&&(e=10),g.find(".sjb-webim-number-t").text(h||""),g.find(".sjb-webim-number-c").width(e),g.show();var i=d.find(".sjb-webim-tab-talk li").eq(0);i.hasClass("sjb-webim-chatid-"+a)||(i.before(f),tchatList.reinsert(achatList.get(a)))}else g.find(".sjb-webim-number-t").text(0),g.find(".sjb-webim-number-c").width(e),g.hide()}}},checkUserType:function(a){return"undefined"==typeof a&&(a={},a.iconUrl="",a.name=""),a},destroy:function(){var a=$(sjbwebimParams.ids.win);a.remove()},reloadLogin:function(a){var b=$(sjbwebimParams.ids.win),c=$(sjbwebimParams.ids.entry),d=b[0]?!0:!1;b.remove(),c.remove(),$("body").trigger("sjbwebim.relogin"),d&&$(sjbwebimParams.ids.entry).trigger("click")},creatYellowTips:function(){var a=$.cookie("sjbWebimTips");"undefined"==typeof a&&($.cookie("sjbWebimTips","0|0|0",sjbwebimParams.cookieOptions),a=$.cookie("sjbWebimTips"));var b=function(a){for(var b=a.split("|"),c=[],d=0;d<b.length;d++)c[d]=b[d];return c},c=function(a,c){var d=$.cookie("sjbWebimTips"),e=b(d);$.each(e,function(b){b===a&&(e[b]=c)});var f=e.join("|");$.cookie("sjbWebimTips",f,sjbwebimParams.cookieOptions)},d=null,e=$.cookie("sjbWebimTips"),f=b(e);if(sjb.messaging.im.User.prototype.isVisitor()?0===Number(f[0])&&(d=$.sjbwebimTemp.tips(0)):0===Number(f[1])?d=$.sjbwebimTemp.tips(1):0===Number(f[2])&&(d=$.sjbwebimTemp.tips(2)),d){var g=$(sjbwebimParams.ids.win);if(g[0]){var h=$(d);h.find(".sjb-webim-tips-read").on("click",function(){var a=Number($(this).data("type"));c(a,"1"),$(this).closest(".sjb-webim-tips").remove()}),g.append(h)}}},buttonIsParent:function(a){setTimeout(function(){$.sjbwebimAction.updateOnlineStatus(a,function(){setTimeout(function(){$.sjbwebimAction.buttonIsParent(a)},12e4)})},1e3)},updateOnlineStatus:function(a,b){var c=[];$.each($(a),function(){var a=$(this).data("subuid")?Number($(this).data("subuid")):Number($(this).data("id"));c.push(a)});var d=!0;webChat.queryOnlineStatus(c,d,function(c){$.each(c,function(b,c){var d=$(a+'[data-id="'+b+'"]');d[0]&&(c!==sjb.messaging.im.OnlineStatus.OFFLINE?d.removeClass("sjb-webim-user-offline webim-unline-click"):d.addClass("sjb-webim-user-offline webim-unline-click"))}),b()})},updateOnline:function(a,b){var c=$(sjbwebimParams.ids.win),d=c.find(".sjb-webim-tab-single ul"),e=d.find('li[data-userid="'+a+'"]'),f=e.find(".sjb-webim-status"),g=e.find(".sjb-webim-userhead img"),h=$.sjbwebimAction.getBowerType();b.onlineStatus!==sjb.messaging.im.OnlineStatus.OFFLINE?(f.removeClass("sjb-webim-status-leave sjb-webim-status-off").addClass("sjb-webim-status-on"),g.removeClass("sjb-webim-status-off-img"),"IE"===h[0]&&Number(h[1])>9&&grayscale.reset(g)):(f.removeClass("sjb-webim-status-leave sjb-webim-status-on").addClass("sjb-webim-status-off"),g.addClass("sjb-webim-status-off-img"),"IE"===h[0]&&Number(h[1])>9&&grayscale(g))},getBowerType:function(){var a,b={},c=navigator.userAgent.toLowerCase();(a=c.match(/rv:([\d.]+)\) like gecko/))?b.ie=a[1]:(a=c.match(/msie ([\d.]+)/))?b.ie=a[1]:(a=c.match(/firefox\/([\d.]+)/))?b.firefox=a[1]:(a=c.match(/chrome\/([\d.]+)/))?b.chrome=a[1]:(a=c.match(/opera.([\d.]+)/))?b.opera=a[1]:(a=c.match(/version\/([\d.]+).*safari/))?b.safari=a[1]:0;var d=[];return b.ie&&(d=["IE",b.ie]),b.firefox&&(d=["Firefox",b.firefox]),b.chrome&&(d=["Chrome",b.chrome]),b.opera&&(d=["Opera",b.opera]),b.safari&&(d=["Safari",b.safari]),d}},$.sjbwebim=function(opts){var defaults={url:"//c"+parseInt(10*Math.random())+"-ims.shijiebang.com/",webimBtn:".webim-online-click",emptyHead:"//s2.sjbly.cn/img/avt_180.png",groupChatLinkClass:"webim-groupchat-link",style:{follow:{width:50,height:50,right:"50%",bottom:"113px",margin:"0 -555px 0 0",zIndex:120,display:"block"},win:{width:680,height:500,right:"50%",bottom:"50%",margin:"0 -340px -250px 0",zIndex:99}}},options=$.extend(!0,{},defaults,opts||{}),temp=$.sjbwebimTemp,action=$.sjbwebimAction,methods={init:function(){var a=options.style.follow;action.creatFollow(a),sjbwebimSDK=new $.MessagingSdk(options.url,$.MessagingSdk.Type.WEB),webChat=sjbwebimSDK.getWebChat(),webChat.setChatEventHandler($.MessagingSdk.ChatEvent.UPDATE_PERSONAL_INFO,function(a){sjbwebimParams.user=a,buildFastReply(a),buildImgUpload(a),sjb.messaging.comoon.emoji.buildImEmoji();var b=sjbwebimSDK.getUserId(),c=action.checkUserType(a.getUserTypeInfo());sjbwebimParams.userSelf.uid=b,sjbwebimParams.userSelf.userhead=a.iconUrl,sjbwebimParams.userSelf.name=a.nickname?a.nickname:"",sjbwebimParams.userSelf.status=a.onlineStatus,sjbwebimParams.userSelf.type=a.type,sjbwebimParams.userSelf.identityIconUrl=c.iconUrl?c.iconUrl:options.emptyHead,sjbwebimParams.userSelf.identityIconName=c.name,(1==a.type||2==a.type||4==a.type)&&(sjbwebimParams.permissions.createChat=!0,sjbwebimParams.permissions.fastReply=!0),$.sjbimPub("imUserLoginSucc",sjbwebimParams.userSelf)}),webChat.setChatEventHandler($.MessagingSdk.ChatEvent.UPDATE_TOTAL_UNREAD,action.updateTotalUnread),sjbwebimSDK.start(function(){webChat.syncTotalUnreadCounter(),action.buttonIsParent(options.webimBtn)}),$(sjbwebimParams.ids.entry).on("click",methods.entryEvent).on("sjbwebim.colsedTip",methods.colsedTipEvent).on("sjbwebim.openTip",methods.openTipEvent),webChat.setChatEventHandler($.MessagingSdk.ChatEvent.USER_CHANGED,function(){$.sjbwebimHooks.isReload===!1&&(action.reloadLogin(options.emptyHead),$.sjbwebimHooks.isReload=!0,$.sjbimPub("imUserChanged"))}),$("body").on("click",".webim-online-click",methods.otherEntryEvent).on("sjbwebim.relogin",methods.init),$("body").on("click","."+options.groupChatLinkClass,methods.groupChatEntryEvent);var b=methods.otherEntryEvent;$.sjbimPub("imInit",b),sjbimRadioPubStatus.imInit={count:sjbimRadioPubStatus.imInit.count+1,ex:b}},otherEntryEvent:function(a){var b=$(sjbwebimParams.ids.win),c=$(this),d=c.data("subuid");sjbwebimParams.data.bindMsg=c.data("imMsg");var e=function(a){sjbwebimParams.data.tempUid=a,sjbwebimParams.data.isFromConsult=!0,b[0]?(action.openWindow(),Chat.createChat({uid:a},function(b){var c=b.getSdkChat();tchatList.add(c),action.checkUserInTalk(c.id,a,0,!0)})):$(sjbwebimParams.ids.entry).trigger("click")};return d?e(d):webChat.queryParentAccount(c.data("id"),function(a){c.data("subuid",a),e(a)}),!1},groupChatEntryEvent:function(){var a=$(sjbwebimParams.ids.win),b=$(this),c=b.data("chatid");return c?(sjbwebimParams.data.tempGroupChatId=c,void(a[0]?(action.openWindow(),Chat.createChat({cid:c},function(a){var b=a.getSdkChat();tchatList.add(b),action.checkUserInTalk(b.id,0,0,!0)})):$(sjbwebimParams.ids.entry).trigger("click"))):(alert("[data-chatid]"),!1)},openTipEvent:function(a){var b=$(this),c=b.find(".sjb-webim-total"),d=Number(c.find(".sjb-webim-total-c strong").text());d>0&&(b.find("a").addClass("has-new-msg"),c.is(":hidden")&&c.show().width(c.find(".sjb-webim-total-c").outerWidth()))},colsedTipEvent:function(a){var b=$(this),c=b.find(".sjb-webim-total");b.find("a").removeClass("has-new-msg"),c.width(0).hide()},entryEvent:function(a){var b=options.style.follow,c=$(sjbwebimParams.ids.win);if(c[0]){if(c.is(":hidden")){var d=!1,e=$(a.target).closest(".sjb-webim-total");if(e[0]&&e.closest(".has-new-msg")&&(d=!0),action.openWindow(),d)var f=0,g=setInterval(function(){f++,tchatList.firstUnread()&&(action.checkUserInTalk(tchatList.firstUnread().id,0,0,!0),clearInterval(g)),f>60&&clearInterval(g)},50)}}else{var h=options.style.win,i=function(a){action.createLayout(a,methods.initData)};action.createWindow(b,h,i)}return!1},initData:function(a,b,c,d,e){methods.tabEvent(c),webChat.sync(),function(){var a=193006;webChat.queryParentAccount(a,function(a){Chat.createChat({uid:a},function(b){var c=b.getSdkChat();tchatList.add(c),$.sjbwebimAction.checkUserInTalk(null,a),setTimeout(function(){sjb.messaging.comoon.method.runOnce(sendSemMsg,{frequency:50,conditions:[{source:sjbwebimParams,param:"user",method:"self"}],context:null,fixed:[c]})},3e3)})})}(),webChat.setChatEventHandler($.MessagingSdk.ChatEvent.UPDATE_CHAT_LIST,action.chatListHandler),d.on("click",".sjb-webim-tab-single .sjb-webim-userlist li.item",{right:e},methods.showUserDetailEvent),d.on("click",".sjb-webim-tab-group .sjb-webim-userlist li.item",{right:e},methods.showGroupDetailEvent),webChat.setChatEventHandler($.MessagingSdk.ChatEvent.UPDATE_CHAT_UNREAD,action.updateChatUnreadHandler),d.on("input change",".sjb-webim-search-user input",{center:d},methods.searchSingleUser),d.on("click",".sjb-webim-search-user button",methods.clearSearchInput),a.on("click",".sjb-webim-start-chat",{container:a,right:e},methods.startChat),a.on("click",".item-createchat",{},methods.createChat),d.on("dblclick",".sjb-webim-tab-single, .sjb-webim-tab-group",methods.dblclickStartChat),e.on("click",".item-more a",methods.moreHistory),webChat.setChatEventHandler($.MessagingSdk.ChatEvent.SWITCH_CHAT,action.switchChatHandler),d.on("click",".sjb-webim-tab-talk .sjb-webim-userlist li.item",{
center:d,right:e},methods.changeTalk),webChat.setChatEventHandler($.MessagingSdk.ChatEvent.APPEND_CHAT_HISTORY,action.appendMsg),webChat.setChatEventHandler($.MessagingSdk.ChatEvent.CHAT_MESSAGE_LOADED,action.replaceMsg),e.on("click","a.sjb-webim-group-showlink",methods.showGroupMember),e.on("click",".show-more a",{left:c,center:d},methods.groupTalkToDetail),e.on("click",".sjb-webim-talk .sjb-webim-talk-header h2",{left:c,center:d},methods.userTalkToDetail),e.on("click",".sjb-webim-fast-reply-entry",function(){e.find(".sjb-webim-fast-reply-main").toggle()}),e.on("click",".sjb-webim-fast-reply-item",function(){var a=$(this),b=$("#sjb-webim-editor"),c=a.data("text")||a.text();c=c.replace(/^[^]+/,""),b.val(b.val()+c),e.find(".sjb-webim-fast-reply-main").hide(),b.focus(),b.trigger("keyup")}),$("body").on("click",function(a){var b=$(a.target);0==b.closest(".sjb-webim-fast-reply").length&&e.find(".sjb-webim-fast-reply-main").hide()}),e.on("click",".sjb-webim-fast-travel-entry",function(){e.find(".sjb-webim-fast-travel-main").toggle()}),e.on("click",".sjb-webim-fast-travel-item",function(){$(this);e.find(".sjb-webim-fast-travel-main").hide()}),$("body").on("click",function(a){var b=$(a.target);0==b.closest(".sjb-webim-fast-travel").length&&e.find(".sjb-webim-fast-travel-main").hide()}),webChat.setChatDraftGetter(function(){return $("#sjb-webim-editor").val()}),e.on("click","button.sjb-webim-submit",methods.sendMsg),e.on("click",".item-error-inner a",methods.resendMsg),e.on("focus","#sjb-webim-editor",function(a){$(this).bind("keydown",methods.keyDownEvent),webChat.markCurrentChatAsRead()}).on("blur","#sjb-webim-editor",function(){$(this).unbind("keydown",methods.keyDownEvent)}).on("keyup","#sjb-webim-editor",methods.keyUpEvent),a.on("click",".sjb-webim-remove a",action.closedWindow);var f=$.cookie("sjbWebimSendkey");"undefined"==typeof f&&$.cookie("sjbWebimSendkey",0,$.extend({},sjbwebimParams.cookieOptions,{expires:365})),e.on("click","a.sjb-webim-setkey",methods.setKeyEnent),webChat.setChatEventHandler($.MessagingSdk.ChatEvent.UPDATE_ONLINE_STATUS,action.updateOnline),e.on("click",".sjb-webim-get-server-time",methods.getServerTime),e.on("click",".sjb-webim-emoji-panel .item i",function(){var a=$(this),b=a.data("name"),c=sjb.messaging.comoon.emoji,d=document.getElementById("sjb-webim-editor");c.appendToEditor(d,b),c.close(),$(d).focus(),$("button.sjb-webim-submit").prop("disabled",!1)})},getServerTime:function(){var a=$(this),b=a.data("uids"),c="",d="",e=a.next(".sjb-webim-server-time");if(e[0])return e.is(":hidden")?e.show():e.hide(),!1;if(!b)return!1;var f=b.split(","),g={doyen:{},sale:{}};return $.each(f,function(a){var b=webChat.getUser(f[a]);if(b){var e=$.sjbwebimAction.checkUserType(b.getUserTypeInfo());e&&(""===e.name?(d=f[a],g.doyen.name=b.nickname,g.doyen.uid=f[a],g.doyen.icon=b.iconUrl,g.doyen.work_day={},g.doyen.weekend={}):""===e.name&&(c=f[a],g.sale.name=b.nickname,g.sale.uid=f[a],g.sale.icon=b.iconUrl,g.sale.current_date="",g.sale.days=[]))}}),c&&d?(a.prop("disabled",!0),$.ajax({type:"GET",dataType:"jsonp",url:"//is.shijiebang.com/sales/schedulelist/",data:{saleId:c,doyenId:d},success:function(b){if(0===parseInt(b.code)){var c=b.data.doyenSchedule[0],d="";g.doyen.work_day={start:c&&c.workStart?c.workStart:"",end:c&&c.workEnd?c.workEnd:""},g.doyen.weekend={start:c&&c.workStart?c.workStart:"",end:c&&c.workEnd?c.workEnd:""},g.sale.current_date=b.data.currentDate,g.sale.days=b.data.saleSchedule,d=temp.serverTimeTemp(g),a.after(d)}else alert(b.msg);a.prop("disabled",!1)},error:function(){a.prop("disabled",!1)}}),!1):(alert(""),!1)},showGroupMember:function(a){var b=$(this).closest(".sjb-webim-talk-header"),c=Number(b.data("height")),d="sjb-webim-talk-header-block",e=b.find(".sjb-webim-group-members"),f=e.find("ul"),g=f.outerHeight();return b.hasClass(d)?(b.removeClass(d).height(c),e.height(1)):(b.addClass(d).height(c+g),e.height(g)),!1},moreHistory:function(){$("#sjb-webim-talk-scrollbar").trigger("esScrollbarGoto",[0])},groupTalkToDetail:function(a){var b=a.data.left,c=a.data.center,d=$(this).data("chatid");b.find(".sjb-webim-nav li").eq(2).trigger("click"),c.find(".sjb-webim-tab-group li.sjb-webim-chatid-"+d).trigger("click")},userTalkToDetail:function(a){var b=$(this).closest(".sjb-webim-talk");if(!b.hasClass("sjb-webim-group-talk")){var c=$(this).data("chatid"),d=a.data.left,e=a.data.center;d.find(".sjb-webim-nav li").eq(1).trigger("click"),e.find(".sjb-webim-tab-single li.sjb-webim-chatid-"+c).trigger("click")}},keyUpEvent:function(){var a=$("#sjb-webim-editor"),b=a.val(),c=$(".sjb-webim-sendmessage"),d=c.find("button");b.length>0?(c.removeClass("disabled"),d.prop("disabled",!1)):(c.addClass("disabled"),d.prop("disabled",!0))},keyDownEvent:function(a){var b=Number($.cookie("sjbWebimSendkey")),c=$("#sjb-webim-editor"),d=c.val();if(0===b){if(a.ctrlKey&&13===a.keyCode)return a.preventDefault(),methods.sendMsg(),!1}else if(1===b){if(a.ctrlKey&&13===a.keyCode){a.preventDefault();var e=d+"\r\n";return c.val(e),!1}if(13===a.keyCode)return a.preventDefault(),methods.sendMsg(),!1}},sendMsg:function(a,b,c,d){var e=$(sjbwebimParams.ids.win);if(e.find(".sjb-webim-submit").is(":disabled"))return!1;var f=$(this).data("ttyle");if("kanbujianwo"===f){var g=$(this).data("uid"),h=$.trim($("#sjb-webim-editor").val());sjbwebimParams.data.current.chatId=null,e.find('.sjb-webim-tab-talk li.sjb-webim-chatid-kanbujianwo[data-userid="'+g+'"]').remove(),e.find(".sjb-webim-right").empty(),webChat.selectChat(0),$.sjbwebimHooks.falseUser.reconnet=function(a){a&&($.sjbwebimHooks.falseUser&&$.sjbwebimHooks.falseUser.inner&&$.isFunction($.sjbwebimHooks.falseUser.inner)&&$.sjbwebimHooks.falseUser.inner(),$("#sjb-webim-editor").val(h),$("button.sjb-webim-submit").prop("disabled",!1).trigger("click"))},action.createTalk(g)}else{var i=webChat.getCurrentChatId();if(!i)return;var j=b?c:$.trim($("#sjb-webim-editor").val());if(j=sjb.messaging.comoon.rule.convert(j,sjbwebimParams.userSelf.type),!j)return;if(j.length>500)return $("#sjb-webim-editor").val(j.substr(0,500)),alert("500"),!1;var k=null,l=$("#sjb-webim-talk-scrollbar"),m=l.find(".sjb-webim-talk-list ul");if(b)k=b;else{$("#sjb-webim-editor").val(""),sjbwebimParams.data.sendMessageId++,k=sjbwebimParams.data.sendMessageId;var n=$.sjbwebimTemp.chatItem(1,{content:j},"send-"+k,0);m.append(n),l.trigger("esScrollbarUpdate",[1,"bottom"])}var o=function(a){if(sjb.messaging.ResponseCode.SENSITIVE_WORD===a.responseCode){var b=$.sjbwebimTemp.chatItem(1,{content:j},"send-"+k,2);m.find("li.sjb-webim-talk-item-send-"+k).replaceWith(b),l.trigger("esScrollbarUpdate",[1,"bottom"])}else m.find("li.sjb-webim-talk-item-send-"+k).remove(),l.trigger("esScrollbarUpdate",[1,"bottom"])},p=function(){var a=$.sjbwebimTemp.chatItem(1,{content:j},"send-"+k,1);m.find("li.sjb-webim-talk-item-send-"+k).replaceWith(a),l.trigger("esScrollbarUpdate",[1,"bottom"])},q={type:1,text:j,url:""};d&&(q.metadata=d);var r=JSON.stringify(q);webChat.sendMessage(i,r,o,p)}},resendMsg:function(a){var b=$(this),c=b.data("sendmsgid"),d=b.closest(".item-error-inner").prev(".opacity").find(".item-content-text"),e=d.data("content"),f=d.data("meta");return methods.sendMsg(null,c,e,f),!1},setKeyEnent:function(a){var b="sjb-webim-setkey-block",c=$(this),d=Number($.cookie("sjbWebimSendkey")),e=$(temp.shortcuts(d)),f=c.offset(),g=function(){c.removeClass(b),$("#sjb-webim-set-shortcuts").remove(),$("body").unbind("click",h)},h=function(a){$(a.target).closest("#sjb-webim-set-shortcuts")[0]||g()};return e.find("li").eq(d).addClass("current"),e.find("li").eq(1-d).bind("click",function(){$.cookie("sjbWebimSendkey",1-d,$.extend({},sjbwebimParams.cookieOptions,{expires:365})),g()}),e.css({left:f.left-121,top:f.top-$(window).scrollTop()+29,zIndex:options.style.win.zIndex}),c.hasClass(b)?g():(c.addClass(b),$("body").append(e).bind("click",h)),!1},changeTalk:function(a,b){var c=$(this).data("chatid"),d=$(this).data("userid");$(a.target).hasClass("sjb-webim-del")?!function(){var b=$(a.target).closest(".item"),c=b.next("li.item"),d=b.prev("li.item"),e=b.closest(".sjb-webim-center-scrollbar");if(b.remove(),c[0])c.trigger("click");else if(d[0])d.trigger("click");else{var f=a.data.right;f.html(""),webChat.selectChat(0)}e.trigger("esScrollbarUpdate");var g=e.find(".es-scrollbar-bar"),h=g[0]&&!g.is(":hidden")?16:0;e.find(".sjb-webim-list-remove").css({right:h})}():(sjbwebimParams.data.current.chatId=c,sjbwebimParams.data.current.userId=d,webChat.selectChat(c),b&&$.isFunction(b)&&b())},dblclickStartChat:function(a){if(a.stopPropagation(),$(a.target).hasClass("item")||$(a.target).closest("li.item")[0]){var b=$(a.target).closest("li.item");b[0]||(b=$(a.target));var c=b.data("chatid"),d=b.data("userid");c&&(tchatList.add(achatList.get(c)),action.checkUserInTalk(c,d,null,!0))}return!1},createChat:function(a){var b=$(this).data("uid");action.createTalk(b)},startChat:function(a){var b=$(this).data("chatid"),c=$(this).data("userid");tchatList.add(achatList.get(b)),action.checkUserInTalk(b,c,0,!0)},resetSearch:function(){var a="";return $.each(schatList.toJSON(),function(b,c){a+=$.sjbwebimTemp.contactListItem(buildSingleDataBySdkChat(c))}),a},clearSearchInput:function(){$(this).prev("input").val("").trigger("change")},searchSingleUser:function(event){var no=Number($(this).val()),center=event.data.center.find(".sjb-webim-tab-single");if(1>no){var r=methods.resetSearch();center.find("ul").html(r),$(this).next("button").hide()}else{var index=-1,html='<li class="item-noresult"></li>',currentUser=webChat.getUser(sjbwebimSDK.getUserId());(1==currentUser.type||2==currentUser.type||4==currentUser.type)&&(html='<li class="item-createchat" data-uid="'+no+'">&nbsp;<b>'+no+"</b>&nbsp;</li>");var res=[],reg=eval("/"+no+"/");schatList.each(function(a,b){var c=b.peerUserId();reg.test(c.toString())&&res.push($.sjbwebimTemp.contactListItem(buildSingleDataBySdkChat(b)))}),res.length>0&&(html=res.join("")),center.find("ul").html(html),index>-1&&center.find("ul li.item").eq(0).trigger("click"),$(this).next("button").show()}},showUserDetailEvent:function(a){var b=$(this),c=a.data.right,d=b.data("chatid"),e=buildSingleDataBySdkChat(schatList.get(d)),f=$.sjbwebimTemp.userDetail(e);return b.addClass("current").siblings("li.item").removeClass("current"),c.html(f),webChat.selectChat(0),!1},showGroupDetailEvent:function(a){var b=$(this),c=a.data.right,d=b.data("chatid"),e=buildGroupDataBySdkChat(gchatList.get(d)),f=$.sjbwebimTemp.groupDetail(e);return b.addClass("current").siblings("li.item").removeClass("current"),c.html(f),$.each(c.find(".sjb-webim-status-off"),function(){var a=$.sjbwebimAction.getBowerType(),b=$(this).prev(".sjb-webim-userhead").find("img");b.addClass("sjb-webim-status-off-img"),"IE"===a[0]&&Number(a[1])>9&&grayscale(b)}),$("#sjb-webim-group-srcoll").estormScrollbar(),webChat.selectChat(0),!1},tabEvent:function(a){a.on("click",".sjb-webim-nav li",function(b){$(this).addClass("current").siblings("li").removeClass("current");var c=a.find(".sjb-webim-nav li").index(this),d=$(sjbwebimParams.ids.win).find(".sjb-webim-fly"),e=$(this).data("type");sjbwebimParams.data.currTab=Number(e),d.css({top:-1*c*500}),c>0&&d.find(".sjb-webim-tab-main").eq(c).find("li.current").removeClass("current")}),a.find(".sjb-webim-nav li").eq(0).trigger("click"),$("#sjb-webim").estormDrag({callback:function(a,b){sjbwebimParams.style.left=a,sjbwebimParams.style.top=b,sjbwebimParams.style.margin=0}})}};methods.init()},Chat.createChat=function(a,b){var c=new Chat,d=a.uid,e=a.cid,f=null,g=function(){return c.setSdkChat(f),b(c),!1};return e?(f=achatList.get(e))?g():achatList.on("change",function(a,b,c){(f=achatList.get(e))&&($(this).off("change",c),g())}):d&&((f=achatList.getByUid(d))?g(f):(webChat.createSingleChat(d,function(a){}),achatList.on("change",function(a,b,c){(f=achatList.getByUid(d))&&($(this).off("change",c),g())}))),c},$(document).ready(function(){"undefined"==typeof sjbwebim?$.sjbwebim():$.sjbwebim(sjbwebim);var a=storage.read("fast-replies"),b=storage.read("fast-replies-update-time");b instanceof Date?b.getTime()!==b.getTime()&&(b=null):b=null,(!a||!b||(new Date).getTime()-b.getTime()>6e5)&&($.cpUser?$.cpUser({callback:function(a){a?readFastReplies(a.uid):readFastReplies()},errorCallback:function(){readFastReplies()}}):readFastReplies()),sjb.messaging.comoon.sem.readCps()})}(jQuery);